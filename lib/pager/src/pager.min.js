"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _default2={name:"VxePager",props:{size:String,layouts:{type:Array,default:function(){return _conf.default.pager.layouts||["PrevJump","PrevPage","Jump","PageCount","NextPage","NextJump","Sizes","Total"]}},currentPage:{type:Number,default:1},loading:Boolean,pageSize:{type:Number,default:function(){return _conf.default.pager.pageSize||10}},total:{type:Number,default:0},pagerCount:{type:Number,default:function(){return _conf.default.pager.pagerCount||7}},pageSizes:{type:Array,default:function(){return _conf.default.pager.pageSizes||[10,15,20,50,100]}},align:String,background:Boolean},inject:{$grid:{default:null}},data:function(){return{showSizes:!1,panelStyle:null,panelIndex:0}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},isSizes:function(){return this.layouts.some(function(e){return"Sizes"===e})},pageCount:function(){return this.getPageCount(this.total,this.pageSize)},numList:function(){return Array.from(new Array(this.pageCount>this.pagerCount?this.pagerCount-2:this.pagerCount))},offsetNumber:function(){return Math.floor((this.pagerCount-2)/2)}},created:function(){this.panelIndex=_tools.UtilTools.nextZIndex(),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent)},mounted:function(){this.$refs.sizePanel&&document.body.appendChild(this.$refs.sizePanel)},beforeDestroy:function(){var e=this.$refs.sizePanel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown")},render:function(t){var e,n=this,i=this.layouts,a=this.isSizes,r=this.loading,s=this.vSize,o=this.align,u=this.background;return t("div",{class:["vxe-pager",(e={},_defineProperty(e,"size--".concat(s),s),_defineProperty(e,"align--".concat(o),o),_defineProperty(e,"p--background",u),_defineProperty(e,"is--loading",r),e)]},i.map(function(e){return n["render".concat(e)](t)}).concat(a?this.renderSizePanel(t):[]))},methods:{renderPrevPage:function(e){return e("span",{class:["vxe-pager--prev-btn",{"is--disabled":this.currentPage<=1}],on:{click:this.prevPage}},[e("i",{class:["vxe-icon--page-icon",_conf.default.icon.prevPage]})])},renderPrevJump:function(e,t){var n=this,i=this.numList,a=this.currentPage;return e(t||"span",{class:["vxe-pager--jump-prev",{"is--fixed":!t,"is--disabled":a<=1}],on:{click:function(){return n.jumpPage(Math.max(a-i.length,1))}}},[t?e("i",{class:"vxe-pager--jump-more vxe-icon--more"}):null,e("i",{class:["vxe-pager--jump-icon",_conf.default.icon.jumpPrev]})])},renderNumber:function(e){return e("ul",{class:"vxe-pager--btn-wrapper"},this.renderPageBtn(e))},renderJumpNumber:function(e){return e("ul",{class:"vxe-pager--btn-wrapper"},this.renderPageBtn(e,!0))},renderNextJump:function(e,t){var n=this,i=this.numList,a=this.currentPage,r=this.pageCount;return e(t||"span",{class:["vxe-pager--jump-next",{"is--fixed":!t,"is--disabled":r<=a}],on:{click:function(){return n.jumpPage(Math.min(a+i.length,r))}}},[t?e("i",{class:"vxe-pager--jump-more vxe-icon--more"}):null,e("i",{class:["vxe-pager--jump-icon",_conf.default.icon.jumpNext]})])},renderNextPage:function(e){var t=this.currentPage;return e("span",{class:["vxe-pager--next-btn",{"is--disabled":this.pageCount<=t}],on:{click:this.nextPage}},[e("i",{class:["vxe-icon--page-icon",_conf.default.icon.nextPage]})])},renderSizes:function(e){var t=this.pageSize;return e("span",{class:["vxe-pager--sizes",{"is--active":this.showSizes}],on:{click:this.toggleSizePanel},ref:"sizeBtn"},[e("i",{class:"vxe-pager--sizes-arrow ".concat(_conf.default.icon.caretBottom)}),e("span",{class:"size--content"},"".concat(t).concat(_conf.default.i18n("vxe.pager.pagesize")))])},renderSizePanel:function(t){var n=this,e=this.panelStyle,i=this.pageSize,a=this.pageSizes,r=this.showSizes;return t("ul",{class:["vxe-pager-size--select",{"is--show":r}],style:e,ref:"sizePanel"},a.map(function(e){return t("li",{class:["size--option",{"is--active":e===i}],on:{click:function(){return n.changePageSize(e)}}},"".concat(e).concat(_conf.default.i18n("vxe.pager.pagesize")))}))},renderFullJump:function(e){return this.renderJump(e,!0)},renderJump:function(e,t){var i=this,n=this.currentPage,a=this.pageCount;return e("span",{class:"vxe-pager--jump"},[t?e("span",{class:"vxe-pager--goto-text"},_conf.default.i18n("vxe.pager.goto")):null,e("input",{class:"vxe-pager--goto",domProps:{value:n},attrs:{type:"text",autocomplete:"off"},on:{keydown:function(e){if(13===e.keyCode){var t=_xeUtils.default.toNumber(e.target.value),n=t<=0?1:a<=t?a:t;e.target.value=n,i.jumpPage(n)}else 38===e.keyCode?(e.preventDefault(),i.nextPage(e)):40===e.keyCode&&(e.preventDefault(),i.prevPage(e))}}}),t?e("span",{class:"vxe-pager--classifier-text"},_conf.default.i18n("vxe.pager.pageClassifier")):null])},renderPageCount:function(e){var t=this.pageCount;return e("span",{class:"vxe-pager--count"},[e("span",{class:"vxe-pager--separator"},"/"),e("span",t)])},renderTotal:function(e){var t=this.total;return e("span",{class:"vxe-pager--total"},_xeUtils.default.template(_conf.default.i18n("vxe.pager.total"),{total:t}))},renderPageBtn:function(i,e){var a=this,t=this.numList,r=this.currentPage,s=this.pageCount,n=this.pagerCount,o=this.offsetNumber,u=[],l=n<s,c=l&&o+1<r,p=l&&r<s-o,g=1;return l&&(g=s-o<=r?Math.max(s-t.length+1,1):Math.max(r-o,1)),e&&c&&u.push(i("li",{class:"vxe-pager--num-btn",on:{click:function(){return a.jumpPage(1)}}},1),this.renderPrevJump(i,"li")),t.forEach(function(e,t){var n=g+t;n<=s&&u.push(i("li",{class:["vxe-pager--num-btn",{"is--active":r===n}],on:{click:function(){return a.jumpPage(n)}},key:n},n))}),e&&p&&u.push(this.renderNextJump(i,"li"),i("li",{class:"vxe-pager--num-btn",on:{click:function(){return a.jumpPage(s)}}},s)),u},getPageCount:function(e,t){return Math.max(Math.ceil(e/t),1)},handleGlobalMousedownEvent:function(e){!this.showSizes||_tools.DomTools.getEventTargetNode(e,this.$refs.sizeBtn).flag||_tools.DomTools.getEventTargetNode(e,this.$refs.sizePanel).flag||this.hideSizePanel()},prevPage:function(){var e=this.currentPage;1<e&&this.jumpPage(Math.max(e-1,1))},nextPage:function(){var e=this.currentPage,t=this.pageCount;e<t&&this.jumpPage(Math.min(e+1,t))},jumpPage:function(e){var t="current-change";e!==this.currentPage&&(this.$emit("update:currentPage",e),_tools.UtilTools.emitEvent(this,t,[e]),this.emitPageChange(t,this.pageSize,e))},changePageSize:function(e){var t="size-change";e!==this.pageSize&&(this.$emit("update:pageSize",e),_tools.UtilTools.emitEvent(this,t,[e]),this.emitPageChange(t,e,Math.min(this.currentPage,this.getPageCount(this.total,e)))),this.hideSizePanel()},emitPageChange:function(e,t,n){_tools.UtilTools.emitEvent(this,"page-change",[{type:e,pageSize:t,currentPage:n}])},toggleSizePanel:function(){this.showSizes?this.hideSizePanel():this.showSizePanel()},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},hideSizePanel:function(){this.showSizes=!1},showSizePanel:function(){var i=this,a=this.$refs,r=a.sizeBtn,e=_tools.DomTools.getAbsolutePos(r),s=e.left,o=e.top,t=_tools.DomTools.getDomNode(),u=t.scrollTop,l=t.scrollLeft,c=t.visibleWidth,p=t.visibleHeight;this.updateZindex(),this.panelStyle={zIndex:this.panelIndex,left:"".concat(s,"px"),top:"".concat(o+r.offsetHeight+6,"px")},this.showSizes=!0,this.$nextTick().then(function(){var e=a.sizePanel;if(e)return i.panelStyle.top="".concat(o+r.offsetHeight+6,"px"),i.panelStyle.left="".concat(s+Math.floor((r.offsetWidth-e.offsetWidth)/2),"px"),i.$nextTick()}).then(function(){var e=a.sizePanel;if(e){var t=e.offsetHeight,n=e.offsetWidth;o+r.offsetHeight+t>u+p&&(i.panelStyle.top="".concat(o-t-6,"px")),l+c<s+n&&(i.panelStyle.left="".concat(l+c-n-6,"px"))}})}}};exports.default=_default2;