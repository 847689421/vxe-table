"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _tools=require("../../tools");function toCsv(t,o,n,e){var r=o.original,a="\ufeff";if(o.isHeader&&(a+=n.map(function(t){var o=t.own;return'"'.concat(_tools.UtilTools.getFuncText(o.title||o.label),'"')}).join(",")+"\n"),e.forEach(function(o,e){a+=r?n.map(function(t){return"index"===t.type?'"'.concat(t.indexMethod?t.indexMethod(e):e+1,'"'):'"'.concat(_tools.UtilTools.getCellValue(o,t)||"",'"')}).join(",")+"\n":n.map(function(t){return'"'.concat(o[t.id],'"')}).join(",")+"\n"}),o.isFooter){var l=t.footerData,i=o.footerFilterMethod?l.filter(o.footerFilterMethod):l,c=t.tableColumn.map(function(t){return n.includes(t)});i.forEach(function(t){a+=t.filter(function(t,o){return'"'.concat(c[o],'"')}).join(",")+"\n"})}return a}function toHtml(t,o,n,e){var r=o.original,a='<table border="1" cellspacing="0" cellpadding="0">';if(o.isHeader&&(a+="<thead><tr><th>"+n.map(function(t){var o=t.own;return _tools.UtilTools.getFuncText(o.title||o.label)}).join("</th><th>")+"</th></tr></thead>"),a+="<tbody>",e.forEach(function(o,e){a+="<tr>",a+=r?"<td>"+n.map(function(t){return"index"===t.type?"".concat(t.indexMethod?t.indexMethod(e):e+1):"".concat(_tools.UtilTools.getCellValue(o,t)||"")}).join("</td><td>")+"</td>":"<td>"+n.map(function(t){return"".concat(o[t.id])}).join("</td><td>")+"</td>",a+="</tr>"}),a+="</tbody>",o.isFooter){var l=t.footerData,i=o.footerFilterMethod?l.filter(o.footerFilterMethod):l,c=t.tableColumn.map(function(t){return n.includes(t)});i.length&&(a+="<tfoot>",i.forEach(function(t){a+="<tr><td>"+t.filter(function(t,o){return c[o]}).join("</td><td>")+"</td></tr>"}),a+="</tfoot>")}return a+"</table>"}function getLabelData(r,t,o){return o.map(function(e){var n={};return t.forEach(function(t){var o=_tools.DomTools.getCell(r,{row:e,column:t});n[t.id]=o?o.innerText.trim():""}),n})}function getExportData(t,o,e,n){var r=o.columns?o.columns:n,a=o.data||e;return o.columnFilterMethod&&(r=r.filter(o.columnFilterMethod)),o.dataFilterMethod&&(a=a.filter(o.dataFilterMethod)),{columns:r,datas:o.original?a:getLabelData(t,r,a)}}function getDownloadUrl(t,o){switch(t.type){case"csv":case"html":return getCsvAndHtmlUrl(t,o)}return""}function getCsvAndHtmlUrl(t,o){var e=t.type;return window.Blob&&window.URL&&window.URL.createObjectURL&&!_tools.DomTools.browse.safari?URL.createObjectURL(new Blob([o],{type:"text/".concat(e)})):"data:attachment/".concat(e,";charset=utf-8,").concat(encodeURIComponent(o))}var _default={getCsvContent:function(t,o,e,n){var r=o.type,a=getExportData(t,o,n,e),l=a.columns,i=a.datas;return"csv"===r?toCsv(t,o,l,i):"html"===r?toHtml(t,o,l,i):""},downloadCsc:function(t,o){var e=t.filename,n=t.type,r=t.download,a="".concat(e,".").concat(n);if(!r)return Promise.resolve(o);if(navigator.msSaveBlob&&window.Blob)navigator.msSaveBlob(new Blob([o],{type:"text/".concat(n)}),a);else if(_tools.DomTools.browse["-ms"]){var l=window.top.open("about:blank","_blank");l.document.charset="utf-8",l.document.write(o),l.document.close(),l.document.execCommand("SaveAs",a),l.close()}else{var i=document.createElement("a");i.target="_blank",i.download=a,i.href=getDownloadUrl(t,o),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}};exports.default=_default;