"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={name:"VxeExportPanel",props:{defaultOptions:Object,storeData:Object},data:function(){return{isAll:!1,isIndeterminate:!1,modeList:[{value:"all",label:"vxe.toolbar.expAll"},{value:"selected",label:"vxe.toolbar.expSelected"}]}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},showSheet:function(){return _xeUtils.default.includes(["html","xml","xlsx"],this.defaultOptions.type)},isNotImport:function(){return this.storeData.isTree}},render:function(o){var l=this,e=this._e,t=this.isAll,i=this.isIndeterminate,a=this.showSheet,n=this.defaultOptions,r=this.storeData,s=this.modeList,c=this.isNotImport;return o("vxe-modal",{res:"modal",model:{value:r.visible,callback:function(e){r.visible=e}},props:{title:_conf.default.i18n("vxe.toolbar.expTitle"),width:660,mask:!0,lockView:!0,showFooter:!1,escClosable:!0,maskClosable:!0},on:{show:this.showEvent}},[o("div",{class:"vxe-export--panel"},[o("table",{attrs:{cellspacing:0,cellpadding:0,border:0}},[o("tr",[o("td",_conf.default.i18n("vxe.toolbar.expName")),o("td",[o("input",{ref:"filename",attrs:{type:"text",placeholder:_conf.default.i18n("vxe.toolbar.expNamePlaceholder")},domProps:{value:n.filename},on:{input:function(e){n.filename=e.target.value}}})])]),o("tr",[o("td",_conf.default.i18n("vxe.toolbar.expType")),o("td",[o("select",{on:{change:function(e){n.type=e.target.value}}},n.types.map(function(e){return o("option",{attrs:{value:e.value},domProps:{selected:n.type===e.value}},_conf.default.i18n(e.label))}))])]),a?o("tr",[o("td",_conf.default.i18n("vxe.toolbar.expSheetName")),o("td",[o("input",{attrs:{type:"text",placeholder:_conf.default.i18n("vxe.toolbar.expSheetNamePlaceholder")},domProps:{value:n.sheetName},on:{input:function(e){n.sheetName=e.target.value}}})])]):e(),o("tr",[o("td",_conf.default.i18n("vxe.toolbar.expMode")),o("td",[o("select",{on:{change:function(e){r.mode=e.target.value}}},s.map(function(e){return o("option",{attrs:{value:e.value},domProps:{selected:r.mode===e.value}},_conf.default.i18n(e.label))}))])]),o("tr",[o("td",[_conf.default.i18n("vxe.toolbar.expColumn")]),o("td",[o("div",{class:"vxe-export--panel-column"},[o("vxe-checkbox",{props:{indeterminate:i,title:_conf.default.i18n("vxe.table.allTitle")},model:{value:t,callback:function(e){l.isAll=e}},on:{change:this.allColumnEvent}},_conf.default.i18n("vxe.toolbar.expAllColumn")),o("ul",r.columns.map(function(e){var t=e.getTitle();return o("li",{class:{"is--active":e.checked,"is--disabled":e.disabled},attrs:{title:t},on:{click:function(){e.disabled||(e.checked=!e.checked,l.checkStatus())}}},t)}))])])]),o("tr",[o("td",_conf.default.i18n("vxe.toolbar.expOpts")),o("td",[o("vxe-checkbox",{props:{title:_conf.default.i18n("vxe.toolbar.expHeaderTitle")},model:{value:n.isHeader,callback:function(e){n.isHeader=e}}},_conf.default.i18n("vxe.toolbar.expOptHeader")),o("vxe-checkbox",{props:{disabled:!r.hasFooter,title:_conf.default.i18n("vxe.toolbar.expFooterTitle")},model:{value:n.isFooter,callback:function(e){n.isFooter=e}}},_conf.default.i18n("vxe.toolbar.expOptFooter")),o("vxe-checkbox",{props:{disabled:r.forceOriginal,title:_conf.default.i18n("vxe.toolbar.expOriginalTitle")},model:{value:n.original,callback:function(e){n.original=e}}},_conf.default.i18n(c?"vxe.toolbar.expOptOriginNotImp":"vxe.toolbar.expOptOriginal"))])])]),o("div",{class:"vxe-export--panel-btns"},[o("vxe-button",{on:{click:this.printEvent}},_conf.default.i18n("vxe.toolbar.expPrint")),o("vxe-button",{props:{type:"primary"},on:{click:this.exportEvent}},_conf.default.i18n("vxe.toolbar.expConfirm"))])])])},methods:{checkStatus:function(){var e=this.storeData.columns;this.isAll=this.storeData.columns.every(function(e){return e.disabled||e.checked}),this.isIndeterminate=!this.isAll&&e.some(function(e){return!e.disabled&&e.checked})},allColumnEvent:function(){var t=this.isAll;this.storeData.columns.forEach(function(e){e.disabled||(e.checked=t)}),this.checkStatus()},showEvent:function(){var e=this;this.$nextTick(function(){e.$refs.filename.focus()}),this.checkStatus()},getExportOption:function(){var e=this.storeData,t=this.defaultOptions,o=this.$parent,l=o.$grid,i=o.$table,a=l||i,n=e.selectRecords,r=Object.assign({columns:e.columns.filter(function(e){return e.checked})},t);return"selected"===e.mode&&(_xeUtils.default.includes(["html","pdf"],t.type)&&a.treeConfig?r.data=_xeUtils.default.searchTree(a.getTableData().fullData,function(e){return-1<n.indexOf(e)},a.getTreeStatus().config):r.data=n),r},printEvent:function(){this.storeData.visible=!1,this.$emit("print",this.getExportOption())},exportEvent:function(){this.storeData.visible=!1,this.$emit("export",this.getExportOption())}}};exports.default=_default;