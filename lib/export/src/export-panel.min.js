"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools"),_xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={name:"VxeExportPanel",props:{defaultOptions:Object,storeData:Object},data:function(){return{isAll:!1,isIndeterminate:!1,modeList:[{value:"all",label:"vxe.toolbar.expAll"},{value:"selected",label:"vxe.toolbar.expSelected"}]}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},showSheet:function(){return["html","xml","xlsx"].includes(this.defaultOptions.type)}},render:function(n){var a=this,e=this._e,t=this.isAll,o=this.isIndeterminate,l=this.showSheet,i=this.defaultOptions,s=this.storeData,r=this.modeList;return n("vxe-modal",{res:"modal",model:{value:s.visible,callback:function(e){s.visible=e}},props:{title:_conf.default.i18n("vxe.toolbar.expTitle"),width:660,mask:!0,lockView:!0,showFooter:!1,maskClosable:!0},on:{show:this.showEvent}},[n("div",{class:"vxe-export--panel"},[n("table",{attrs:{cellspacing:0,cellpadding:0,border:0}},[n("tr",[n("td",_conf.default.i18n("vxe.toolbar.expName")),n("td",[n("input",{ref:"filename",attrs:{type:"text",placeholder:_conf.default.i18n("vxe.toolbar.expNamePlaceholder")},domProps:{value:i.filename},on:{input:function(e){i.filename=e.target.value}}})])]),n("tr",[n("td",_conf.default.i18n("vxe.toolbar.expType")),n("td",[n("select",{on:{change:function(e){i.type=e.target.value}}},i.types.map(function(e){return n("option",{attrs:{value:e.value},domProps:{selected:i.type===e.value}},_conf.default.i18n(e.label))}))])]),l?n("tr",[n("td",_conf.default.i18n("vxe.toolbar.expSheetName")),n("td",[n("input",{attrs:{type:"text",placeholder:_conf.default.i18n("vxe.toolbar.expSheetNamePlaceholder")},domProps:{value:i.sheetName},on:{input:function(e){i.sheetName=e.target.value}}})])]):e(),n("tr",[n("td",_conf.default.i18n("vxe.toolbar.expMode")),n("td",[n("select",{on:{change:function(e){s.mode=e.target.value}}},r.map(function(e){return n("option",{attrs:{value:e.value},domProps:{selected:s.mode===e.value}},_conf.default.i18n(e.label))}))])]),n("tr",[n("td",[_conf.default.i18n("vxe.toolbar.expColumn")]),n("td",[n("div",{class:"vxe-export--panel-column"},[n("vxe-checkbox",{props:{indeterminate:o},model:{value:t,callback:function(e){a.isAll=e}},on:{change:this.allColumnEvent}},_conf.default.i18n("vxe.toolbar.expAllColumn")),n("ul",s.columns.map(function(e){var t=e.own,o=e.checked,l=e.type;return n("li",{class:{active:o},on:{click:function(){e.checked=!o,a.checkStatus()}}},_tools.UtilTools.getFuncText(t.title||t.label||("index"===l?_conf.default.i18n("vxe.column.indexTitle"):"")))}))])])]),n("tr",[n("td",_conf.default.i18n("vxe.toolbar.expOpts")),n("td",[n("vxe-checkbox",{model:{value:i.isHeader,callback:function(e){i.isHeader=e}}},_conf.default.i18n("vxe.toolbar.expOptHeader")),n("vxe-checkbox",{props:{disabled:!s.hasFooter},model:{value:i.isFooter,callback:function(e){i.isFooter=e}}},_conf.default.i18n("vxe.toolbar.expOptFooter")),n("vxe-checkbox",{props:{disabled:s.forceOriginal},model:{value:i.original,callback:function(e){i.original=e}}},_conf.default.i18n("vxe.toolbar.expOptOriginal"))])])]),n("div",{class:"vxe-export--panel-btns"},[n("vxe-button",{on:{click:this.printEvent}},_conf.default.i18n("vxe.toolbar.expPrint")),n("vxe-button",{props:{type:"primary"},on:{click:this.exportEvent}},_conf.default.i18n("vxe.toolbar.expConfirm"))])])])},methods:{checkStatus:function(){var e=this.storeData.columns;this.isAll=this.storeData.columns.every(function(e){return e.checked}),this.isIndeterminate=!this.isAll&&e.some(function(e){return e.checked})},allColumnEvent:function(){var t=this.isAll;this.storeData.columns.forEach(function(e){e.checked=t}),this.checkStatus()},showEvent:function(){var e=this;this.$nextTick(function(){e.$refs.filename.focus()}),this.checkStatus()},printEvent:function(){var e=this.storeData,t=this.defaultOptions,o=this.$parent,l=o.$grid,n=o.$table,a=l||n,i=a.treeConfig,s=e.selectRecords,r=Object.assign({columns:e.columns.filter(function(e){return e.checked})},t);"selected"===e.mode&&(r.data=i?_xeUtils.default.searchTree(a.tableFullData,function(e){return-1<s.indexOf(e)},i):s),this.storeData.visible=!1,this.$emit("print",r)},exportEvent:function(){var e=this.storeData,t=this.defaultOptions,o=Object.assign({columns:e.columns.filter(function(e){return e.checked})},t);"selected"===e.mode&&(o.data=e.selectRecords),this.$emit("export",o)}}};exports.default=_default;