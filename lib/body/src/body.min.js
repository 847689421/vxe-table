"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),i=l.indexOf(r);e.active=-1<n&&-1<i,e.top=0===n&&-1<i,e.bottom=n===o.length-1&&-1<i,e.left=-1<n&&0===i,e.right=-1<n&&i===l.length-1}function countTreeExpand(e,o){var l=o.$table,t=e[l.treeOpts.children],r=1;if(l.isTreeExpandByRow(e))for(var n=0;n<t.length;n++)r+=countTreeExpand(t[n],o);return r}function getOffsetSize(e){switch(e.vSize){case"mini":return 3;case"small":return 2;case"medium":return 1}return 0}function calcTreeLine(e,o){var l=e.$table,t=e.$rowIndex,r=1;return t&&(r=countTreeExpand(o[t-1],e)),l.rowHeight*r-(t?1:12-getOffsetSize(l))}function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.optimizeOpts.delayHover}function renderColumn(e,o,l,t,r,n,i,c,s,d,a,u,p,f,h){var x,w,y=l._e,m=l.$listeners,g=l.tableData,v=l.height,b=l.overflowX,_=l.scrollXLoad,$=l.scrollYLoad,T=l.border,I=l.highlightCurrentRow,S=l.showOverflow,P=l.showAllOverflow,k=l.align,L=l.currentColumn,C=l.cellClassName,O=l.cellStyle,q=l.spanMethod,R=l.keyboardConfig,E=l.expandOpts,U=l.radioOpts,H=l.checkboxOpts,D=l.treeOpts,B=l.mouseConfig,M=l.editConfig,N=l.editRules,W=l.validOpts,z=l.editStore,Y=l.validStore,A=_xeUtils.default.isBoolean(P)?P:S,X=u.editRender,F=u.align,K=u.showOverflow,j=u.renderWidth,G=u.columnKey,V=u.className,J=u.treeNode,Q=z.checked,Z=z.selected,ee=z.actived,oe=z.copyed,le=B&&B.selected,te=B&&B.checked,re=R&&R.isCut,ne=i?u.fixed!==i:u.fixed&&b,ie=_xeUtils.default.isUndefined(K)||_xeUtils.default.isNull(K)?A:K,ce=F||k,se="ellipsis"===ie,de="title"===ie,ae=!0===ie||"tooltip"===ie,ue=de||ae||se,pe={},fe={},he={},xe={},we=Y.row===s&&Y.column===u,ye=N&&("default"===W.message?v||1<g.length:"inline"===W.message),me={"data-colid":u.id},ge=X&&M&&"dblclick"===M.trigger,ve={$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,isHidden:ne,data:g,items:h};if(!_&&!$||ue||(se=ue=!0),(de||ae||m["cell-mouseenter"])&&(pe.mouseenter=function(e){if(!isOperateMouse(l)){var o={$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.currentTarget};de?_tools.DomTools.updateCellTitle(e):ae&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}}),(ae||m["cell-mouseleave"])&&(pe.mouseleave=function(e){isOperateMouse(l)||(ae&&l.handleTargetLeaveEvent(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.currentTarget},e]))}),pe.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.currentTarget})},(I||m["cell-click"]||X&&M||"row"===E.trigger||"cell"===E.trigger||"row"===U.trigger||"radio"===u.type&&"cell"===U.trigger||"row"===H.trigger||"checkbox"===u.type|"selection"===u.type&&"cell"===H.trigger||"row"===D.trigger||u.treeNode&&"cell"===D.trigger)&&(pe.click=function(e){l.triggerCellClickEvent(e,{$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.currentTarget})}),(ge||m["cell-dblclick"])&&(pe.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.currentTarget})}),q){var be=q(ve)||{},_e=be.rowspan,$e=void 0===_e?1:_e,Te=be.colspan,Ie=void 0===Te?1:Te;if(!$e||!Ie)return null;me.rowspan=$e,me.colspan=Ie}return!ne&&M&&M.showStatus&&(w=l.isUpdateByRow(s,u.property)),ne||i||(te&&(handleLocation(fe,Q.rows,Q.columns,s,u),handleLocation(he,Q.tRows,Q.tColumns,s,u)),re&&handleLocation(xe,oe.rows,oe.columns,s,u)),e("td",{class:["vxe-body--column",u.id,(_defineProperty(x={},"col--".concat(ce),ce),_defineProperty(x,"col--".concat(u.type),u.type),_defineProperty(x,"col--tree-node",J),_defineProperty(x,"col--edit",X),_defineProperty(x,"col--checked",fe.active),_defineProperty(x,"col--checked-top",fe.top),_defineProperty(x,"col--checked-bottom",fe.bottom),_defineProperty(x,"col--checked-left",fe.left),_defineProperty(x,"col--checked-right",fe.right),_defineProperty(x,"col--checked-temp",he.active),_defineProperty(x,"col--checked-temp-top",he.top),_defineProperty(x,"col--checked-temp-bottom",he.bottom),_defineProperty(x,"col--checked-temp-left",he.left),_defineProperty(x,"col--checked-temp-right",he.right),_defineProperty(x,"col--selected",le&&X&&Z.row===s&&Z.column===u),_defineProperty(x,"col--copyed",xe.active),_defineProperty(x,"col--copyed-top",xe.top),_defineProperty(x,"col--copyed-bottom",xe.bottom),_defineProperty(x,"col--copyed-left",xe.left),_defineProperty(x,"col--copyed-right",xe.right),_defineProperty(x,"col--ellipsis",ue),_defineProperty(x,"col--actived",M&&X&&ee.row===s&&(ee.column===u||"row"===M.mode)),_defineProperty(x,"col--dirty",w),_defineProperty(x,"col--valid-error",we),_defineProperty(x,"col--current",L===u),_defineProperty(x,"edit--visible",X&&"visible"===X.type),_defineProperty(x,"fixed--hidden",ne),x),_tools.UtilTools.getClass(V,ve),_tools.UtilTools.getClass(C,ve)],key:G||(l.columnKey?u.id:p),attrs:me,style:O?_xeUtils.default.isFunction(O)?O(ve):O:null,on:pe},A&&ne?[]:renderLine(e,o,l,c,h,ve).concat([e("div",{class:["vxe-cell",{"c--title":de,"c--tooltip":ae,"c--ellipsis":se}],style:{width:ue?"".concat(T?j-2:j,"px"):null}},u.renderCell(e,ve)),ye?we?e("div",{class:"vxe-cell--valid",style:Y.rule&&Y.rule.width?{width:"".concat(Y.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},Y.content)]):y():null,te&&!i?e("span",{class:"vxe-body--column-checked-lt"}):null,te&&!i?e("span",{class:"vxe-body--column-checked-rb"}):null,re&&!i?e("span",{class:"vxe-body--column-copyed-lt"}):null,re&&!i?e("span",{class:"vxe-body--column-copyed-rb"}):null,fe.bottom&&fe.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,$seq:t,seq:r,rowid:n,row:s,rowIndex:d,$rowIndex:a,column:u,columnIndex:p,$columnIndex:f,fixed:i,level:c,cell:e.target.parentNode},e)}}}):null]))}function renderLine(e,o,l,t,r,n){var i=n.column,c=l.treeConfig,s=l.treeOpts;return i.slots&&i.slots.line?i.slots.line.call(l,n,e):i.treeNode&&c&&s.line?[e("div",{class:"vxe-tree--line-wrapper"},[e("div",{class:"vxe-tree--line",style:{height:"".concat(calcTreeLine(n,r),"px"),left:"".concat(t*s.indent+(t?2-getOffsetSize(l):0)+16,"px")}})])]:[]}function renderRows(u,p,f,h,x,w,y,m){var g=f.stripe,v=f.rowKey,b=f.highlightHoverRow,_=f.highlightCurrentRow,$=f.rowClassName,T=f.rowStyle,I=f.currentRow,S=f.hoverRow,P=f.treeConfig,k=f.treeOpts,L=f.treeExpandeds,C=f.scrollYLoad,O=f.scrollYStore,q=f.editStore,R=f.rowExpandeds,E=f.radioOpts,U=f.checkboxOpts,H=f.getColumnMapIndex,D=[];return y.forEach(function(t,r){var e,o={},n=r,i=n+1;C&&(i+=O.startIndex),n=f.getRowIndex(t),b&&(o.mouseenter=function(e){isOperateMouse(f)||t!==S&&f.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){isOperateMouse(f)||(f.hoverRow=null)});var c=_tools.UtilTools.getRowid(f,t,n);if(D.push(u("tr",{class:["vxe-body--row",(_defineProperty(e={"row--stripe":g&&0<n&&(n+1)%2==0},"row--level-".concat(x),P),_defineProperty(e,"row--current",_&&t===I),_defineProperty(e,"row--hover",t===S),_defineProperty(e,"row--new",-1<q.insertList.indexOf(t)),_defineProperty(e,"row--radio",E.highlight&&f.selectRow===t),_defineProperty(e,"row--cheched",U.highlight&&f.isCheckedByRow(t)),e),$?_xeUtils.default.isFunction($)?$({$table:f,$seq:h,seq:i,rowid:c,fixedType:w,rowLevel:x,row:t,rowIndex:n,$rowIndex:r}):$:""],attrs:{"data-rowid":c},style:T?_xeUtils.default.isFunction(T)?T({$table:f,$seq:h,seq:i,rowid:c,fixedType:w,rowLevel:x,row:t,rowIndex:n,$rowIndex:r}):T:null,key:v||P?c:r,on:o},m.map(function(e,o){var l=H(e);return renderColumn(u,p,f,h,i,c,w,x,t,n,r,e,l,o,y)}))),R.length&&-1<R.indexOf(t)){var l,s=_xeUtils.default.find(m,function(e){return"expand"===e.type}),d=H(s);P&&(l={paddingLeft:"".concat(x*k.indent+30,"px")}),s&&D.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(c),style:T?_xeUtils.default.isFunction(T)?T({$table:f,$seq:h,seq:i,rowid:c,fixedType:w,rowLevel:x,row:t,rowIndex:n,$rowIndex:r,isExpanded:!0}):T:null,on:o},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:m.length}},[u("div",{class:["vxe-body--expanded-cell",{"fixed--hidden":w}],style:l},[s.renderData(u,{$table:f,seq:i,rowid:c,row:t,rowIndex:n,column:s,columnIndex:d,fixed:w,level:x})])])]))}if(P&&L.length){var a=t[k.children];a&&a.length&&-1<L.indexOf(t)&&D.push.apply(D,renderRows(u,p,f,h?"".concat(h,".").concat(i):"".concat(i),x+1,w,a,m))}}),D}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this._e,o=this.$parent,t=this.fixedColumn,r=this.fixedType,n=o.$scopedSlots,i=o.loading,c=o.maxHeight,s=o.height,d=o.parentHeight,a=o.tableData,u=o.tableColumn,p=o.headerHeight,f=o.showFooter,h=o.showOverflow,x=o.showAllOverflow,w=o.footerHeight,y=o.tableHeight,m=o.tableWidth,g=o.overflowY,v=o.scrollbarHeight,b=o.scrollbarWidth,_=o.scrollXStore,$=o.scrollXLoad,T=o.scrollYStore,I=_xeUtils.default.isBoolean(x)?x:h,S=0,P={};s&&(S="auto"===s?d:_tools.DomTools.isScale(s)?Math.floor(parseInt(s)/100*d):_xeUtils.default.toNumber(s),f&&(S+=v+1)),c?(c="auto"===c?d:_tools.DomTools.isScale(c)?Math.floor(parseInt(c)/100*d):_xeUtils.default.toNumber(c),P.maxHeight="".concat(r?c-p-(f?0:v):c-p,"px")):0<S&&(P.height="".concat(r?(0<S?S-p-w:y)-(f?0:v):S-p-w,"px")),r&&I?m=(u=t).reduce(function(e,o){return e+o.renderWidth},0):$&&(r&&(u=t),m=u.reduce(function(e,o){return e+o.renderWidth},0));var k={width:m?"".concat(m,"px"):m,marginTop:T.topSpaceHeight?"".concat(T.topSpaceHeight,"px"):null,marginLeft:r?null:_.leftSpaceWidth?"".concat(_.leftSpaceWidth,"px"):null};return g&&r&&(_tools.DomTools.browse["-moz"]||_tools.DomTools.browse.safari)&&(k.paddingRight="".concat(b,"px")),l("div",{class:["vxe-table--body-wrapper",r?"fixed--".concat(r,"-wrapper"):"body--wrapper"],style:P},[r?e():l("div",{class:"vxe-body--x-space",style:{width:"".concat(o.tableWidth,"px")}}),l("div",{class:"vxe-body--y-space",style:{height:"".concat(T.ySpaceHeight,"px")}}),l("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},style:k},[l("colgroup",u.map(function(e,o){return l("col",{attrs:{name:e.id},style:{width:"".concat(e.renderWidth,"px")},key:o})})),l("tbody",renderRows(l,this,o,"",0,r,a,u))]),r?null:l("div",{class:["vxe-table--empty-block",i||a.length?"":"is--empty"],style:{width:m?"".concat(m,"px"):m}},[l("div",{class:"vxe-table--empty-content"},n.empty?n.empty.call(this,{$table:this},l):_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=this.lastScrollTop,r=this.lastScrollLeft,n=o.$refs,i=o.highlightHoverRow,c=o.scrollXLoad,s=o.scrollYLoad,d=o.triggerScrollXEvent,a=o.triggerScrollYEvent,u=n.tableHeader,p=n.tableBody,f=n.leftBody,h=n.rightBody,x=n.tableFooter,w=u?u.$el:null,y=x?x.$el:null,m=p.$el,g=f?f.$el:null,v=h?h.$el:null,b=m.scrollTop,_=m.scrollLeft,$=r!==_,T=t!==b;i&&o.clearHoverRow(),g&&"left"===l?syncBodyScroll(b=g.scrollTop,m,v):v&&"right"===l?syncBodyScroll(b=v.scrollTop,m,g):(w&&(w.scrollLeft=m.scrollLeft),y&&(y.scrollLeft=m.scrollLeft),(g||v)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(b,g,v))),c&&d(e),s&&a(e),o.lastScrollTop=b,o.lastScrollLeft=_,o.lastScrollTime=Date.now(),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:b,scrollLeft:_,isX:$,isY:T,$table:o},e])}}};exports.default=_default;