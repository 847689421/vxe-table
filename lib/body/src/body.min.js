"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),i=l.indexOf(r);e.active=-1<n&&-1<i,e.top=0===n&&-1<i,e.bottom=n===o.length-1&&-1<i,e.left=-1<n&&0===i,e.right=-1<n&&i===l.length-1}function countTreeExpand(e,o){var l=o.$table,t=e[l.treeConfig.children],r=1;if(l.isTreeExpandByRow(e))for(var n=0;n<t.length;n++)r+=countTreeExpand(t[n],o);return r}function calcTreeLine(e,o){var l=e.$table,t=e.$rowIndex,r=1;return t&&(r=countTreeExpand(o[t-1],e)),l.rowHeight*r-(t?1:8)}function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.optimizeOpts.delayHover}function renderColumn(e,o,l,t,r,n,i,c,s,d,a,u,p,f){var x,h,y=l._e,g=l.$listeners,m=l.tableData,v=l.height,w=l.overflowX,b=l.scrollXLoad,_=l.scrollYLoad,T=l.border,$=l.highlightCurrentRow,I=l.showOverflow,P=l.showAllOverflow,S=l.align,C=l.currentColumn,L=l.cellClassName,k=l.cellStyle,E=l.spanMethod,R=l.keyboardConfig,q=l.expandConfig,U=void 0===q?{}:q,O=l.radioConfig,D=void 0===O?{}:O,H=l.treeConfig,B=void 0===H?{}:H,M=l.mouseConfig,N=l.editConfig,W=l.editRules,X=l.validOpts,Y=l.editStore,A=l.validStore,F=l.checkboxConfig||l.selectConfig||{},z=_xeUtils.default.isBoolean(P)?P:I,K=a.editRender,j=a.align,G=a.showOverflow,V=a.renderWidth,J=a.columnKey,Q=a.className,Z=a.treeNode,ee=Y.checked,oe=Y.selected,le=Y.actived,te=Y.copyed,re=M&&M.selected,ne=M&&M.checked,ie=R&&R.isCut,ce=n?a.fixed!==n:a.fixed&&w,se=_xeUtils.default.isUndefined(G)||_xeUtils.default.isNull(G)?z:G,de=j||S,ae="ellipsis"===se,ue="title"===se,pe=!0===se||"tooltip"===se,fe=ue||pe||ae,xe={},he={},ye={},ge={},me=A.row===c&&A.column===a,ve=W&&("default"===X.message?v||1<m.length:"inline"===X.message),we={"data-colid":a.id},be=K&&N&&"dblclick"===N.trigger,_e={$table:l,$seq:t,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,isHidden:ce,data:m};if(!b&&!_||fe||(ae=fe=!0),(ue||pe||g["cell-mouseenter"])&&(xe.mouseenter=function(e){if(!isOperateMouse(l)){var o={$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget};ue?_tools.DomTools.updateCellTitle(e):pe&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}}),(pe||g["cell-mouseleave"])&&(xe.mouseleave=function(e){isOperateMouse(l)||(pe&&l.handleTargetLeaveEvent(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget},e]))}),xe.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})},($||g["cell-click"]||K&&N||"row"===U.trigger||"cell"===U.trigger||"row"===D.trigger||"radio"===a.type&&"cell"===D.trigger||"row"===F.trigger||"checkbox"===a.type|"selection"===a.type&&"cell"===F.trigger||"row"===B.trigger||a.treeNode&&"cell"===B.trigger)&&(xe.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),(be||g["cell-dblclick"])&&(xe.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),E){var Te=E(_e)||{},$e=Te.rowspan,Ie=void 0===$e?1:$e,Pe=Te.colspan,Se=void 0===Pe?1:Pe;if(!Ie||!Se)return null;we.rowspan=Ie,we.colspan=Se}return!ce&&N&&N.showStatus&&(h=l.isUpdateByRow(c,a.property)),ce||n||(ne&&(handleLocation(he,ee.rows,ee.columns,c,a),handleLocation(ye,ee.tRows,ee.tColumns,c,a)),ie&&handleLocation(ge,te.rows,te.columns,c,a)),e("td",{class:["vxe-body--column",a.id,(x={},_defineProperty(x,"col--".concat(de),de),_defineProperty(x,"col--".concat(a.type),a.type),_defineProperty(x,"col--tree-node",Z),_defineProperty(x,"col--edit",K),_defineProperty(x,"col--checked",he.active),_defineProperty(x,"col--checked-top",he.top),_defineProperty(x,"col--checked-bottom",he.bottom),_defineProperty(x,"col--checked-left",he.left),_defineProperty(x,"col--checked-right",he.right),_defineProperty(x,"col--checked-temp",ye.active),_defineProperty(x,"col--checked-temp-top",ye.top),_defineProperty(x,"col--checked-temp-bottom",ye.bottom),_defineProperty(x,"col--checked-temp-left",ye.left),_defineProperty(x,"col--checked-temp-right",ye.right),_defineProperty(x,"col--selected",re&&K&&oe.row===c&&oe.column===a),_defineProperty(x,"col--copyed",ge.active),_defineProperty(x,"col--copyed-top",ge.top),_defineProperty(x,"col--copyed-bottom",ge.bottom),_defineProperty(x,"col--copyed-left",ge.left),_defineProperty(x,"col--copyed-right",ge.right),_defineProperty(x,"col--ellipsis",fe),_defineProperty(x,"col--actived",N&&K&&le.row===c&&(le.column===a||"row"===N.mode)),_defineProperty(x,"col--dirty",h),_defineProperty(x,"col--valid-error",me),_defineProperty(x,"col--current",C===a),_defineProperty(x,"edit--visible",K&&"visible"===K.type),_defineProperty(x,"fixed--hidden",ce),x),_tools.UtilTools.getClass(Q,_e),_tools.UtilTools.getClass(L,_e)],key:J||(l.columnKey?a.id:u),attrs:we,style:k?_xeUtils.default.isFunction(k)?k(_e):k:null,on:xe},z&&ce?[]:[Z&&B&&B.line?e("div",{class:"vxe-tree--line-wrapper"},[e("div",{class:"vxe-tree--line",style:{height:"".concat(calcTreeLine(_e,f),"px"),left:"".concat(i*(B.indent||20)+16,"px")}})]):null,e("div",{class:["vxe-cell",{"c--title":ue,"c--tooltip":pe,"c--ellipsis":ae}],style:{width:fe?"".concat(T?V-1:V,"px"):null}},a.renderCell(e,_e)),ve?me?e("div",{class:"vxe-cell--valid",style:A.rule&&A.rule.width?{width:"".concat(A.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},A.content)]):y():null,ne&&!n?e("span",{class:"vxe-body--column-checked-lt"}):null,ne&&!n?e("span",{class:"vxe-body--column-checked-rb"}):null,ie&&!n?e("span",{class:"vxe-body--column-copyed-lt"}):null,ie&&!n?e("span",{class:"vxe-body--column-copyed-rb"}):null,he.bottom&&he.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.target.parentNode},e)}}}):null])}function renderRows(u,p,f,x,h,y,g,m){var v=f.stripe,w=f.rowKey,b=f.highlightHoverRow,_=f.highlightCurrentRow,T=f.rowClassName,$=f.rowStyle,I=f.currentRow,P=f.hoverRow,S=f.treeConfig,C=f.treeExpandeds,L=f.scrollYLoad,k=f.overflowX,e=f.columnStore,E=f.scrollYStore,R=f.editStore,q=f.rowExpandeds,U=f.getColumnMapIndex,O=e.leftList,D=e.rightList,H=[];return g.forEach(function(t,r){var e,o={},n=r,i=n+1;L&&(i+=E.startIndex),n=f.getRowIndex(t),b&&(O.length||D.length)&&k&&(o.mouseenter=function(e){isOperateMouse(f)||t!==P&&f.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){isOperateMouse(f)||(f.hoverRow=null)});var l=_tools.UtilTools.getRowid(f,t,n);if(H.push(u("tr",{class:["vxe-body--row",(e={"row--stripe":v&&0<n&&(n+1)%2==0},_defineProperty(e,"row--level-".concat(h),S),_defineProperty(e,"row--current",_&&t===I),_defineProperty(e,"row--hover",t===P),_defineProperty(e,"row--new",-1<R.insertList.indexOf(t)),e),T?_xeUtils.default.isFunction(T)?T({$table:f,$seq:x,seq:i,fixedType:y,rowLevel:h,row:t,rowIndex:n,$rowIndex:r}):T:""],attrs:{"data-rowid":l},style:$?_xeUtils.default.isFunction($)?$({$table:f,$seq:x,seq:i,fixedType:y,rowLevel:h,row:t,rowIndex:n,$rowIndex:r}):$:null,key:w||S?l:r,on:o},m.map(function(e,o){var l=U(e);return renderColumn(u,p,f,x,i,y,h,t,n,r,e,l,o,g)}))),q.length&&-1<q.indexOf(t)){var c,s=_xeUtils.default.find(m,function(e){return"expand"===e.type}),d=U(s);S&&(c={paddingLeft:"".concat(h*(S.indent||16)+30,"px")}),s&&H.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(l),style:$?_xeUtils.default.isFunction($)?$({$table:f,$seq:x,seq:i,fixedType:y,rowLevel:h,row:t,rowIndex:n,$rowIndex:r,isExpanded:!0}):$:null,on:o},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:m.length}},[u("div",{class:["vxe-body--expanded-cell",{"fixed--hidden":y}],style:c},[s.renderData(u,{$table:f,seq:i,row:t,rowIndex:n,column:s,columnIndex:d,fixed:y,level:h})])])]))}if(S&&C.length){var a=t[S.children];a&&a.length&&-1<C.indexOf(t)&&H.push.apply(H,renderRows(u,p,f,x?"".concat(x,".").concat(i):"".concat(i),h+1,y,a,m))}}),H}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this._e,o=this.$parent,t=this.fixedColumn,r=this.fixedType,n=o.$scopedSlots,i=o.loading,c=o.maxHeight,s=o.height,d=o.containerHeight,a=o.tableData,u=o.tableColumn,p=o.headerHeight,f=o.showFooter,x=o.showOverflow,h=o.showAllOverflow,y=o.footerHeight,g=o.tableHeight,m=o.tableWidth,v=o.overflowY,w=o.scrollbarHeight,b=o.scrollbarWidth,_=o.scrollXStore,T=o.scrollXLoad,$=o.scrollYStore,I=_xeUtils.default.isBoolean(h)?h:x,P=0,S={};s&&(P="auto"===s?d:_tools.DomTools.isScale(s)?Math.floor(parseInt(s)/100*d):_xeUtils.default.toNumber(s),f&&(P+=w+1)),0<P?S.height="".concat(r?(0<P?P-p-y:g)-(f?0:w):P-p-y,"px"):c&&(c=_tools.DomTools.isScale(c)?Math.floor(parseInt(c)/100*d):_xeUtils.default.toNumber(c),S["max-height"]="".concat(r?c-p-(f?0:w):c-p,"px")),r&&I?m=(u=t).reduce(function(e,o){return e+o.renderWidth},0):T&&(r&&(u=t),m=u.reduce(function(e,o){return e+o.renderWidth},0));var C={width:m?"".concat(m,"px"):m,marginTop:$.topSpaceHeight?"".concat($.topSpaceHeight,"px"):null,marginLeft:r?null:_.leftSpaceWidth?"".concat(_.leftSpaceWidth,"px"):null};return v&&r&&(_tools.DomTools.browse["-moz"]||_tools.DomTools.browse.safari)&&(C.paddingRight="".concat(b,"px")),l("div",{class:["vxe-table--body-wrapper",r?"fixed--".concat(r,"-wrapper"):"body--wrapper"],style:S},[r?e():l("div",{class:"vxe-body--x-space",style:{width:"".concat(o.tableWidth,"px")}}),l("div",{class:"vxe-body--y-space",style:{height:"".concat($.ySpaceHeight,"px")}}),l("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},style:C},[l("colgroup",u.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,o,"",0,r,a,u))]),r||i||a.length?null:l("div",{class:"vxe-table--empty-block",style:{width:m?"".concat(m,"px"):m}},[l("div",{class:"vxe-table--empty-content"},n.empty?n.empty.call(this,{$table:this},l):_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=this.lastScrollTop,r=this.lastScrollLeft,n=o.$refs,i=o.highlightHoverRow,c=o.scrollXLoad,s=o.scrollYLoad,d=o.triggerScrollXEvent,a=o.triggerScrollYEvent,u=n.tableHeader,p=n.tableBody,f=n.leftBody,x=n.rightBody,h=n.tableFooter,y=u?u.$el:null,g=h?h.$el:null,m=p.$el,v=f?f.$el:null,w=x?x.$el:null,b=m.scrollTop,_=m.scrollLeft,T=r!==_,$=t!==b;i&&o.clearHoverRow(),v&&"left"===l?syncBodyScroll(b=v.scrollTop,m,w):w&&"right"===l?syncBodyScroll(b=w.scrollTop,m,v):(y&&(y.scrollLeft=m.scrollLeft),g&&(g.scrollLeft=m.scrollLeft),(v||w)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(b,v,w))),c&&d(e),s&&a(e),o.lastScrollTop=b,o.lastScrollLeft=_,o.lastScrollTime=Date.now(),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:b,scrollLeft:_,isX:T,isY:$,$table:o},e])}}};exports.default=_default;