"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),i=l.indexOf(r);e.active=-1<n&&-1<i,e.top=0===n&&-1<i,e.bottom=n===o.length-1&&-1<i,e.left=-1<n&&0===i,e.right=-1<n&&i===l.length-1}function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.optimizeOpts.delayHover}function renderColumn(e,o,l,t,r,n,i,c,s,d,a,u,p){var f,h,x=l._e,m=l.$listeners,y=l.tableData,g=l.height,v=l.overflowX,w=l.scrollXLoad,b=l.scrollYLoad,_=l.border,T=l.highlightCurrentRow,$=l.showOverflow,I=l.showAllOverflow,S=l.align,C=l.currentColumn,P=l.cellClassName,k=l.cellStyle,L=l.spanMethod,R=l.keyboardConfig,q=l.expandConfig,O=void 0===q?{}:q,U=l.radioConfig,E=void 0===U?{}:U,D=l.treeConfig,H=void 0===D?{}:D,B=l.mouseConfig,M=l.editConfig,W=l.editRules,N=l.validOpts,X=l.editStore,Y=l.validStore,A=l.checkboxConfig||l.selectConfig||{},F=_xeUtils.default.isBoolean(I)?I:$,z=a.editRender,K=a.align,j=a.showOverflow,G=a.renderWidth,V=a.columnKey,J=a.className,Q=X.checked,Z=X.selected,ee=X.actived,oe=X.copyed,le=B&&B.selected,te=B&&B.checked,re=R&&R.isCut,ne=n?a.fixed!==n:a.fixed&&v,ie=_xeUtils.default.isUndefined(j)||_xeUtils.default.isNull(j)?F:j,ce=K||S,se="ellipsis"===ie,de="title"===ie,ae=!0===ie||"tooltip"===ie,ue=de||ae||se,pe={},fe={},he={},xe={},me=Y.row===c&&Y.column===a,ye=W&&("default"===N.message?g||1<y.length:"inline"===N.message),ge={"data-colid":a.id},ve=z&&M&&"dblclick"===M.trigger,we={$table:l,$seq:t,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,isHidden:ne,data:y};if(!w&&!b||ue||(se=ue=!0),(de||ae||m["cell-mouseenter"])&&(pe.mouseenter=function(e){if(!isOperateMouse(l)){var o={$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget};de?_tools.DomTools.updateCellTitle(e):ae&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}}),(ae||m["cell-mouseleave"])&&(pe.mouseleave=function(e){isOperateMouse(l)||(ae&&l.handleTargetLeaveEvent(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget},e]))}),pe.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})},(T||m["cell-click"]||z&&M||"row"===O.trigger||"cell"===O.trigger||"row"===E.trigger||"radio"===a.type&&"cell"===E.trigger||"row"===A.trigger||"checkbox"===a.type|"selection"===a.type&&"cell"===A.trigger||"row"===H.trigger||a.treeNode&&"cell"===H.trigger)&&(pe.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),(ve||m["cell-dblclick"])&&(pe.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),L){var be=L(we)||{},_e=be.rowspan,Te=void 0===_e?1:_e,$e=be.colspan,Ie=void 0===$e?1:$e;if(!Te||!Ie)return null;ge.rowspan=Te,ge.colspan=Ie}return!ne&&M&&M.showStatus&&(h=l.isUpdateByRow(c,a.property)),ne||n||(te&&(handleLocation(fe,Q.rows,Q.columns,c,a),handleLocation(he,Q.tRows,Q.tColumns,c,a)),re&&handleLocation(xe,oe.rows,oe.columns,c,a)),e("td",{class:["vxe-body--column",a.id,(f={},_defineProperty(f,"col--".concat(ce),ce),_defineProperty(f,"col--edit",z),_defineProperty(f,"col--checked",fe.active),_defineProperty(f,"col--checked-top",fe.top),_defineProperty(f,"col--checked-bottom",fe.bottom),_defineProperty(f,"col--checked-left",fe.left),_defineProperty(f,"col--checked-right",fe.right),_defineProperty(f,"col--checked-temp",he.active),_defineProperty(f,"col--checked-temp-top",he.top),_defineProperty(f,"col--checked-temp-bottom",he.bottom),_defineProperty(f,"col--checked-temp-left",he.left),_defineProperty(f,"col--checked-temp-right",he.right),_defineProperty(f,"col--selected",le&&z&&Z.row===c&&Z.column===a),_defineProperty(f,"col--copyed",xe.active),_defineProperty(f,"col--copyed-top",xe.top),_defineProperty(f,"col--copyed-bottom",xe.bottom),_defineProperty(f,"col--copyed-left",xe.left),_defineProperty(f,"col--copyed-right",xe.right),_defineProperty(f,"col--ellipsis",ue),_defineProperty(f,"col--actived",M&&z&&ee.row===c&&(ee.column===a||"row"===M.mode)),_defineProperty(f,"col--dirty",h),_defineProperty(f,"col--valid-error",me),_defineProperty(f,"col--current",C===a),_defineProperty(f,"edit--visible",z&&"visible"===z.type),_defineProperty(f,"fixed--hidden",ne),f),_tools.UtilTools.getClass(J,we),_tools.UtilTools.getClass(P,we)],key:V||(l.columnKey?a.id:u),attrs:ge,style:k?_xeUtils.default.isFunction(k)?k(we):k:null,on:pe},F&&ne?[]:[e("div",{class:["vxe-cell",{"c--title":de,"c--tooltip":ae,"c--ellipsis":se}],style:{width:ue?"".concat(_?G-1:G,"px"):null}},a.renderCell(e,we)),ye?me?e("div",{class:"vxe-cell--valid",style:Y.rule&&Y.rule.width?{width:"".concat(Y.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},Y.content)]):x():null,te&&!n?e("span",{class:"vxe-body--column-checked-lt"}):null,te&&!n?e("span",{class:"vxe-body--column-checked-rb"}):null,re&&!n?e("span",{class:"vxe-body--column-copyed-lt"}):null,re&&!n?e("span",{class:"vxe-body--column-copyed-rb"}):null,fe.bottom&&fe.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.target.parentNode},e)}}}):null])}function renderRows(u,p,f,h,x,m,e,y){var g=f.stripe,v=f.rowKey,w=f.highlightHoverRow,b=f.highlightCurrentRow,_=f.rowClassName,T=f.rowStyle,$=f.currentRow,I=f.hoverRow,S=f.treeConfig,C=f.treeExpandeds,P=f.scrollYLoad,k=f.overflowX,o=f.columnStore,L=f.scrollYStore,R=f.editStore,q=f.expandeds,O=f.getColumnMapIndex,U=o.leftList,E=o.rightList,D=[];return e.forEach(function(t,r){var e,o={},n=r,i=n+1;P&&(i+=L.startIndex),n=f.getRowIndex(t),w&&(U.length||E.length)&&k&&(o.mouseenter=function(e){isOperateMouse(f)||t!==I&&f.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){isOperateMouse(f)||(f.hoverRow=null)});var l=_tools.UtilTools.getRowid(f,t,n);if(D.push(u("tr",{class:["vxe-body--row",(e={"row--stripe":g&&0<n&&(n+1)%2==0},_defineProperty(e,"row--level-".concat(x),S),_defineProperty(e,"row--current",b&&t===$),_defineProperty(e,"row--hover",t===I),_defineProperty(e,"row--new",-1<R.insertList.indexOf(t)),e),_?_xeUtils.default.isFunction(_)?_({$table:f,$seq:h,seq:i,fixedType:m,rowLevel:x,row:t,rowIndex:n,$rowIndex:r}):_:""],attrs:{"data-rowid":l},style:T?_xeUtils.default.isFunction(T)?T({$table:f,$seq:h,seq:i,fixedType:m,rowLevel:x,row:t,rowIndex:n,$rowIndex:r}):T:null,key:v||S?l:r,on:o},y.map(function(e,o){var l=O(e);return renderColumn(u,p,f,h,i,m,x,t,n,r,e,l,o)}))),q.length&&-1<q.indexOf(t)){var c,s=y.find(function(e){return"expand"===e.type}),d=O(s);S&&(c={paddingLeft:"".concat(x*(S.indent||16)+30,"px")}),s&&D.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(l),style:T?_xeUtils.default.isFunction(T)?T({$table:f,$seq:h,seq:i,fixedType:m,rowLevel:x,row:t,rowIndex:n,$rowIndex:r,isExpanded:!0}):T:null,on:o},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:y.length}},[u("div",{class:["vxe-body--expanded-cell",{"fixed--hidden":m}],style:c},[s.renderData(u,{$table:f,seq:i,row:t,rowIndex:n,column:s,columnIndex:d,fixed:m,level:x})])])]))}if(S&&C.length){var a=t[S.children];a&&a.length&&-1<C.indexOf(t)&&D.push.apply(D,renderRows(u,p,f,h?"".concat(h,".").concat(i):"".concat(i),x+1,m,a,y))}}),D}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this._e,o=this.$parent,t=this.fixedColumn,r=this.fixedType,n=o.$scopedSlots,i=o.maxHeight,c=o.height,s=o.containerHeight,d=o.loading,a=o.tableData,u=o.tableColumn,p=o.headerHeight,f=o.showFooter,h=o.showOverflow,x=o.showAllOverflow,m=o.footerHeight,y=o.tableHeight,g=o.tableWidth,v=o.overflowY,w=o.scrollbarHeight,b=o.scrollbarWidth,_=o.scrollXStore,T=o.scrollXLoad,$=o.scrollYStore,I=_xeUtils.default.isBoolean(x)?x:h,S="auto"===c?s:_tools.DomTools.isScale(c)?Math.floor(parseInt(c)/100*s):_xeUtils.default.toNumber(c),C={};f&&(S+=w+1),0<S?C.height="".concat(r?(0<S?S-p-m:y)-(f?0:w):S-p-m,"px"):i&&(i=_tools.DomTools.isScale(i)?Math.floor(parseInt(i)/100*s):_xeUtils.default.toNumber(i),C["max-height"]="".concat(r?i-p-(f?0:w):i-p,"px")),r&&I?g=(u=t).reduce(function(e,o){return e+o.renderWidth},0):T&&(r&&(u=t),g=u.reduce(function(e,o){return e+o.renderWidth},0));var P={width:g?"".concat(g,"px"):g,marginTop:$.topSpaceHeight?"".concat($.topSpaceHeight,"px"):null,marginLeft:r?null:_.leftSpaceWidth?"".concat(_.leftSpaceWidth,"px"):null};return v&&r&&(_tools.DomTools.browse["-moz"]||_tools.DomTools.browse.safari)&&(P.paddingRight="".concat(b,"px")),l("div",{class:["vxe-table--body-wrapper",r?"fixed--".concat(r,"-wrapper"):"body--wrapper"],style:C},[r?e():l("div",{class:"vxe-body--x-space",style:{width:"".concat(o.tableWidth,"px")}}),l("div",{class:"vxe-body--y-space",style:{height:"".concat($.ySpaceHeight,"px")}}),l("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},style:P},[l("colgroup",u.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,o,"",0,r,a,u))]),r||d||a.length?null:l("div",{class:"vxe-table--empty-block",style:{width:g?"".concat(g,"px"):g}},[l("span",{class:"vxe-table--empty-text"},n.empty?n.empty.call(this,{$table:o},l):_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=this.lastScrollTop,r=this.lastScrollLeft,n=o.$refs,i=o.highlightHoverRow,c=o.scrollXLoad,s=o.scrollYLoad,d=o.triggerScrollXEvent,a=o.triggerScrollYEvent,u=n.tableHeader,p=n.tableBody,f=n.leftBody,h=n.rightBody,x=n.tableFooter,m=u?u.$el:null,y=x?x.$el:null,g=p.$el,v=f?f.$el:null,w=h?h.$el:null,b=g.scrollTop,_=g.scrollLeft,T=r!==_,$=t!==b;i&&o.clearHoverRow(),v&&"left"===l?syncBodyScroll(b=v.scrollTop,g,w):w&&"right"===l?syncBodyScroll(b=w.scrollTop,g,v):(m&&(m.scrollLeft=g.scrollLeft),y&&(y.scrollLeft=g.scrollLeft),(v||w)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(b,v,w))),c&&d(e),s&&a(e),o.lastScrollTop=b,o.lastScrollLeft=_,o.lastScrollTime=Date.now(),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:b,scrollLeft:_,isX:T,isY:$,$table:o},e])}}};exports.default=_default;