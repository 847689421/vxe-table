"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),i=l.indexOf(r);e.active=-1<n&&-1<i,e.top=0===n&&-1<i,e.bottom=n===o.length-1&&-1<i,e.left=-1<n&&0===i,e.right=-1<n&&i===l.length-1}function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.optimizeOpts.delayHover}function renderColumn(e,o,l,t,r,n,i,c,s,d,a,u,p){var f,h,m=l._e,x=l.$listeners,g=l.tableData,y=l.height,v=l.overflowX,w=l.scrollXLoad,b=l.scrollYLoad,_=l.border,T=l.highlightCurrentRow,$=l.showOverflow,I=l.showAllOverflow,C=l.align,P=l.currentColumn,S=l.cellClassName,k=l.spanMethod,L=l.keyboardConfig,R=l.expandConfig,O=void 0===R?{}:R,D=l.radioConfig,E=void 0===D?{}:D,q=l.treeConfig,H=void 0===q?{}:q,U=l.mouseConfig,B=l.editConfig,M=l.editRules,W=l.validOpts,N=l.editStore,X=l.validStore,Y=l.checkboxConfig||l.selectConfig||{},A=_xeUtils.default.isBoolean(I)?I:$,z=a.editRender,F=a.align,K=a.showOverflow,j=a.renderWidth,G=a.columnKey,V=a.className,J=N.checked,Q=N.selected,Z=N.actived,ee=N.copyed,oe=U&&U.selected,le=U&&U.checked,te=L&&L.isCut,re=n?a.fixed!==n:a.fixed&&v,ne=_xeUtils.default.isUndefined(K)||_xeUtils.default.isNull(K)?A:K,ie=F||C,ce="ellipsis"===ne,se="title"===ne,de=!0===ne||"tooltip"===ne,ae=se||de||ce,ue={},pe={},fe={},he={},me=X.row===c&&X.column===a,xe=M&&("default"===W.message?y||1<g.length:"inline"===W.message),ge={"data-colid":a.id},ye=z&&B&&"dblclick"===B.trigger,ve={$table:l,$seq:t,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,isHidden:re,data:g};if(!w&&!b||ae||(ce=ae=!0),(se||de||x["cell-mouseenter"])&&(ue.mouseenter=function(e){if(!isOperateMouse(l)){var o={$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget};se?_tools.DomTools.updateCellTitle(e):de&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}}),(de||x["cell-mouseleave"])&&(ue.mouseleave=function(e){isOperateMouse(l)||(de&&l.handleTargetLeaveEvent(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget},e]))}),ue.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})},(T||x["cell-click"]||z&&B||"row"===O.trigger||"cell"===O.trigger||"row"===E.trigger||"radio"===a.type&&"cell"===E.trigger||"row"===Y.trigger||"checkbox"===a.type|"selection"===a.type&&"cell"===Y.trigger||"row"===H.trigger||a.treeNode&&"cell"===H.trigger)&&(ue.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),(ye||x["cell-dblclick"])&&(ue.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.currentTarget})}),k){var we=k(ve)||{},be=we.rowspan,_e=void 0===be?1:be,Te=we.colspan,$e=void 0===Te?1:Te;if(!_e||!$e)return null;ge.rowspan=_e,ge.colspan=$e}return!re&&B&&B.showStatus&&(h=l.isUpdateByRow(c,a.property)),re||n||(le&&(handleLocation(pe,J.rows,J.columns,c,a),handleLocation(fe,J.tRows,J.tColumns,c,a)),te&&handleLocation(he,ee.rows,ee.columns,c,a)),e("td",{class:["vxe-body--column",a.id,(f={},_defineProperty(f,"col--".concat(ie),ie),_defineProperty(f,"col--edit",z),_defineProperty(f,"col--checked",pe.active),_defineProperty(f,"col--checked-top",pe.top),_defineProperty(f,"col--checked-bottom",pe.bottom),_defineProperty(f,"col--checked-left",pe.left),_defineProperty(f,"col--checked-right",pe.right),_defineProperty(f,"col--checked-temp",fe.active),_defineProperty(f,"col--checked-temp-top",fe.top),_defineProperty(f,"col--checked-temp-bottom",fe.bottom),_defineProperty(f,"col--checked-temp-left",fe.left),_defineProperty(f,"col--checked-temp-right",fe.right),_defineProperty(f,"col--selected",oe&&z&&Q.row===c&&Q.column===a),_defineProperty(f,"col--copyed",he.active),_defineProperty(f,"col--copyed-top",he.top),_defineProperty(f,"col--copyed-bottom",he.bottom),_defineProperty(f,"col--copyed-left",he.left),_defineProperty(f,"col--copyed-right",he.right),_defineProperty(f,"col--ellipsis",ae),_defineProperty(f,"col--actived",B&&z&&Z.row===c&&(Z.column===a||"row"===B.mode)),_defineProperty(f,"col--dirty",h),_defineProperty(f,"col--valid-error",me),_defineProperty(f,"col--current",P===a),_defineProperty(f,"edit--visible",z&&"visible"===z.type),_defineProperty(f,"fixed--hidden",re),f),_tools.UtilTools.getClass(V,ve),_tools.UtilTools.getClass(S,ve)],key:G||(l.columnKey?a.id:u),attrs:ge,on:ue},A&&re?[]:[e("div",{class:["vxe-cell",{"c--title":se,"c--tooltip":de,"c--ellipsis":ce}],style:{width:ae?"".concat(_?j-1:j,"px"):null}},a.renderCell(e,ve)),xe?me?e("div",{class:"vxe-cell--valid",style:X.rule&&X.rule.width?{width:"".concat(X.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},X.content)]):m():null,le&&!n?e("span",{class:"vxe-body--column-checked-lt"}):null,le&&!n?e("span",{class:"vxe-body--column-checked-rb"}):null,te&&!n?e("span",{class:"vxe-body--column-copyed-lt"}):null,te&&!n?e("span",{class:"vxe-body--column-copyed-rb"}):null,pe.bottom&&pe.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:r,row:c,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:p,fixed:n,level:i,cell:e.target.parentNode},e)}}}):null])}function renderRows(u,p,f,h,m,x,e,g){var y=f.stripe,v=f.rowKey,w=f.highlightHoverRow,b=f.highlightCurrentRow,_=f.rowClassName,T=f.currentRow,$=f.hoverRow,I=f.treeConfig,C=f.treeExpandeds,P=f.scrollYLoad,S=f.overflowX,o=f.columnStore,k=f.scrollYStore,L=f.editStore,R=f.expandeds,O=f.getColumnMapIndex,D=o.leftList,E=o.rightList,q=[];return e.forEach(function(t,r){var e,o={},n=r,i=n+1;P&&(i+=k.startIndex),n=f.getRowIndex(t),w&&(D.length||E.length)&&S&&(o.mouseenter=function(e){isOperateMouse(f)||t!==$&&f.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){isOperateMouse(f)||(f.hoverRow=null)});var l=_tools.UtilTools.getRowid(f,t,n);if(q.push(u("tr",{class:["vxe-body--row",(e={"row--stripe":y&&0<n&&(n+1)%2==0},_defineProperty(e,"row--level-".concat(m),I),_defineProperty(e,"row--current",b&&t===T),_defineProperty(e,"row--hover",t===$),_defineProperty(e,"row--new",-1<L.insertList.indexOf(t)),e),_?_xeUtils.default.isFunction(_)?_({$table:f,$seq:h,seq:i,fixedType:x,rowLevel:m,row:t,rowIndex:n,$rowIndex:r}):_:""],attrs:{"data-rowid":l},key:v||I?l:r,on:o},g.map(function(e,o){var l=O(e);return renderColumn(u,p,f,h,i,x,m,t,n,r,e,l,o)}))),R.length&&-1<R.indexOf(t)){var c,s=g.find(function(e){return"expand"===e.type}),d=O(s);I&&(c={paddingLeft:"".concat(m*(I.indent||16)+30,"px")}),s&&q.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(l),on:o},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:g.length}},[u("div",{class:["vxe-body--expanded-cell",{"fixed--hidden":x}],style:c},[s.renderData(u,{$table:f,seq:i,row:t,rowIndex:n,column:s,columnIndex:d,fixed:x,level:m})])])]))}if(I&&C.length){var a=t[I.children];a&&a.length&&-1<C.indexOf(t)&&q.push.apply(q,renderRows(u,p,f,h?"".concat(h,".").concat(i):"".concat(i),m+1,x,a,g))}}),q}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this._e,o=this.$parent,t=this.fixedColumn,r=this.fixedType,n=o.$scopedSlots,i=o.maxHeight,c=o.height,s=o.containerHeight,d=o.loading,a=o.tableData,u=o.tableColumn,p=o.headerHeight,f=o.showFooter,h=o.showOverflow,m=o.showAllOverflow,x=o.footerHeight,g=o.tableHeight,y=o.tableWidth,v=o.overflowY,w=o.scrollbarHeight,b=o.scrollbarWidth,_=o.scrollXStore,T=o.scrollXLoad,$=o.scrollYStore,I=_xeUtils.default.isBoolean(m)?m:h,C="auto"===c?s:_tools.DomTools.isScale(c)?Math.floor(parseInt(c)/100*s):_xeUtils.default.toNumber(c),P={};0<C?P.height="".concat(r?(0<C?C-p-x:g)-(f?0:w):C-p-x,"px"):i&&(i=_tools.DomTools.isScale(i)?Math.floor(parseInt(i)/100*s):_xeUtils.default.toNumber(i),P["max-height"]="".concat(r?i-p-(f?0:w):i-p,"px")),r&&I?y=(u=t).reduce(function(e,o){return e+o.renderWidth},0):T&&(r&&(u=t),y=u.reduce(function(e,o){return e+o.renderWidth},0));var S={width:y?"".concat(y,"px"):y,marginTop:$.topSpaceHeight?"".concat($.topSpaceHeight,"px"):null,marginLeft:r?null:_.leftSpaceWidth?"".concat(_.leftSpaceWidth,"px"):null};return v&&r&&(_tools.DomTools.browse["-moz"]||_tools.DomTools.browse.safari)&&(S.paddingRight="".concat(b,"px")),l("div",{class:["vxe-table--body-wrapper",r?"fixed--".concat(r,"-wrapper"):"body--wrapper"],style:P},[r?e():l("div",{class:"vxe-body--x-space",style:{width:"".concat(o.tableWidth,"px")}}),l("div",{class:"vxe-body--y-space",style:{height:"".concat($.ySpaceHeight,"px")}}),l("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},style:S},[l("colgroup",u.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,o,"",0,r,a,u))]),r||d||a.length?null:l("div",{class:"vxe-table--empty-block",style:{width:y?"".concat(y,"px"):y}},[l("span",{class:"vxe-table--empty-text"},n.empty?n.empty.call(this,{$table:o},l):_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=this.lastScrollTop,r=this.lastScrollLeft,n=o.$refs,i=o.highlightHoverRow,c=o.scrollXLoad,s=o.scrollYLoad,d=o.triggerScrollXEvent,a=o.triggerScrollYEvent,u=n.tableHeader,p=n.tableBody,f=n.leftBody,h=n.rightBody,m=n.tableFooter,x=u?u.$el:null,g=m?m.$el:null,y=p.$el,v=f?f.$el:null,w=h?h.$el:null,b=y.scrollTop,_=y.scrollLeft,T=r!==_,$=t!==b;i&&o.clearHoverRow(),v&&"left"===l?syncBodyScroll(b=v.scrollTop,y,w):w&&"right"===l?syncBodyScroll(b=w.scrollTop,y,v):(x&&(x.scrollLeft=y.scrollLeft),g&&(g.scrollLeft=y.scrollLeft),(v||w)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(b,v,w))),c&&d(e),s&&a(e),o.lastScrollTop=b,o.lastScrollLeft=_,o.lastScrollTime=Date.now(),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:b,scrollLeft:_,isX:T,isY:$,$table:o},e])}}};exports.default=_default;