"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils")),_queue=_interopRequireDefault(require("./queue")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _default2={name:"VxeModal",props:{value:Boolean,id:String,type:{type:String,default:"modal"},status:String,top:{type:[Number,String],default:15},title:String,duration:{type:[Number,String],default:function(){return _conf.default.message.duration}},message:[String,Function],lockView:{type:Boolean,default:function(){return _conf.default.message.lockView}},lockScroll:Boolean,mask:{type:Boolean,default:function(){return _conf.default.message.mask}},maskClosable:Boolean,escClosable:Boolean,resize:Boolean,width:[Number,String],height:[Number,String],zIndex:{type:[Number,String],default:function(){return _conf.default.message.zIndex}},marginSize:{type:[Number,String],default:_conf.default.message.marginSize},animat:{type:Boolean,default:function(){return _conf.default.message.animat}}},data:function(){return{visible:!1,contentVisible:!1,modalTop:0}},computed:{vSize:function(){return this.size||this.$parent&&(this.$parent.size||this.$parent.vSize)},isMsg:function(){return"message"===this.type}},watch:{value:function(e){this[e?"open":"close"]()}},created:function(){this.value&&this.open()},mounted:function(){this.escClosable&&_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),document.body.appendChild(this.$el)},beforeDestroy:function(){_tools.GlobalEvent.off(this,"keydown"),this.removeMsgQueue(),this.$el.parentNode.removeChild(this.$el)},render:function(t){var e,n=this,i=this.vSize,o=this.type,s=this.resize,l=this.animat,c=this.width,a=this.height,u=this.zIndex,r=this.status,d=this.modalTop,f=this.contentVisible,m=this.visible,h=this.title,p=this.message,v=this.lockScroll,b=this.lockView,g=this.mask,y=this.isMsg;return t("div",{class:["vxe-modal--wrapper","type--".concat(o),(e={},_defineProperty(e,"size--".concat(i),i),_defineProperty(e,"status--".concat(r),r),_defineProperty(e,"is--animat",l),_defineProperty(e,"lock--scroll",v),_defineProperty(e,"lock--view",b),_defineProperty(e,"is--mask",g),_defineProperty(e,"is--visible",f),_defineProperty(e,"active",m),e)],style:{zIndex:u,top:d?"".concat(d,"px"):null},on:{click:this.selfClickEvent}},[t("div",{class:"vxe-modal--box",style:{width:c?isNaN(c)?c:"".concat(c,"px"):null,height:a?isNaN(a)?a:"".concat(a,"px"):null},ref:"modalBox"},[y?null:t("div",{class:"vxe-modal--header",on:{mousedown:this.mousedownEvent}},[t("span",{class:"vxe-modal--title"},h?_tools.UtilTools.getFuncText(h):_conf.default.i18n("vxe.alert.title")),t("i",{class:["vxe-modal--close-btn",_conf.default.icon.modalClose],on:{click:this.closeEvent}})]),t("div",{class:"vxe-modal--body"},[r?t("div",{class:"vxe-modal--status-wrapper"},[t("i",{class:["vxe-modal--status-icon",_conf.default.icon["modal".concat(r.replace(/\b(\w)/,function(e){return e.toUpperCase()}))]]})]):null,t("div",{class:"vxe-modal--content"},this.$slots.default||(_xeUtils.default.isFunction(p)?p.call(this,t):p))]),y?null:t("div",{class:"vxe-modal--footer"},["confirm"===o?t("vxe-button",{on:{click:this.cancelEvent}},_conf.default.i18n("vxe.button.cancel")):null,t("vxe-button",{props:{type:"primary"},on:{click:this.confirmEvent}},_conf.default.i18n("vxe.button.confirm"))]),!y&&s?t("span",{class:"vxe-modal--resize"},["wl","wr","swlb","selb","bs"].map(function(e){return t("span",{class:"".concat(e,"-resize"),on:{mousedown:n["".concat(e,"MousedownEvent")]}})})):null])])},methods:{selfClickEvent:function(e){if(this.maskClosable&&e.target===this.$el){this.close("mask")}},closeEvent:function(e){var t="close";this.$emit(t,e),this.close(t)},confirmEvent:function(e){var t="confirm";this.$emit(t,e),this.close(t)},cancelEvent:function(e){var t="cancel";this.$emit(t,e),this.close(t)},open:function(){var s=this,e=this.duration,t=this.visible,n=this._handleCustom,i=this.isMsg;t||(this.visible=!0,this.contentVisible=!1,setTimeout(function(){s.contentVisible=!0},10),n||(this.$emit("input",!0),this.$emit("show")),i?(this.addMsgQueue(),setTimeout(this.close,_xeUtils.default.toNumber(e))):this.$nextTick(function(){var e=s.$refs,t=s.marginSize,n=e.modalBox,i=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight;n.style.left="".concat(i/2-n.offsetWidth/2,"px"),n.offsetHeight+n.offsetTop+t>o&&(n.style.top="".concat(t,"px"))}))},addMsgQueue:function(){-1===_queue.default.indexOf(this)&&_queue.default.push(this),this.updateStyle()},removeMsgQueue:function(){var t=this;-1<_queue.default.indexOf(this)&&_xeUtils.default.remove(_queue.default,function(e){return e===t}),this.updateStyle()},updateStyle:function(){this.$nextTick(function(){var t=0;_queue.default.forEach(function(e){t+=_xeUtils.default.toNumber(e.top),e.modalTop=t,t+=e.$refs.modalBox.clientHeight})})},close:function(e){var t=this,n=this.visible,i=this.isMsg;n&&(i&&this.removeMsgQueue(),this.contentVisible=!1,setTimeout(function(){t.visible=!1,t._handleCustom?t._handleCustom(e):(t.$emit("input",!1),t.$emit("hide",e))},200))},handleGlobalKeydownEvent:function(e){27===e.keyCode&&this.close()},mousedownEvent:function(e){var t=this;if(0===e.button){e.preventDefault();var n=this.$refs,d=this.marginSize,f=n.modalBox,i=document.onmousemove,o=document.onmouseup,m=e.clientX-f.offsetLeft,h=e.clientY-f.offsetTop;document.onmousemove=function(e){e.preventDefault();var t=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight,i=f.offsetWidth,o=f.offsetHeight,s=d,l=t-i-d,c=d,a=n-o-d,u=e.clientX-m,r=e.clientY-h;l<u&&(u=l),u<s&&(u=s),a<r&&(r=a),r<c&&(r=c),f.style.left="".concat(u,"px"),f.style.top="".concat(r,"px"),f.className=f.className.replace(/\s?is--drag/,"")+" is--drag"},document.onmouseup=function(e){document.onmousemove=i,document.onmouseup=o,t.$nextTick(function(){f.className=f.className.replace(/\s?is--drag/,"")})}}},resizeWinEvent:function(s,e){e.preventDefault();var t=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight,l=340,c=t-20,a=n-20,u=this.$refs.modalBox,i=document.onmousemove,o=document.onmouseup,r=u.clientWidth,d=u.clientHeight,f=e.clientX,m=e.clientY;switch(s){case"l-w":case"lb-sw":u.style.right="".concat(t-r-u.offsetLeft,"px"),u.style.left="auto";break;case"r-w":case"lb-se":u.style.left="".concat(u.offsetLeft,"px"),u.style.right="auto"}document.onmousemove=function(e){var t,n,i,o;switch(e.preventDefault(),s){case"l-w":i=(t=f-e.clientX)+r,u.style.width="".concat(l<i?i<c?i:c:l,"px");break;case"lb-sw":t=f-e.clientX,n=e.clientY-m,i=t+r,o=n+d,u.style.width="".concat(l<i?i<c?i:c:l,"px"),u.style.height="".concat(200<o?o<a?o:a:200,"px");break;case"r-w":i=(t=e.clientX-f)+r,u.style.width="".concat(l<i?i<c?i:c:l,"px");break;case"lb-se":t=e.clientX-f,n=e.clientY-m,i=t+r,o=n+d,u.style.width="".concat(l<i?i<c?i:c:l,"px"),u.style.height="".concat(200<o?o<a?o:a:200,"px");break;case"b-s":o=(n=e.clientY-m)+d,u.style.height="".concat(200<o?o<a?o:a:200,"px")}u.className=u.className.replace(/\s?is--drag/,"")+" is--drag"},document.onmouseup=function(e){document.onmousemove=i,document.onmouseup=o,setTimeout(function(){u.className=u.className.replace(/\s?is--drag/,"")},50)}},wlMousedownEvent:function(e){this.resizeWinEvent("l-w",e)},wrMousedownEvent:function(e){this.resizeWinEvent("r-w",e)},swlbMousedownEvent:function(e){this.resizeWinEvent("lb-sw",e)},selbMousedownEvent:function(e){this.resizeWinEvent("lb-se",e)},bsMousedownEvent:function(e){this.resizeWinEvent("b-s",e)}}};exports.default=_default2;