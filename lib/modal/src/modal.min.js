"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils")),_queue=_interopRequireDefault(require("./queue")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _default2={name:"VxeModal",props:{value:Boolean,id:String,type:String,status:String,top:{type:Number,default:15},title:String,duration:{type:Number,default:function(){return _conf.default.message.duration}},message:[String,Function],lockView:{type:Boolean,default:function(){return _conf.default.message.lockView}},lockScroll:{type:Boolean,default:function(){return _conf.default.message.lockScroll}},mask:{type:Boolean,default:function(){return _conf.default.message.mask}},maskClosable:Boolean,escClosable:Boolean,zIndex:{type:Number,default:function(){return _conf.default.message.zIndex}},animat:{type:Boolean,default:function(){return _conf.default.message.animat}}},data:function(){return{visible:!1,contentVisible:!1,beforeLockStyle:null,msgTop:0}},computed:{vSize:function(){return this.size||this.$parent&&(this.$parent.size||this.$parent.vSize)},isMsg:function(){return"message"===this.type}},watch:{value:function(e){this[e?"open":"close"]()}},created:function(){this.value&&this.open()},mounted:function(){this.escClosable&&_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),document.body.appendChild(this.$el)},beforeDestroy:function(){_tools.GlobalEvent.off(this,"keydown"),this.removeMsgQueue(),this.$el.parentNode.removeChild(this.$el)},render:function(e){var t,n=this.vSize,i=this.type,o=this.animat,s=this.zIndex,l=this.status,u=this.msgTop,c=this.contentVisible,a=this.visible,r=this.title,d=this.message,f=this.lockView,m=this.mask,h=this.isMsg;return e("div",{class:["vxe-msg--wrapper","type--".concat(i),(t={},_defineProperty(t,"size--".concat(n),n),_defineProperty(t,"msg--".concat(l),l),_defineProperty(t,"is--animat",o),_defineProperty(t,"lock--view",f),_defineProperty(t,"is--mask",m),_defineProperty(t,"is--visible",c),_defineProperty(t,"active",a),t)],style:{zIndex:s,top:u?"".concat(u,"px"):null},on:{click:this.selfClickEvent}},[e("div",{class:"vxe-msg--box",ref:"msgBox"},[h?null:e("div",{class:"vxe-msg--header",on:{mousedown:this.mousedownEvent}},[e("span",{class:"vxe-msg--title"},r?_tools.UtilTools.getFuncText(r):_conf.default.i18n("vxe.alert.title")),e("i",{class:["vxe-msg--close-btn",_conf.default.icon.msgClose],on:{click:this.closeEvent}})]),e("div",{class:"vxe-msg--body"},[l?e("div",{class:"vxe-msg--status-wrapper"},[e("i",{class:["vxe-msg--status-icon",_conf.default.icon["msg".concat(l.replace(/\b(\w)/,function(e){return e.toUpperCase()}))]]})]):null,e("div",{class:"vxe-msg--content"},this.$slots.default||(_xeUtils.default.isFunction(d)?d.call(this,e):d))]),h?null:e("div",{class:"vxe-msg--footer"},["confirm"===i?e("vxe-button",{on:{click:this.cancelEvent}},_conf.default.i18n("vxe.button.cancel")):null,e("vxe-button",{props:{type:"primary"},on:{click:this.confirmEvent}},_conf.default.i18n("vxe.button.confirm"))])])])},methods:{selfClickEvent:function(e){if(this.maskClosable&&e.target===this.$el){this.close("mask")}},closeEvent:function(e){var t="close";this.$emit(t,e),this.close(t)},confirmEvent:function(e){var t="confirm";this.$emit(t,e),this.close(t)},cancelEvent:function(e){var t="cancel";this.$emit(t,e),this.close(t)},open:function(){var e=this,t=this.duration,n=this.visible,i=this.lockScroll,o=this._handleCustom,s=this.isMsg;if(!n){if(this.visible=!0,this.contentVisible=!1,setTimeout(function(){e.contentVisible=!0},10),i){var l=document.body;this.beforeLockStyle={paddingRight:l.style.paddingRight,overflow:l.style.overflow},l.style.paddingRight="".concat(window.innerWidth-(document.documentElement.clientWidth||document.body.clientWidth),"px"),l.style.overflow="hidden"}o||(this.$emit("input",!0),this.$emit("show")),s&&(this.addMsgQueue(),setTimeout(this.close,t))}},addMsgQueue:function(){-1===_queue.default.indexOf(this)&&_queue.default.push(this),this.updateStyle()},removeMsgQueue:function(){var t=this;-1<_queue.default.indexOf(this)&&_xeUtils.default.remove(_queue.default,function(e){return e===t}),this.updateStyle()},updateStyle:function(){this.$nextTick(function(){var t=0;_queue.default.forEach(function(e){t+=e.top,e.msgTop=t,t+=e.$refs.msgBox.clientHeight})})},close:function(e){var t=this,n=this.visible,i=this.lockScroll,o=this.beforeLockStyle,s=this.isMsg;n&&(s&&this.removeMsgQueue(),this.contentVisible=!1,setTimeout(function(){t.visible=!1,i&&Object.assign(document.body.style,o),t._handleCustom?t._handleCustom(e):(t.$emit("input",!1),t.$emit("hide",e))},200))},handleGlobalKeydownEvent:function(e){27===e.keyCode&&this.close()},mousedownEvent:function(e){var t=this;if(0===e.button){e.preventDefault();var a=this.$refs.msgBox,n=document.onmousemove,i=document.onmouseup,r=e.clientX-a.offsetLeft,d=e.clientY-a.offsetTop;document.onmousemove=function(e){e.preventDefault();var t=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight,i=a.offsetWidth,o=i/2,s=t-i/2,l=n-a.offsetHeight,u=e.clientX-r,c=e.clientY-d;s<u&&(u=s),u<o&&(u=o),l<c&&(c=l),c<0&&(c=0),a.style.left="".concat(u,"px"),a.style.top="".concat(c,"px"),a.className=a.className.replace(/\s?drag-move/,"")+" drag-move"},document.onmouseup=function(e){document.onmousemove=n,document.onmouseup=i,t.$nextTick(function(){a.className=a.className.replace(/\s?drag-move/,"")})}}}}};exports.default=_default2;