"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils")),_queue=_interopRequireDefault(require("./queue")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var _default2={name:"VxeModal",props:{value:Boolean,id:String,type:{type:String,default:"modal"},status:String,top:{type:[Number,String],default:15},title:String,duration:{type:[Number,String],default:function(){return _conf.default.message.duration}},message:[String,Function],lockView:{type:Boolean,default:function(){return _conf.default.message.lockView}},lockScroll:Boolean,mask:{type:Boolean,default:function(){return _conf.default.message.mask}},maskClosable:Boolean,escClosable:Boolean,resize:Boolean,showHeader:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},width:[Number,String],height:[Number,String],zIndex:{type:[Number,String],default:function(){return _conf.default.message.zIndex}},marginSize:{type:[Number,String],default:_conf.default.message.marginSize},animat:{type:Boolean,default:function(){return _conf.default.message.animat}}},data:function(){return{visible:!1,contentVisible:!1,modalTop:0,zoomLocat:null}},computed:{vSize:function(){return this.size||this.$parent&&(this.$parent.size||this.$parent.vSize)},isMsg:function(){return"message"===this.type}},watch:{value:function(e){this[e?"open":"close"]()}},created:function(){this.value&&this.open()},mounted:function(){this.escClosable&&_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),document.body.appendChild(this.$el)},beforeDestroy:function(){_tools.GlobalEvent.off(this,"keydown"),this.removeMsgQueue(),this.$el.parentNode.removeChild(this.$el)},render:function(t){var e,o=this,i=this.vSize,n=this.type,s=this.resize,l=this.animat,a=this.width,c=this.height,u=this.zIndex,r=this.status,d=this.showHeader,f=this.showFooter,h=this.zoomLocat,m=this.modalTop,p=this.contentVisible,v=this.visible,g=this.title,x=this.message,b=this.lockScroll,y=this.lockView,_=this.mask,w=this.isMsg;return t("div",{class:["vxe-modal--wrapper","type--".concat(n),(e={},_defineProperty(e,"size--".concat(i),i),_defineProperty(e,"status--".concat(r),r),_defineProperty(e,"is--animat",l),_defineProperty(e,"lock--scroll",b),_defineProperty(e,"lock--view",y),_defineProperty(e,"is--mask",_),_defineProperty(e,"is--visible",p),_defineProperty(e,"active",v),e)],style:{zIndex:u,top:m?"".concat(m,"px"):null},on:{click:this.selfClickEvent}},[t("div",{class:"vxe-modal--box",style:{width:a?isNaN(a)?a:"".concat(a,"px"):null,height:c?isNaN(c)?c:"".concat(c,"px"):null},ref:"modalBox"},[d?t("div",{class:"vxe-modal--header",on:{mousedown:this.mousedownEvent}},[t("span",{class:"vxe-modal--title"},g?_tools.UtilTools.getFuncText(g):_conf.default.i18n("vxe.alert.title")),s?t("i",{class:["vxe-modal--zoom-btn","trigger--btn",h?_conf.default.icon.zoomOut:_conf.default.icon.zoomIn],on:{click:this.zoomInEvent}}):null,t("i",{class:["vxe-modal--close-btn","trigger--btn",_conf.default.icon.modalClose],on:{click:this.closeEvent}})]):null,t("div",{class:"vxe-modal--body"},[r?t("div",{class:"vxe-modal--status-wrapper"},[t("i",{class:["vxe-modal--status-icon",_conf.default.icon["modal".concat(r.replace(/\b(\w)/,function(e){return e.toUpperCase()}))]]})]):null,t("div",{class:"vxe-modal--content"},this.$slots.default||(_xeUtils.default.isFunction(x)?x.call(this,t):x))]),f?t("div",{class:"vxe-modal--footer"},this.$slots.footer||["confirm"===n?t("vxe-button",{on:{click:this.cancelEvent}},_conf.default.i18n("vxe.button.cancel")):null,t("vxe-button",{props:{type:"primary"},on:{click:this.confirmEvent}},_conf.default.i18n("vxe.button.confirm"))]):null,!w&&s?t("span",{class:"vxe-modal--resize"},["wl","wr","swst","sest","st","swlb","selb","sb"].map(function(e){return t("span",{class:"".concat(e,"-resize"),attrs:{"data-type":e},on:{mousedown:o.dragEvent}})})):null])])},methods:{selfClickEvent:function(e){if(this.maskClosable&&e.target===this.$el){this.close("mask")}},closeEvent:function(e){var t="close";this.$emit(t,e),this.close(t)},confirmEvent:function(e){var t="confirm";this.$emit(t,e),this.close(t)},cancelEvent:function(e){this.$emit("cancel",e),this.close("cancel")},open:function(){var s=this,e=this.duration,t=this.visible,o=this._handleCustom,i=this.isMsg;t||(this.visible=!0,this.contentVisible=!1,setTimeout(function(){s.contentVisible=!0},10),o||(this.$emit("input",!0),this.$emit("show")),i?(this.addMsgQueue(),setTimeout(this.close,_xeUtils.default.toNumber(e))):this.$nextTick(function(){var e=s.$refs,t=s.marginSize,o=e.modalBox,i=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight;o.style.left="".concat(i/2-o.offsetWidth/2,"px"),o.offsetHeight+o.offsetTop+t>n&&(o.style.top="".concat(t,"px"))}))},addMsgQueue:function(){-1===_queue.default.indexOf(this)&&_queue.default.push(this),this.updateStyle()},removeMsgQueue:function(){var t=this;-1<_queue.default.indexOf(this)&&_xeUtils.default.remove(_queue.default,function(e){return e===t}),this.updateStyle()},updateStyle:function(){this.$nextTick(function(){var t=0;_queue.default.forEach(function(e){t+=_xeUtils.default.toNumber(e.top),e.modalTop=t,t+=e.$refs.modalBox.clientHeight})})},close:function(e){var t=this,o=this.visible,i=this.isMsg;o&&(i&&this.removeMsgQueue(),this.contentVisible=!1,setTimeout(function(){t.visible=!1,t._handleCustom?t._handleCustom(e):(t.$emit("input",!1),t.$emit("hide",e))},200))},handleGlobalKeydownEvent:function(e){27===e.keyCode&&this.close()},zoomInEvent:function(e){var t=this.$refs,o=this.marginSize,i=this.zoomLocat,n=t.modalBox,s=_tools.DomTools.getDomNode(),l=s.visibleHeight,a=s.visibleWidth;i?(this.zoomLocat=null,Object.assign(n.style,{top:"".concat(i.top,"px"),left:"".concat(i.left,"px"),width:"".concat(i.width,"px"),height:"".concat(i.height,"px")})):(this.zoomLocat={top:n.offsetTop,left:n.offsetLeft,width:n.clientWidth,height:n.clientHeight},Object.assign(n.style,{top:"".concat(o,"px"),left:"".concat(o,"px"),width:"".concat(a-2*o,"px"),height:"".concat(l-2*o,"px")}))},mousedownEvent:function(e){var t=this,o=this.$refs,u=this.marginSize,r=o.modalBox;if(0===e.button&&!_tools.DomTools.getEventTargetNode(e,r,"trigger--btn").flag){e.preventDefault();var i=document.onmousemove,n=document.onmouseup,d=e.clientX-r.offsetLeft,f=e.clientY-r.offsetTop,s=_tools.DomTools.getDomNode(),h=s.visibleHeight,m=s.visibleWidth;document.onmousemove=function(e){e.preventDefault();var t=r.offsetWidth,o=r.offsetHeight,i=u,n=m-t-u,s=u,l=h-o-u,a=e.clientX-d,c=e.clientY-f;n<a&&(a=n),a<i&&(a=i),l<c&&(c=l),c<s&&(c=s),r.style.left="".concat(a,"px"),r.style.top="".concat(c,"px"),r.className=r.className.replace(/\s?is--drag/,"")+" is--drag"},document.onmouseup=function(e){document.onmousemove=i,document.onmouseup=n,t.$nextTick(function(){r.className=r.className.replace(/\s?is--drag/,"")})}}},dragEvent:function(e){e.preventDefault();var s=e.target.dataset.type,l=this.marginSize,t=_tools.DomTools.getDomNode(),a=t.visibleHeight,c=t.visibleWidth,u=c-20,r=a-20,d=this.$refs.modalBox,o=document.onmousemove,i=document.onmouseup,f=d.clientWidth,h=d.clientHeight,m=e.clientX,p=e.clientY,v=d.offsetTop,g=d.offsetLeft;document.onmousemove=function(e){var t,o,i,n;switch(e.preventDefault(),s){case"wl":i=(t=m-e.clientX)+f,l<g-t&&340<i&&(d.style.width="".concat(i<u?i:u,"px"),d.style.left="".concat(g-t,"px"));break;case"swst":t=m-e.clientX,o=p-e.clientY,i=t+f,n=o+h,l<g-t&&340<i&&(d.style.width="".concat(i<u?i:u,"px"),d.style.left="".concat(g-t,"px")),l<v-o&&200<n&&(d.style.height="".concat(n<r?n:r,"px"),d.style.top="".concat(v-o,"px"));break;case"swlb":t=m-e.clientX,o=e.clientY-p,i=t+f,n=o+h,l<g-t&&340<i&&(d.style.width="".concat(i<u?i:u,"px"),d.style.left="".concat(g-t,"px")),v+n+l<a&&200<n&&(d.style.height="".concat(n<r?n:r,"px"));break;case"st":o=p-e.clientY,n=h+o,l<v-o&&200<n&&(d.style.height="".concat(n<r?n:r,"px"),d.style.top="".concat(v-o,"px"));break;case"wr":t=e.clientX-m,g+(i=t+f)+l<c&&340<i&&(d.style.width="".concat(i<u?i:u,"px"));break;case"sest":t=e.clientX-m,n=(o=p-e.clientY)+h,g+(i=t+f)+l<c&&340<i&&(d.style.width="".concat(i<u?i:u,"px")),l<v-o&&200<n&&(d.style.height="".concat(n<r?n:r,"px"),d.style.top="".concat(v-o,"px"));break;case"selb":t=e.clientX-m,n=(o=e.clientY-p)+h,g+(i=t+f)+l<c&&340<i&&(d.style.width="".concat(i<u?i:u,"px")),v+n+l<a&&200<n&&(d.style.height="".concat(n<r?n:r,"px"));break;case"sb":o=e.clientY-p,v+(n=o+h)+l<a&&200<n&&(d.style.height="".concat(n<r?n:r,"px"))}d.className=d.className.replace(/\s?is--drag/,"")+" is--drag"},document.onmouseup=function(e){document.onmousemove=o,document.onmouseup=i,setTimeout(function(){d.className=d.className.replace(/\s?is--drag/,"")},50)}}}};exports.default=_default2;