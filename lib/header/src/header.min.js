"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var n=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,n<t.level&&(n=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var o=0;t.children.forEach(function(e){e.visible&&(l(e,t),o+=e.colSpan)}),t.colSpan=o}else t.colSpan=1}(e)});for(var l=[],t=0;t<n;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=n-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},render:function(_){var $=this,T=this.$parent,W=this.fixedType,e=this.headerColumn,l=this.tableColumn,t=this.fixedColumn,I=T.$listeners,S=T.resizable,P=T.border,U=T.overflowX,o=T.headerRowClassName,z=T.headerCellClassName,n=T.headerRowStyle,E=T.headerCellStyle,i=T.showHeaderOverflow,r=T.showHeaderAllOverflow,k=T.headerAlign,A=T.align,D=T.highlightCurrentColumn,M=T.currentColumn,a=T.tableWidth,s=T.scrollXLoad,d=T.scrollXStore,c=T.scrollbarWidth,H=T.getColumnMapIndex,R=T.sortOpts,O=_xeUtils.default.isBoolean(r)?r:i;return s&&(W&&(l=t),a=l.reduce(function(e,l){return e+l.renderWidth},0)),_("div",{class:["vxe-table--header-wrapper",W?"fixed--".concat(W,"-wrapper"):"body--wrapper"]},[!W&&s?_("div",{class:["vxe-body--x-space"],style:{width:"".concat(T.tableWidth+c,"px")}}):null,_("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},style:{width:null===a?a:"".concat(a+c,"px"),"margin-left":W?null:"".concat(d.leftSpaceWidth,"px")}},[_("colgroup",l.map(function(e,l){return _("col",{attrs:{name:e.id,width:e.renderWidth},key:l})}).concat([_("col",{attrs:{width:c}})])),_("thead",e.map(function(e,C){return _("tr",{class:["vxe-header--row",o?_xeUtils.default.isFunction(o)?o({$table:T,$rowIndex:C,fixed:W}):o:""],style:n?_xeUtils.default.isFunction(n)?n({$table:T,$rowIndex:C,fixed:W}):n:null},e.map(function(l,t){var e,o=l.columnKey,n=l.showHeaderOverflow,i=l.headerAlign,r=l.align,a=l.renderWidth,s=l.headerClassName,d=l.children&&l.children.length,c=W?l.fixed!==W&&!d:l.fixed&&U,u=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?O:n,f=i||r||k||A,h="ellipsis"===u,p="title"===u,m=!0===u||"tooltip"===u,x=p||m||h,v={},b=l.filters.length,y=b&&l.filters.some(function(e){return e.checked}),g=H(l),w={$table:T,$rowIndex:C,column:l,columnIndex:g,$columnIndex:t,fixed:W,isHidden:c,hasFilter:y};return(p||m)&&(v.mouseenter=function(e){p?_tools.DomTools.updateCellTitle(e):m&&T.triggerHeaderTooltipEvent(e,{$table:T,$rowIndex:C,column:l,columnIndex:g,$columnIndex:t,fixed:W})}),m&&(v.mouseleave=function(e){m&&T.handleTargetLeaveEvent(e)}),(D||I["header-cell-click"]||"cell"===R.trigger)&&(v.click=function(e){return T.triggerHeaderCellClickEvent(e,{$table:T,$rowIndex:C,column:l,columnIndex:g,$columnIndex:t,fixed:W,cell:e.currentTarget})}),I["header-cell-dblclick"]&&(v.dblclick=function(e){return _tools.UtilTools.emitEvent(T,"header-cell-dblclick",[{$table:T,$rowIndex:C,column:l,columnIndex:g,$columnIndex:t,fixed:W,cell:e.currentTarget},e])}),_("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(f),f),_defineProperty(e,"col--fixed",l.fixed),_defineProperty(e,"col--group",d),_defineProperty(e,"col--ellipsis",x),_defineProperty(e,"fixed--hidden",c),_defineProperty(e,"is--sortable",l.sortable),_defineProperty(e,"is--filter",b),_defineProperty(e,"filter--active",y),_defineProperty(e,"col--current",M===l),e),_tools.UtilTools.getClass(s,w),_tools.UtilTools.getClass(z,w)],attrs:{"data-colid":l.id,colspan:l.colSpan,rowspan:l.rowSpan},style:E?_xeUtils.default.isFunction(E)?E(w):E:null,on:v,key:o||(d||T.columnKey?l.id:g)},[_("div",{class:["vxe-cell",{"c--title":p,"c--tooltip":m,"c--ellipsis":h}],style:{width:x?"".concat(P?a-1:a,"px"):null}},l.renderHeader(_,w)),!c&&!d&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:S)?_("div",{class:["vxe-resizable",{"is--line":!P}],on:{mousedown:function(e){return $.resizeMousedown(e,w)}}}):null])}).concat(c?[_("th",{class:["col--gutter"],style:{width:"".concat(c,"px")}})]:[]))}))]),_("div",{class:["vxe-table--repair"],style:{width:null===a?a:"".concat(a,"px")}})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=l.column,o=this.$parent,n=this.$el,i=this.fixedType,r=o.$refs,a=r.tableBody,s=r.leftContainer,d=r.rightContainer,c=r.resizeBar,u=e.target,f=e.clientX,h=u.parentNode,p=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,n),v=u.clientWidth,b=x.left-h.clientWidth+v+36,y=x.left+Math.floor(v/2),g=document.onmousemove,w=document.onmouseup,C="left"===i,_="right"===i,$=0;if(C||_){for(var T=C?"nextElementSibling":"previousElementSibling",W=h[T];W&&!_tools.DomTools.hasClass(W,"fixed--hidden");)_tools.DomTools.hasClass(W,"col--group")||($+=W.offsetWidth),W=W[T];_&&d&&(y=d.offsetLeft+$)}var I=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-f,t=y+l,o=i?0:m.scrollLeft;C?t=Math.min(t,(d?d.offsetLeft:m.clientWidth)-$-36):_&&(b=(s?s.clientWidth:0)+$+36,t=Math.min(t,y+h.clientWidth-36)),p=Math.max(t,b),c.style.left="".concat(p-o,"px")};c.style.display="block",document.onmousemove=I,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=w,t.resizeWidth=t.renderWidth+(_?y-p:p-y),c.style.display="none",o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.recalculate(!0),o.$toolbar&&o.$toolbar.updateResizable(),_tools.UtilTools.emitEvent(o,"resizable-change",[l])},I(e)}}};exports.default=_default;