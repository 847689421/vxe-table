"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,o<t.level&&(o=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var n=0;t.children.forEach(function(e){e.visible&&(l(e,t),n+=e.colSpan)}),t.colSpan=n}else t.colSpan=1}(e)});for(var l=[],t=0;t<o;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},render:function(b){var w=this.$parent,y=this.fixedType,e=this.headerColumn,l=this.tableColumn,g=this.resizeMousedown,t=this.fixedColumn,C=w.$listeners,_=w.resizable,$=w.border,I=w.overflowX,n=w.headerRowClassName,T=w.headerCellClassName,o=w.showHeaderOverflow,r=w.showHeaderAllOverflow,W=w.highlightCurrentColumn,S=w.selectColumn,i=w.tableWidth,a=w.scrollXLoad,c=w.scrollXStore,d=w.scrollbarWidth,k=w.getColumnMapIndex,P=_xeUtils.default.isBoolean(r)?r:o;return a&&(y&&(l=t),i=l.reduce(function(e,l){return e+l.renderWidth},0)),b("div",{class:["vxe-table--header-wrapper",y?"fixed--".concat(y,"-wrapper"):"body--wrapper"]},[!y&&a?b("div",{class:["vxe-body--x-space"],style:{width:"".concat(w.tableWidth+d,"px")}}):null,b("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},style:{width:null===i?i:"".concat(i+d,"px"),"margin-left":y?null:"".concat(c.leftSpaceWidth,"px")}},[b("colgroup",l.map(function(e,l){return b("col",{attrs:{name:e.id,width:e.renderWidth},key:l})}).concat([b("col",{attrs:{width:d}})])),b("thead",e.map(function(e,v){return b("tr",{class:["vxe-header--row",n?_xeUtils.default.isFunction(n)?n({$table:w,$rowIndex:v,fixed:y}):n:""]},e.map(function(l,t){var e,n=l.columnKey,o=l.showHeaderOverflow,r=l.headerAlign,i=l.renderWidth,a=l.own,c=l.children&&l.children.length,d=y?l.fixed!==y&&!c:l.fixed&&I,s=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?P:o,u="ellipsis"===s,f="title"===s,h=!0===s||"tooltip"===s,p=f||h||u,m={},x=k(l);return h&&(m.mouseover=function(e){return w.triggerHeaderTooltipEvent(e,{$table:w,column:l,columnIndex:x,$columnIndex:t,fixed:y})},m.mouseout=w.clostTooltip),(W||C["header-cell-click"])&&(m.click=function(e){return w.triggerHeaderCellClickEvent(e,{$table:w,$rowIndex:v,column:l,columnIndex:x,$columnIndex:t,fixed:y,cell:e.currentTarget})}),C["header-cell-dblclick"]&&(m.dblclick=function(e){return _tools.UtilTools.emitEvent(w,"header-cell-dblclick",[{$table:w,$rowIndex:v,column:l,columnIndex:x,$columnIndex:t,fixed:y,cell:e.currentTarget},e])}),b("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(r),r),_defineProperty(e,"col--current",S===l),_defineProperty(e,"col--ellipsis",p),_defineProperty(e,"fixed--hidden",d),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),T?_xeUtils.default.isFunction(T)?T({$table:w,$rowIndex:v,column:l,columnIndex:x,$columnIndex:t,fixed:y}):T:""],attrs:{"data-index":x,colspan:l.colSpan,rowspan:l.rowSpan},on:m,key:n||(c?l.id:x)},[b("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":h,"c--ellipsis":u}],attrs:{title:f?a.title||a.label:null},style:{width:p?"".concat($?i-1:i,"px"):null}},l.renderHeader(b,{$table:w,$rowIndex:v,column:l,columnIndex:x,$columnIndex:t,fixed:y,isHidden:d})),!d&&!c&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:_)?b("div",{class:["vxe-resizable",{"is--line":!$}],on:{mousedown:function(e){return g(e,l)}}}):null])}).concat(d?[b("th",{class:["col--gutter"],style:{width:"".concat(d,"px")}})]:[]))}))]),b("div",{class:["vxe-table--repair"],style:{width:null===i?i:"".concat(i,"px")}})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=this.$parent,n=this.$el,o=this.fixedType,r=t.$refs,i=r.tableBody,a=r.rightContainer,c=r.resizeBar,d=e.target,s=e.clientX,u=d.parentNode,f=0,h=i.$el,p=_tools.DomTools.getOffsetPos(d,n),m=d.clientWidth,x=p.left-u.clientWidth+m+36,v=p.left+Math.floor(m/2),b=document.onmousemove,w=document.onmouseup,y=0,g=u;if(a&&"right"===o){for(;g&&!_tools.DomTools.hasClass(g,"fixed--hidden");)y+=g.offsetWidth,g=g.previousElementSibling;v=a.offsetLeft+y}var C=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-s,t=v+l,n=o?0:h.scrollLeft;"left"===o&&a?t=Math.min(t,a.offsetLeft-36):"right"===o&&(x=v-u.offsetWidth+36),f=t<x?x:t,c.style.left="".concat(f-n,"px")};c.style.display="block",document.onmousemove=C,document.onmouseup=function(e){document.onmousemove=b,document.onmouseup=w,l.resizeWidth=l.renderWidth+(f-v),c.style.display="none",t.analyColumnWidth(),t.recalculate(!0)},C(e)}}};exports.default=_default;