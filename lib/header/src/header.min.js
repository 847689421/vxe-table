"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,o<t.level&&(o=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var n=0;t.children.forEach(function(e){e.visible&&(l(e,t),n+=e.colSpan)}),t.colSpan=n}else t.colSpan=1}(e)});for(var l=[],t=0;t<o;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},render:function(w){var y=this.$parent,C=this.fixedType,e=this.headerColumn,l=this.tableColumn,_=this.resizeMousedown,t=this.fixedColumn,$=y.$listeners,I=y.resizable,W=y.border,T=y.overflowX,n=y.headerRowClassName,S=y.headerCellClassName,o=y.showHeaderOverflow,i=y.showHeaderAllOverflow,P=y.headerAlign,k=y.align,A=y.highlightCurrentColumn,z=y.selectColumn,r=y.tableWidth,a=y.scrollXLoad,c=y.scrollXStore,d=y.scrollbarWidth,E=y.getColumnMapIndex,M=_xeUtils.default.isBoolean(i)?i:o;return a&&(C&&(l=t),r=l.reduce(function(e,l){return e+l.renderWidth},0)),w("div",{class:["vxe-table--header-wrapper",C?"fixed--".concat(C,"-wrapper"):"body--wrapper"]},[!C&&a?w("div",{class:["vxe-body--x-space"],style:{width:"".concat(y.tableWidth+d,"px")}}):null,w("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},style:{width:null===r?r:"".concat(r+d,"px"),"margin-left":C?null:"".concat(c.leftSpaceWidth,"px")}},[w("colgroup",l.map(function(e,l){return w("col",{attrs:{name:e.id,width:e.renderWidth},key:l})}).concat([w("col",{attrs:{width:d}})])),w("thead",e.map(function(e,g){return w("tr",{class:["vxe-header--row",n?_xeUtils.default.isFunction(n)?n({$table:y,$rowIndex:g,fixed:C}):n:""]},e.map(function(l,t){var e,n=l.columnKey,o=l.showHeaderOverflow,i=l.headerAlign,r=l.align,a=l.renderWidth,c=l.own,d=l.children&&l.children.length,s=C?l.fixed!==C&&!d:l.fixed&&T,u=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?M:o,f=i||r||P||k,h="ellipsis"===u,p="title"===u,m=!0===u||"tooltip"===u,x=p||m||h,v={},b=E(l);return m&&(v.mouseover=function(e){return y.triggerHeaderTooltipEvent(e,{$table:y,column:l,columnIndex:b,$columnIndex:t,fixed:C})},v.mouseout=y.clostTooltip),(A||$["header-cell-click"])&&(v.click=function(e){return y.triggerHeaderCellClickEvent(e,{$table:y,$rowIndex:g,column:l,columnIndex:b,$columnIndex:t,fixed:C,cell:e.currentTarget})}),$["header-cell-dblclick"]&&(v.dblclick=function(e){return _tools.UtilTools.emitEvent(y,"header-cell-dblclick",[{$table:y,$rowIndex:g,column:l,columnIndex:b,$columnIndex:t,fixed:C,cell:e.currentTarget},e])}),w("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(f),f),_defineProperty(e,"col--group",d),_defineProperty(e,"col--ellipsis",x),_defineProperty(e,"fixed--hidden",s),_defineProperty(e,"col--current",z===l),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),S?_xeUtils.default.isFunction(S)?S({$table:y,$rowIndex:g,column:l,columnIndex:b,$columnIndex:t,fixed:C}):S:""],attrs:{"data-index":b,colspan:l.colSpan,rowspan:l.rowSpan},on:v,key:n||(d?l.id:b)},[w("div",{class:["vxe-cell",{"c--title":p,"c--tooltip":m,"c--ellipsis":h}],attrs:{title:p?c.title||c.label:null},style:{width:x?"".concat(W?a-1:a,"px"):null}},l.renderHeader(w,{$table:y,$rowIndex:g,column:l,columnIndex:b,$columnIndex:t,fixed:C,isHidden:s})),!s&&!d&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:I)?w("div",{class:["vxe-resizable",{"is--line":!W}],on:{mousedown:function(e){return _(e,l)}}}):null])}).concat(d?[w("th",{class:["col--gutter"],style:{width:"".concat(d,"px")}})]:[]))}))]),w("div",{class:["vxe-table--repair"],style:{width:null===r?r:"".concat(r,"px")}})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=this.$parent,n=this.$el,o=this.fixedType,i=t.$refs,r=i.tableBody,a=i.leftContainer,c=i.rightContainer,d=i.resizeBar,s=e.target,u=e.clientX,f=s.parentNode,h=0,p=r.$el,m=_tools.DomTools.getOffsetPos(s,n),x=s.clientWidth,v=m.left-f.clientWidth+x+36,b=m.left+Math.floor(x/2),g=document.onmousemove,w=document.onmouseup,y="left"===o,C="right"===o,_=0;if(y||C){for(var $=y?"nextElementSibling":"previousElementSibling",I=f[$];I&&!_tools.DomTools.hasClass(I,"fixed--hidden");)_tools.DomTools.hasClass(I,"col--group")||(_+=I.offsetWidth),I=I[$];C&&c&&(b=c.offsetLeft+_)}var W=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-u,t=b+l,n=o?0:p.scrollLeft;y?t=Math.min(t,(c?c.offsetLeft:p.clientWidth)-_-36):C&&(v=(a?a.clientWidth:0)+_+36,t=Math.min(t,b+f.clientWidth-36)),h=Math.max(t,v),d.style.left="".concat(h-n,"px")};d.style.display="block",document.onmousemove=W,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=w,l.resizeWidth=l.renderWidth+(C?b-h:h-b),d.style.display="none",t.analyColumnWidth(),t.recalculate(!0)},W(e)}}};exports.default=_default;