"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={};if(null!=e){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var n=o?Object.getOwnPropertyDescriptor(e,l):null;n&&(n.get||n.set)?Object.defineProperty(i,l,n):i[l]=e[l]}}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var printFrame,rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20,impForm=document.createElement("form"),impInput=document.createElement("input");function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,i,o){var l=e.target;return l&&t.type===i&&"input"===l.tagName.toLowerCase()&&l.type===(o||i)}impForm.className="vxe-table--import-form",impInput.name="file",impInput.type="file",impForm.appendChild(impInput);var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,i){var o=t.tableData,l=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.height,c=t.containerHeight,u=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,g=t.showFooter,v=t.tableHeight,p=t.scrollbarWidth,m=t.scrollbarHeight,x=t.scrollRightToLeft,b=t.scrollLeftToRight,w=t.columnStore,C=t.footerData,T="right"===i,_=w["".concat(i,"List")],S="auto"===a?c:_tools.DomTools.isScale(a)?Math.floor(parseInt(a)/100*c):_xeUtils.default.toNumber(a);g&&(S+=m+1);var R={height:"".concat((0<S?S-h-d:v)+h+d-m*(g?2:1),"px"),width:"".concat(_.reduce(function(e,t){return e+t.renderWidth},T?p:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(i,"-wrapper"),{"scrolling--middle":T?x:b}],style:R,ref:"".concat(i,"Container")},[f?e("vxe-table-header",{props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:u,fixedColumn:_,isGroup:s},ref:"".concat(i,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:i,tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,fixedColumn:_,size:u,isGroup:s},ref:"".concat(i,"Body")}),g?e("vxe-table-footer",{style:{top:"".concat(0<S?S-d:v+h,"px")},props:{fixedType:i,footerData:C,tableColumn:l,visibleColumn:n,size:u,fixedColumn:_},ref:"".concat(i,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,zIndex:Number,autoResize:Boolean,syncResize:Boolean,sortConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},data:function(){return{id:_xeUtils.default.uniqueId(),tZindex:0,collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],containerHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],hoverRow:null,isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxConfig||this.selectConfig||{}),i=t.strict,o=t.checkMethod;return!!i&&(!e.length||!!o&&e.every(function(e,t){return!o({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){this.isUpdateData||this.loadTableData(e,!0).then(this.handleDefault),this.isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,i=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=i,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(i),i.length&&i.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delProp",["column.column-key","table.column-key"]),i.length){var o=Math.floor((i.length-1)/2);i[o].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),i[o].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&i.some(function(e){return e.fixed})&&i.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this.isLoading||(this.isLoading=!0)},syncResize:function(e){e&&this.$nextTick(this.recalculate)}},created:function(){var e=this,t=this.scrollXStore,i=this.scrollYStore,o=this.optimizeOpts,l=this.ctxMenuOpts,n=this.radioConfig,r=void 0===n?{}:n,s=this.treeConfig,a=this.editConfig,c=this.loading,u=this.showAllOverflow,h=this.showHeaderAllOverflow,d=o.scrollX,f=o.scrollY,g=this.checkboxConfig||this.selectConfig||{};c&&(this.isLoading=!0),f&&Object.assign(i,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(f.rSize),offsetSize:_xeUtils.default.toNumber(f.oSize)}),d&&Object.assign(t,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(d.rSize),offsetSize:_xeUtils.default.toNumber(d.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),_xeUtils.default.isBoolean(u)&&_tools.UtilTools.warn("vxe.error.delProp",["show-all-overflow","show-overflow"]),_xeUtils.default.isBoolean(h)&&_tools.UtilTools.warn("vxe.error.delProp",["show-header-all-overflow","show-header-overflow"]),r.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["radio-config.labelProp","radio-config.labelField"]),g.checkProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.checkProp","select-config.checkField"]),g.labelProp&&_tools.UtilTools.warn("vxe.error.delProp",["select-config.labelProp","select-config.labelField"]),["header","body","footer"].forEach(function(e){l[e]&&l[e].visibleMethod&&_tools.UtilTools.warn("vxe.error.delProp",["context-menu.".concat(e,".visibleMethod"),"context-menu.visibleMethod"])}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadTableData(this.data,!0).then(function(){g.key?_tools.UtilTools.warn("vxe.error.delProp",["select-config.key","row-id"]):s&&s.key?_tools.UtilTools.warn("vxe.error.delProp",["tree-config.key","row-id"]):a&&a.key&&_tools.UtilTools.warn("vxe.error.delProp",["edit-config.key","row-id"]),e.handleDefault()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){this.autoResize&&_tools.ResizeEvent.on(this,this.getParentElem(),this.recalculate),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.getParentElem()),this.closeFilter(),this.closeMenu(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t=this._e,i=this.id,o=this.tableData,l=this.tableColumn,n=this.visibleColumn,r=this.collectColumn,s=this.isGroup,a=this.hasFilter,c=this.isResizable,u=this.isCtxMenu,h=this.loading,d=this.isLoading,f=this.showHeader,g=this.border,v=this.stripe,p=this.height,m=this.highlightHoverRow,x=this.highlightHoverColumn,b=this.vSize,w=this.editConfig,C=this.validOpts,T=this.mouseConfig,_=void 0===T?{}:T,S=this.editRules,R=this.showFooter,y=this.footerMethod,E=this.overflowX,D=this.overflowY,U=this.scrollXLoad,k=this.scrollYLoad,I=this.scrollbarHeight,$=this.optimizeOpts,F=this.vaildTipOpts,M=this.tooltipConfig,O=this.columnStore,L=this.filterStore,A=this.ctxMenuStore,z=this.footerData,H=this.hasTip,P=O.leftList,j=O.rightList;return e("div",{class:["vxe-table",b?"size--".concat(b):"",{"vxe-editable":w,"show--head":f,"show--foot":R,"fixed--left":P.length,"fixed--right":j.length,"t--animat":$.animat,"t--stripe":v,"t--border":g,"t--selected":_.selected,"t--checked":_.checked,"row--highlight":m,"column--highlight":x,"scroll--y":D,"scroll--x":E,"virtual--x":U,"virtual--y":k}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[f?e("vxe-table-header",{ref:"tableHeader",props:{tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:b,isGroup:s}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:o,tableColumn:l,visibleColumn:n,collectColumn:r,size:b,isGroup:s}}),R?e("vxe-table-footer",{props:{footerData:z,footerMethod:y,tableColumn:l,visibleColumn:n,size:b},ref:"tableFooter"}):null]),P&&P.length&&E?renderFixed(e,this,"left"):t(),j&&j.length&&E?renderFixed(e,this,"right"):t(),c?e("div",{class:"vxe-table--resizable-bar",style:E?{"padding-bottom":"".concat(I,"px")}:null,ref:"resizeBar"}):t(),d?e("vxe-table-loading",{props:{visible:h}}):t(),e("div",{class:"vxe-table".concat(i,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[a?e("vxe-table-filter",{props:{optimizeOpts:$,filterStore:L},ref:"filterWrapper"}):t(),u?e("vxe-table-context-menu",{props:{ctxMenuStore:A},ref:"ctxWrapper"}):t(),H?e("vxe-tooltip",{ref:"tooltip",props:M,on:M&&M.enterable?{leave:this.handleTooltipLeaveEvent}:null}):t(),H&&S&&("default"===C.message?!p:"tooltip"===C.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===C.message||1===o.length?F:null,ref:"validTip"}):t()])])},methods:{getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived(),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,o=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?o.slice(i.startIndex,i.startIndex+i.renderSize):o.slice(0),this.$nextTick()},loadTableData:function(e,t){var i=this,o=this.height,l=this.maxHeight,n=this.showOverflow,r=this.treeConfig,s=this.editStore,a=this.optimizeOpts,c=this.scrollYStore,u=a.scrollY,h=e?e.slice(0):[],d=!r&&u&&u.gt&&u.gt<h.length;c.startIndex=0,c.visibleIndex=0,s.insertList=[],s.removeList=[],this.tableFullData=h,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(h,!0),!(this.scrollYLoad=d)||o||l||_tools.UtilTools.error("vxe.error.scrollYReqProp",["height | max-height"]),d&&!n&&_tools.UtilTools.warn("vxe.error.scrollYReqProp",["show-overflow"]);var f=Promise.resolve();return d&&(f=this.computeScrollLoad()),f.then(function(){return i.isLoadData=!0,i.handleTableData(!0),i.reserveCheckSelection(),i.checkSelectionStatus(),f=i.$nextTick(),t||(f=f.then(i.recalculate)),f.then(i.refreshScroll)})},loadData:function(e){return this.loadTableData(e)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.loadTableData(e)}).then(this.handleDefault)},reloadRow:function(e,t,i){var o=this.tableSourceData,l=this.tableData,n=this.getRowIndex(e),r=o[n];return r&&e&&(i?_xeUtils.default.set(r,i,_xeUtils.default.get(t||e,i)):t?(o[n]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(r,_xeUtils.default.clone(e,!0))),this.tableData=l.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){var n=this,e=this.treeConfig,t=this.tableFullData,r=this.fullDataRowIdData,s=this.fullDataRowMap,a=this.fullAllDataRowMap,c=this.fullAllDataRowIdData,u=_tools.UtilTools.getRowkey(this),i=function(e,t){var i=_tools.UtilTools.getRowid(n,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,u,i));var o={row:e,rowid:i,index:t};l&&(r[i]=o,s.set(e,o)),c[i]=o,a.set(e,o)};l&&(r=this.fullDataRowIdData={},s.clear()),c=this.fullAllDataRowIdData={},a.clear(),e?_xeUtils.default.eachTree(t,i,e):t.forEach(i)},cacheColumnMap:function(){var e=this.tableFullColumn,o=this.fullColumnMap,l=this.fullColumnIdData={};o.clear(),e.forEach(function(e,t){var i={column:e,colid:e.id,index:t};l[e.id]=i,o.set(e,i)})},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,o=this.tableFullData,l=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(i){var r=_xeUtils.default.findTree(o,function(e){return _tools.UtilTools.getRowid(t,e)===n},i);if(r)return r}else if(l[n]){var s=l[n];return{item:s.row,index:s.index,items:o}}}return null},getColumnNode:function(e){if(e){var t=this.isGroup,i=this.fullColumnIdData,o=this.tableFullColumn,l=e.getAttribute("data-colid");if(!t){var n=i[l].column;return{item:n,index:this.getColumnMapIndex(n),items:o}}var r=_xeUtils.default.findTree(o,function(e){return e.id===l},headerProps);if(r)return r}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getColumnMapIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var i=this,o=this.afterFullData,l=this.editStore,n=this.scrollYLoad,r=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["insert"]));_xeUtils.default.isArray(e)||(e=[e]);var s=o,a=e.map(function(e){return i.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),r.push.apply(r,a);else{var c=s.indexOf(t);if(-1===c)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[c,0].concat(a)),r.splice.apply(r,[r.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),r.unshift.apply(r,a);return[].unshift.apply(l.insertList,a),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return i.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(o){var e=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,i=e.editRender;t&&!_xeUtils.default.has(o,t)&&_xeUtils.default.set(o,t,i&&!_xeUtils.default.isUndefined(i.defaultValue)?i.defaultValue:null)}),_xeUtils.default.get(o,e)||_xeUtils.default.set(o,e,getRowUniqueId()),o},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var i=this,o=_xeUtils.default.isArray(t);return o||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return i.defineField(Object.assign({},e))});return o?e:e[0]})},remove:function(t){var e=this,i=this.afterFullData,o=this.tableFullData,l=this.editStore,n=this.treeConfig,r=this.selection,s=this.hasInsertByRow,a=this.scrollYLoad,c=l.removeList,u=l.insertList,h=this.checkboxConfig||this.selectConfig||{},d=h.checkField||h.checkProp,f=[],g=i;if(n)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["remove"]));return t?_xeUtils.default.isArray(t)||(t=[t]):t=o,t.forEach(function(e){s(e)||c.push(e)}),d||_xeUtils.default.remove(r,function(e){return-1<t.indexOf(e)}),o===t?(t=o.slice(0),o.length=0,g.length=0):(f=_xeUtils.default.remove(o,function(e){return-1<t.indexOf(e)}),_xeUtils.default.remove(g,function(e){return-1<t.indexOf(e)})),_xeUtils.default.remove(u,function(e){return-1<t.indexOf(e)}),this.handleTableData(),this.updateCache(),this.checkSelectionStatus(),a&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:t&&t.length?t[t.length-1]:null,rows:f}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,o){var l=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),i=l[t];i&&e&&(o?_xeUtils.default.set(e,o,_xeUtils.default.get(i,o)):_xeUtils.default.destructuring(e,i))}),this.$nextTick()):this.reloadData(l)},clearData:function(e,t){var i=this.tableSourceData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasInsertByRow:function(t){var e=this.treeConfig,i=this.tableSourceData;return e?_xeUtils.default.findTree(i,function(e){return e===t},e):-1===this.getRowIndex(t)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var i,o,l=this,n=this.visibleColumn,r=this.treeConfig,s=this.tableSourceData,a=this.fullDataRowIdData,c=_tools.UtilTools.getRowid(this,e);if(!a[c])return!1;if(r){var u=r.children,h=_xeUtils.default.findTree(s,function(e){return c===_tools.UtilTools.getRowid(l,e)},r);e=Object.assign({},e,_defineProperty({},u,null)),h&&(i=Object.assign({},h.item,_defineProperty({},u,null)))}else{i=s[a[c].index]}if(i){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t));for(var d=0,f=n.length;d<f;d++)if((o=n[d].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,o),_xeUtils.default.get(e,o)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColid:function(e){var t=this.fullColumnMap;return t.has(e)?t.get(e).colid:null},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return this.visibleColumn.find(function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.editStore,i=this.treeConfig,o=this.selection,l=this.checkboxConfig||this.selectConfig||{},n=l.checkField||l.checkProp,r=[],s=[];return s=n?(r=i?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,n)},i):e.filter(function(e){return _xeUtils.default.get(e,n)}),t.insertList.filter(function(e){return _xeUtils.default.get(e,n)})):(r=i?_xeUtils.default.filterTree(e,function(e){return-1<o.indexOf(e)},i):e.filter(function(e){return-1<o.indexOf(e)}),t.insertList.filter(function(e){return-1<o.indexOf(e)})),r.concat(s)},getUpdateRecords:function(){var e=this.tableFullData,t=this.isUpdateByRow,i=this.treeConfig;return i?_xeUtils.default.filterTree(e,function(e){return t(e)},i):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,i=this.remoteSort,c=this.remoteFilter,o=t,l=this.visibleColumn.find(function(e){return e.order}),n=e.filter(function(e){var t=e.filters;return t&&t.length});if((o=o.filter(function(a){return n.every(function(t){var e=t.property,i=t.filters,o=t.filterMethod,l=t.filterRender,n=l?_vXETable.Renderer.get(l.name):null,r=[],s=[];return!(i&&i.length&&(i.forEach(function(e){e.checked&&(s.push(e),r.push(e.value))}),r.length&&!c))||(!o&&n&&n.renderFilter&&(o=n.filterMethod),o?s.some(function(e){return o({value:e.value,option:e,row:a,column:t})}):-1<r.indexOf(_xeUtils.default.get(a,e)))})}),l&&l.order)&&!(_xeUtils.default.isBoolean(l.remoteSort)?l.remoteSort:i))if(this.sortMethod)o=this.sortMethod({data:o,column:l,property:l.property,order:l.order,$table:this})||o;else{var r=l.sortMethod?o.sort(l.sortMethod):_xeUtils.default.sortBy(o,l.property);o="desc"===l.order?r.reverse():r}return this.afterFullData=o},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:o.slice(0)}},handleDefault:function(){(this.checkboxConfig||this.selectConfig)&&this.handleSelectionDefChecked(),this.radioConfig&&this.handleRadioDefChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(i){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=i.find(function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.updateSetting(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,e=this,o=0,l=[],n=null,r=null,s=[],a=[],t=this.collectColumn,c=this.tableFullColumn,u=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;u&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),c.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=o),i||(t-o!=0?i=!0:o++),l.push(e)):"right"===e.fixed?(i||(null===r&&(r=t),t-r!=0?i=!0:r++),a.push(e)):s.push(e)});var g=l.concat(s).concat(a),v=f&&f.gt&&f.gt<c.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),u&&(i||n||null!==r&&r!==g.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),v&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),d.startIndex=0,d.visibleIndex=0,g=g.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=v,this.tableColumn=g,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,o=[],l=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?o.push(e):_tools.DomTools.isPx(e.width||t)?l.push(e):_tools.DomTools.isScale(e.width||t)?r.push(e):_tools.DomTools.isPx(e.minWidth||i)?n.push(e):_tools.DomTools.isScale(e.minWidth||i)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:o,pxList:l,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,i=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||i)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,i)})},recalculate:function(e){var t=this,i=this.$refs,o=i.tableBody,l=i.tableHeader,n=i.tableFooter,r=o?o.$el:null,s=l?l.$el:null,a=n?n.$el:null;if(r){var c=r.clientWidth;if(this.autoCellWidth(s,r,a,c),!0===e)return this.computeScrollLoad().then(function(){c=r.clientWidth,t.autoCellWidth(s,r,a,c),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,i,l){var n,r=0,o=l,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,g=a.autoList;u.forEach(function(e){var t=parseInt(e.minWidth);r+=t,e.renderWidth=t}),n=o/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);r+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);r+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);r+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);r+=t,e.renderWidth=t}),n=0<(o-=r)?Math.floor(o/(f.length+u.length+g.length)):0,s?0<o&&f.concat(u).forEach(function(e){r+=n,e.renderWidth+=n}):n=40,g.forEach(function(e,t){var i=Math.max(n,40);if(e.renderWidth=i,r+=i,s&&t===g.length-1){var o=l-r;0<o&&(e.renderWidth+=o,r=l)}});var v=t.offsetHeight,p=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=p?t.offsetWidth-l:0,this.overflowY=p,this.tableWidth=r,this.tableHeight=v,this.containerHeight=this.getParentHeight(),e&&(this.headerHeight=e.offsetHeight),i){var m=i.offsetHeight;this.scrollbarHeight=Math.max(m-i.clientHeight,0),this.overflowX=r>i.clientWidth,this.footerHeight=m}else this.scrollbarHeight=Math.max(v-t.clientHeight,0),this.overflowX=l<r;return this.overflowX&&this.checkScrolling(),r},resetResizable:function(){return this.visibleColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftBody,o=e.rightBody,l=t?t.$el:null;l&&(i&&(this.scrollLeftToRight=0<l.scrollLeft),o&&(this.scrollRightToLeft=l.clientWidth<l.scrollWidth-l.scrollLeft))},preventEvent:function(t,e,i,o,l){var n,r=this;return _vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,r)})||o&&(n=o()),l&&l(),n},handleGlobalMousedownEvent:function(i){var o=this,l=this.$el,e=this.$refs,t=this.editStore,n=this.ctxMenuStore,r=this.editConfig,s=void 0===r?{}:r,a=this.filterStore,c=this.getEventTargetNode,u=this.getRowNode,h=t.actived,d=e.filterWrapper,f=e.validTip;d&&(c(i,this.$el,"vxe-filter-wrapper").flag||c(i,d.$el).flag||this.preventEvent(i,"event.clearFilter",a.args,this.closeFilter)),h.row&&!1!==s.autoClear&&(f&&c(i,f.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clearActived",h.args,function(){var e;if("row"===s.mode){var t=c(i,l,"vxe-body--row");e=t.flag?u(t.targetElem).item!==u(h.args.cell.parentNode).item:0}else e=!c(i,l,"col--edit").flag;!e&&c(i,o.$el).flag||setTimeout(function(){return o.clearActived(i)})})),n.visible&&this.$refs.ctxWrapper&&!c(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=c(i,this.$el).flag},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(O){var L=this;this.isActivated&&this.preventEvent(O,"event.keydown",{$table:this},function(){var e,t=L.isCtxMenu,i=L.ctxMenuStore,o=L.editStore,l=L.mouseConfig,n=void 0===l?{}:l,r=L.keyboardConfig,s=void 0===r?{}:r,a=L.treeConfig,c=L.highlightCurrentRow,u=L.currentRow,h=o.selected,d=o.actived,f=O.keyCode,g=8===f,v=9===f,p=13===f,m=27===f,x=32===f,b=37===f,w=38===f,C=39===f,T=40===f,_=46===f,S=67===f,R=86===f,y=88===f,E=113===f,D=O.ctrlKey,U=O.shiftKey,k=b||w||C||T,I=t&&i.visible&&(p||x||k);if(m)L.closeMenu(),L.closeFilter(),d.row&&(e=d.args,L.clearActived(O),n.selected&&L.handleSelected(e,O));else if(x&&(s.isArrow||s.isTab)&&h.row&&h.column&&("checkbox"===h.column.type||"selection"===h.column.type||"radio"===h.column.type))O.preventDefault(),"checkbox"===h.column.type||"selection"===h.column.type?L.handleToggleCheckRowEvent(h.args,O):L.triggerRadioRowEvent(O,h.args);else if(p&&(s.isArrow||s.isTab)&&(h.row||d.row||a&&c&&u)){if(h.row||d.row)L.moveSelected(h.row?h.args:d.args,b,w,C,!0,O);else if(a&&c&&u){var $=u[a.children];if($&&$.length){O.preventDefault();var F=$[0];e={$table:L,row:F},L.setTreeExpansion(u,!0).then(function(){return L.scrollToRow(F)}).then(function(){return L.triggerCurrentRowEvent(O,e)})}}}else if(I)O.preventDefault(),i.showChild&&_tools.UtilTools.hasChildrenList(i.selected)?L.moveCtxMenu(O,f,i,"selectChild",37,!1,i.selected.children):L.moveCtxMenu(O,f,i,"selected",39,!0,L.ctxMenuList);else if(E)h.row&&h.column&&(O.preventDefault(),L.handleActived(h.args,O));else if(k&&s.isArrow)h.row&&h.column?L.moveSelected(h.args,b,w,C,T,O):(w||T)&&c&&u&&L.moveCurrentRow(w,T,O);else if(v&&s.isTab)h.row||h.column?L.moveTabSelected(h.args,U,O):(d.row||d.column)&&L.moveTabSelected(d.args,U,O);else if(_||(a&&c&&u?g&&s.isArrow:g)){if(s.isDel&&(h.row||h.column))_tools.UtilTools.setCellValue(h.row,h.column,null),g&&L.handleActived(h.args,O);else if(g&&s.isArrow&&a&&c&&u){var M=_xeUtils.default.findTree(L.afterFullData,function(e){return e===u},a).parent;M&&(O.preventDefault(),e={$table:L,row:M},L.setTreeExpansion(M,!1).then(function(){return L.scrollToRow(M)}).then(function(){return L.triggerCurrentRowEvent(O,e)}))}}else s.isCut&&D&&(y||S||R)?y||S?L.handleCopyed(y,O):L.handlePaste(O):s.isEdit&&!D&&(48<=f&&f<=57||65<=f&&f<=90||96<=f&&f<=111||186<=f&&f<=192||219<=f&&f<=222||32===f)&&(h.row||h.column)&&(s.editMethod&&!1===s.editMethod(h.args,O)||(_tools.UtilTools.setCellValue(h.row,h.column,null),L.handleActived(h.args,O)))})},moveTabSelected:function(e,t,i){var o,l,n,r,s=this.afterFullData,a=this.visibleColumn,c=this.editConfig,u=Object.assign({},e),h=s.indexOf(u.row),d=a.indexOf(u.column);if(i.preventDefault(),t){for(var f=d-1;0<=f;f--){var g=a[f];if(g&&"index"!==g.type){r=f,n=g;break}}if(!n&&0<h){o=s[l=h-1];for(var v=a.length-1;0<=v;v--){var p=a[v];if(p&&"index"!==p.type){r=v,n=p;break}}}}else{for(var m=d+1;m<a.length;m++){var x=a[m];if(x&&"index"!==x.type){r=m,n=x;break}}if(!n&&h<s.length-1){o=s[l=h+1];for(var b=0;b<a.length;b++){var w=a[b];if(w&&"index"!==w.type){r=b,n=w;break}}}}n&&(o?(u.rowIndex=l,u.row=o):u.rowIndex=h,u.columnIndex=r,u.column=n,u.cell=_tools.DomTools.getCell(this,u),c&&("click"!==c.trigger&&"dblclick"!==c.trigger||("row"===c.mode?this.handleActived(u,i):(this.handleSelected(u,i),this.scrollToRow(u.row,u.column)))))},moveCurrentRow:function(e,t,i){var o,l=this,n=this.currentRow,r=this.treeConfig,s=this.afterFullData;if(i.preventDefault(),r){var a=_xeUtils.default.findTree(s,function(e){return e===n},r),c=a.index,u=a.items;e&&0<c?o=u[c-1]:t&&c<u.length-1&&(o=u[c+1])}else{var h=s.indexOf(n);e&&0<h?o=s[h-1]:t&&h<s.length-1&&(o=s[h+1])}if(o){var d={$table:this,row:o};this.scrollToRow(o).then(function(){return l.triggerCurrentRowEvent(i,d)})}},moveSelected:function(e,t,i,o,l,n){var r=this.afterFullData,s=this.visibleColumn,a=Object.assign({},e);if(n.preventDefault(),i&&a.rowIndex)a.rowIndex-=1,a.row=r[a.rowIndex];else if(l&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var c=a.columnIndex-1;0<=c;c--)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}}else if(o&&a.columnIndex)for(var u=a.columnIndex+1;u<s.length;u++)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,i,o,l,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return i[o]===e});if(t===l)n&&_tools.UtilTools.hasChildrenList(i.selected)?i.showChild=!0:(i.showChild=!1,i.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}i[o]=s||r[r.length-1]}else if(40===t){for(var u=a+1;u<r.length;u++)if(!1!==r[u].visible){s=r[u];break}i[o]=s||r[0]}else!i[o]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,i[o])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,i=this.ctxMenuStore,o=this.ctxMenuOpts,l=["header","body","footer"];if(t){if(i.visible&&i.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var n=0;n<l.length;n++){var r=l[n],s=this.getEventTargetNode(e,this.$el,"vxe-".concat(r,"--column")),a={type:r,$table:this,columns:this.visibleColumn.slice(0)};if(s.flag){var c=s.targetElem,u=this.getColumnNode(c).item,h="".concat(r,"-");if(Object.assign(a,{column:u,columnIndex:this.getColumnIndex(u),cell:c}),"body"===r){var d=this.getRowNode(c.parentNode).item;h="",a.row=d,a.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,r,a),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[a,e])}if(this.getEventTargetNode(e,this.$el,"vxe-table--".concat(r,"-wrapper")).flag)return void("cell"===o.trigger?e.preventDefault():this.openContextMenu(e,r,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(c,e,o){var u=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,i=t[e];if(i){var l=i.options,n=i.disabled,d=i.visibleMethod||t.visibleMethod;n?c.preventDefault():l&&l.length&&(o.options=l,this.preventEvent(c,"event.showMenu",o,null,function(){if(!d||d(o,c)){c.preventDefault(),u.updateZindex();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,i=e.scrollLeft,n=e.visibleHeight,r=e.visibleWidth,s=c.clientY+t,a=c.clientX+i;Object.assign(h,{args:o,visible:!0,list:l,selected:null,selectChild:null,showChild:!1,style:{zIndex:u.tZindex,top:"".concat(s,"px"),left:"".concat(a,"px")}}),u.$nextTick(function(){var e=u.$refs.ctxWrapper.$el,t=e.clientHeight,i=e.clientWidth,o=c.clientY+t-n,l=c.clientX+i-r;-10<o&&(h.style.top="".concat(s-t,"px")),-10<l&&(h.style.left="".concat(a-i,"px"))})}else u.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,i){var o=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),o.selected=t,(o.selectChild=i)||(o.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,i){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var i=_vXETable.Menus.get(t.code),o=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);i&&i.call(this,o,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},handleTooltipLeaveEvent:function(e){var t=this,i=this.tooltipConfig;setTimeout(function(){t.tooltipActive||t.clostTooltip()},(void 0===i?{}:i).leaveDelay||_conf.default.tooltip.leaveDelay)},handleTargetEnterEvent:function(e){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(e){var t=this,i=this.tooltipConfig,o=void 0===i?{}:i;this.tooltipActive=!1,o.enterable?this.tooltipTimeout=setTimeout(function(){t.$refs.tooltip.isHover||t.clostTooltip()},o.leaveDelay||_conf.default.tooltip.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,o=t.column;this.handleTargetEnterEvent(),i.column===o&&i.visible||this.handleTooltip(e,o)},triggerFooterTooltipEvent:function(e,t){var i=t.column,o=this.tooltipStore;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,o=this.editStore,l=this.tooltipStore,n=o.actived,r=t.row,s=t.column;this.handleTargetEnterEvent(),i&&("row"===i.mode&&n.row===r||n.row===r&&n.column===s)||l.column===s&&l.row===r&&l.visible||this.handleTooltip(e,s,r)},handleTooltip:function(e,t,i){var o=e.currentTarget,l=this.$refs.tooltip,n=o.children[0],r=o.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:i,column:t,visible:!0}),l&&l.toVisible(o,r)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleSelectionDefChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxConfig||this.selectConfig||{},i=e.checkAll,o=e.checkRowKeys;if(i)this.setAllSelection(!0);else if(o){var l=[];o.forEach(function(e){t[e]&&l.push(t[e].row)}),this.setSelection(l,!0)}},setSelection:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow(null,{row:e},!!t)}),this.$nextTick()},handleSelectRow:function(e,t,i){var o=t.row,l=this.selection,n=this.tableFullData,r=this.treeConfig,s=this.treeIndeterminates,a=this.checkboxConfig||this.selectConfig||{},c=a.checkStrictly,u=a.checkMethod,h=a.checkField||a.checkProp;if(h)if(r&&!c){-1===i?(s.push(o),_xeUtils.default.set(o,h,!1)):(_xeUtils.default.eachTree([o],function(e,t){o!==e&&u&&!u({row:e,$rowIndex:t})||_xeUtils.default.set(e,h,i)},r),_xeUtils.default.remove(s,function(e){return e===o}));var d=_xeUtils.default.findTree(n,function(e){return e===o},r);if(d&&d.parent){var f,g=u?d.items.filter(function(e,t){return u({row:e,$rowIndex:t})}):d.items;if(d.items.find(function(e){return-1<s.indexOf(e)}))f=-1;else{var v=d.items.filter(function(e){return _xeUtils.default.get(e,h)});f=v.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!v.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:d.parent},f)}}else _xeUtils.default.set(o,h,i);else if(r&&!c){-1===i?(s.push(o),_xeUtils.default.remove(l,function(e){return e===o})):(_xeUtils.default.eachTree([o],function(t,e){o!==t&&u&&!u({row:t,$rowIndex:e})||(i?l.push(t):_xeUtils.default.remove(l,function(e){return e===t}))},r),_xeUtils.default.remove(s,function(e){return e===o}));var p=_xeUtils.default.findTree(n,function(e){return e===o},r);if(p&&p.parent){var m,x=u?p.items.filter(function(e,t){return u({row:e,$rowIndex:t})}):p.items;if(p.items.find(function(e){return-1<s.indexOf(e)}))m=-1;else{var b=p.items.filter(function(e){return-1<l.indexOf(e)});m=b.filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!b.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:p.parent},m)}}else i?-1===l.indexOf(o)&&l.push(o):_xeUtils.default.remove(l,function(e){return e===o});this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selection,o=(this.checkboxConfig||this.selectConfig||{}).checkField,l=e.row,n=o?!_xeUtils.default.get(l,o):-1===i.indexOf(l);t?this.triggerCheckRowEvent(t,e,n):this.handleSelectRow(null,e,n)},triggerCheckRowEvent:function(e,t,i){var o=(this.checkboxConfig||this.selectConfig||{}).checkMethod;o&&!o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(e,t,i),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:i,$table:this},t),e]))},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(o){var e=this.tableFullData,t=this.editStore,i=this.treeConfig,l=this.selection,n=this.checkboxConfig||this.selectConfig||{},r=n.reserve,s=n.checkStrictly,a=n.checkMethod,c=t.insertList,u=n.checkField||n.checkProp,h=[];if(c.length&&(e=e.concat(c)),!s){if(u){var d="".concat(i?"$":"","rowIndex"),f=function(e,t){var i;a&&!a((_defineProperty(i={row:e},d,t),_defineProperty(i,"$rowIndex",t),i))||_xeUtils.default.set(e,u,o)},g=function(e,t){var i;(!a||!a((_defineProperty(i={row:e},d,t),_defineProperty(i,"$rowIndex",t),i))&&-1<l.indexOf(e))&&_xeUtils.default.set(e,u,o)};i?_xeUtils.default.eachTree(e,o?f:g,i):e.forEach(o?f:g)}else i?o?_xeUtils.default.eachTree(e,function(e,t){a&&!a({row:e,$rowIndex:t})||h.push(e)},i):a&&_xeUtils.default.eachTree(e,function(e,t){!a({row:e,$rowIndex:t})&&-1<l.indexOf(e)&&h.push(e)},i):o?h=a?e.filter(function(e,t){return-1<l.indexOf(e)||a({row:e,rowIndex:t,$rowIndex:t})}):e.slice(0):a&&(h=e.filter(function(e,t){return a({row:e,rowIndex:t,$rowIndex:t})?0:-1<l.indexOf(e)}));this.selection=o&&r?l.concat(h.filter(function(e){return-1===l.indexOf(e)})):h}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,i=this.selection,o=this.treeIndeterminates,l=this.checkboxConfig||this.selectConfig||{},n=l.checkStrictly,r=l.checkMethod,s=l.checkField||l.checkProp,a=t.insertList;a.length&&(e=e.concat(a)),n||(s?(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,s)}:function(e){return _xeUtils.default.get(e,s)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,s)||-1<o.indexOf(e)})):(this.isAllSelected=e.length&&e.every(r?function(e,t){return!r({row:e,rowIndex:t,$rowIndex:t})||-1<i.indexOf(e)}:function(e){return-1<i.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<o.indexOf(e)||-1<i.indexOf(e)})))},reserveCheckSelection:function(){var e=this.selection,i=this.fullDataRowIdData,t=(this.checkboxConfig||this.selectConfig||{}).reserve,o=_tools.UtilTools.getRowkey(this);t&&e.length&&(this.selection=e.map(function(e){var t=""+_xeUtils.default.get(e,o);return i[t]?i[t].row:e}))},getSelectReserveRecords:function(){var e=this.selection,t=this.fullDataRowIdData,i=(this.checkboxConfig||this.selectConfig||{}).reserve,o=_tools.UtilTools.getRowkey(this);return i&&e.length?e.filter(function(e){return!t[""+_xeUtils.default.get(e,o)]}):[]},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.treeConfig,i=this.checkboxConfig||this.selectConfig||{},o=i.checkField||i.checkProp;return o&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,o,!1)},t):e.forEach(function(e){return _xeUtils.default.set(e,o,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleRadioDefChecked:function(){var e=this.radioConfig,t=void 0===e?{}:e,i=this.fullDataRowIdData,o=t.checkRowKey;o&&this.setRadioRow(i[o].row)},triggerRadioRowEvent:function(e,t){var i=this.radioConfig,o=(void 0===i?{}:i).checkMethod;if(!o||o({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var l=this.selectRow!==t.row;this.setRadioRow(t.row),l&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.hoverRow=i},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleSelected,a=this.handleChecked,c=n.checked,u=n.actived,h=t.row,d=t.column,f=t.cell,g=e.button,v=0===g;if((v||2===g)&&r&&"dblclick"===r.trigger)if("row"===r.mode&&u.row===h||u.row===h&&u.column===d);else if(v){e.preventDefault(),e.stopPropagation(),this.handleSelected(t,e);var p=document.onmousemove,m=document.onmouseup,x=_tools.DomTools.getCellIndexs(f),b=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&a(x,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=b,document.onmouseup=function(e){document.onmousemove=p,document.onmouseup=m},this.closeFilter(),this.closeMenu()}else{var w=_tools.DomTools.getCellIndexs(f);-1!==c.rows.indexOf(i[w.rowIndex])&&-1!==c.columns.indexOf(o[w.columnIndex])||s(t,e)}this.isActivated=!0},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var l=this.$el,i=this.tableData,o=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleTempChecked,a=n.checked,c=t.button;if((0===c||2===c)&&r&&a.rows.length&&"dblclick"===r.trigger){var u=document.onmousemove,h=document.onmouseup,d={rowIndex:i.indexOf(a.rows[0]),columnIndex:o.indexOf(a.columns[0])},f=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,l,"vxe-body--column"),i=t.flag,o=t.targetElem;i&&s(d,_tools.DomTools.getCellIndexs(o),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=f,document.onmouseup=function(e){document.onmousemove=u,document.onmouseup=h,a.rows=a.tRows,a.columns=a.tColumns}}this.isActivated=!0},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,o=this.sortOpts,l=t.column,n=t.cell,r=i&&i>Date.now()-300,s=this.getEventTargetNode(e,n,"vxe-sort-wrapper").flag,a=this.getEventTargetNode(e,n,"vxe-filter-wrapper").flag;return"cell"!==o.trigger||r||s||a||this.triggerSortEvent(e,l,"desc"===l.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(l,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var i=this,o=this.$el,l=this.highlightCurrentRow,n=this.editStore,r=this.radioConfig,s=void 0===r?{}:r,a=this.expandConfig,c=void 0===a?{}:a,u=this.treeConfig,h=void 0===u?{}:u,d=this.editConfig,f=n.actived,g=t.column,v=this.checkboxConfig||this.selectConfig||{};isTargetRadioOrCheckbox(e,g,"radio")||isTargetRadioOrCheckbox(e,g,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,g,"selection","checkbox")||("row"!==c.trigger&&("expand"!==g.type||"cell"!==c.trigger)||this.getEventTargetNode(e,o,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===h.trigger||g.treeNode&&"cell"===h.trigger)&&this.triggerTreeExpandEvent(e,t),g.treeNode&&this.getEventTargetNode(e,o,"vxe-tree-wrapper").flag||"expand"===g.type&&this.getEventTargetNode(e,o,"vxe-table--expanded").flag||(l&&("row"!==s.trigger&&(this.getEventTargetNode(e,o,"vxe-checkbox").flag||this.getEventTargetNode(e,o,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==s.trigger&&("radio"!==g.type||"cell"!==s.trigger)||this.getEventTargetNode(e,o,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==v.trigger&&("checkbox"!==g.type&&"selection"!==g.type||"cell"!==v.trigger)||this.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),d&&("click"===d.trigger?f.args&&e.currentTarget===f.args.cell||("row"===d.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===d.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===d.trigger&&("row"===d.mode&&f.row===t.row?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var i=this,o=this.editStore,l=this.editConfig,n=o.actived;l&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var i=this,o=this.editStore,l=this.editConfig,n=l.activeMethod,r=o.actived,s=e.row,a=e.column,c=e.cell;if(a.editRender&&c)if("row"===l.mode?r.row!==s:r.row!==s||r.column!==a){var u="edit-disabled";n&&!n(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),u="edit-actived",a.renderHeight=c.offsetHeight,r.args=e,r.row=s,r.column=a,this.$nextTick(function(){i.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,u,[e,t])}else a.renderHeight=c.offsetHeight,r.args=e,r.column!==a&&this.clearValidate(),setTimeout(function(){i.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,i=t.args,o=t.row,l=t.column;return(o||l)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[i,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){var e=this.$el,t=this.editStore,i=this.tableData,o=t.actived,l=o.args,n=o.row;return l&&-1<i.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},l):null},hasActiveRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasActiveRow","isActiveByRow"]),this.isActiveByRow(e)},isActiveByRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore.selected;return t.row=null,t.column=null,this.$nextTick()},handleSelected:function(t,i){var o=this,e=this.mouseConfig,l=void 0===e?{}:e,n=this.editConfig,r=this.editStore,s=r.actived,a=r.selected,c=t.row,u=t.column;return function(){if((l.selected||l.checked)&&(a.row!==c||a.column!==u)&&(s.row!==c||"cell"===n.mode&&s.column!==u)&&(o.clearChecked(i),o.clearActived(i),a.args=t,a.row=c,a.column=u,l.checked)){var e=_tools.DomTools.getCellIndexs(t.cell);o.handleChecked(e,e,i)}return o.$nextTick()}()},clearChecked:function(e){var t=this.editStore.checked;return t.rows=[],t.columns=[],t.tRows=[],t.tColumns=[],this.$nextTick()},getMouseSelecteds:function(){var e=this.editStore.selected,t=e.args,i=e.column;return t&&i?Object.assign({},t):null},getMouseCheckeds:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t,i){var o=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=e.rowIndex,s=e.columnIndex,a=t.rowIndex,c=t.columnIndex;n.tRows=[],n.tColumns=[],n.rows=r<a?o.slice(r,a+1):o.slice(a,r+1),n.columns=s<c?l.slice(Math.max(s,1),c+1):l.slice(Math.max(c,1),s+1)},handleTempChecked:function(e,t,i){var o=this.tableData,l=this.visibleColumn,n=this.editStore.checked,r=n.rows,s=n.tRows,a=n.columns,c=n.tColumns,u=e.rowIndex,h=e.columnIndex,d=t.rowIndex,f=t.columnIndex;s.length>r.length?f=l.indexOf(a[a.length-1]):c.length>a.length&&(d=o.indexOf(r[r.length-1])),u<d?n.tRows=o.slice(u,d+1):(u+=r.length,n.tRows=o.slice(d,u)),h<f?n.tColumns=l.slice(Math.max(h,1),f+1):(h+=a.length,n.tColumns=l.slice(Math.max(f,1),h))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e,t){var i=this.editStore,o=i.copyed,l=i.checked;o.cut=e,o.rows=l.rows,o.columns=l.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,i=this.editStore,o=i.copyed,l=i.selected,r=o.cut,s=o.rows,a=o.columns;if(s.length&&a.length&&l.row&&l.column){var c=l.args,u=c.rowIndex,h=c.columnIndex,d={rowIndex:u,columnIndex:h},f={rowIndex:u+s.length-1,columnIndex:h+a.length-1};s.forEach(function(o,e){var l=t[u+e];l&&a.forEach(function(e,t){var i=n[h+t];i&&_tools.UtilTools.setCellValue(l,i,_tools.UtilTools.getCellValue(o,e)),r&&_tools.UtilTools.setCellValue(o,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e,t){var i=e.row,o=e.column,l=e.cell,n=o.editRender;if(n){var r,s=_vXETable.Renderer.get(n.name),a=n.autofocus,c=n.autoselect;if(a&&(r=l.querySelector(a)),!r&&s&&s.autofocus&&(r=l.querySelector(s.autofocus)),r){if(r[c?"select":"focus"](),browse.msie){var u=r.createTextRange();u.collapse(!1),u.select()}}else this.scrollToRow(i,o)}},setActiveRow:function(e){return this.setActiveCell(e,this.visibleColumn.find(function(e){return e.editRender}).property)},setActiveCell:function(i,o){var l=this;return this.scrollToRow(i).then(function(){if(i&&o){var e=l.visibleColumn.find(function(e){return e.property===o});if(e&&e.editRender){var t=_tools.DomTools.getCell(l,{row:i,column:e});t&&(l.handleActived({row:i,rowIndex:l.getRowIndex(i),column:e,columnIndex:l.getColumnIndex(e),cell:t,$table:l}),l.lastCallTime=Date.now())}}return l.$nextTick()})},setSelectCell:function(e,t){var i=this.tableData,o=this.editConfig,l=this.visibleColumn;if(e&&t&&"manual"!==o.trigger){var n=l.find(function(e){return e.property===t}),r=i.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:l.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},triggerSortEvent:function(e,t,i){var o=t.property;if(t.sortable||t.remoteSort){var l={column:t,property:o,field:o,prop:o,order:i,$table:this};t.order===i?(l.order=null,this.clearSort(t.property)):this.sort(o,i),_tools.UtilTools.emitEvent(this,"sort-change",[l,e])}},sort:function(t,e){var i=this.visibleColumn,o=this.tableFullColumn,l=this.remoteSort,n=i.find(function(e){return e.property===t}),r=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:l;return(n.sortable||n.remoteSort)&&(e||(e="desc"===n.order?"asc":"desc"),n.order!==e&&(o.forEach(function(e){e.order=null}),n.order=e,r||this.handleTableData(!0))),this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},filter:function(e,t){var i=this.getColumnByField(e),o=i.filters;if(t){var l=t(o);_xeUtils.default.isArray(l)&&(i.filters=_tools.UtilTools.getFilters(l))}return this.$nextTick().then(function(){return o})},triggerFilterEvent:function(e,t,i){var o=this.$refs,l=this.filterStore;if(l.column===t&&l.visible)l.visible=!1;else{var n=o.filterWrapper,r=e.target,s=e.pageX,a=_tools.DomTools.getDomNode().visibleWidth,c=_tools.DomTools.getAbsolutePos(r),u=c.top,h=c.left;(!l.zIndex||l.zIndex<_tools.UtilTools.getLastZIndex())&&(l.zIndex=_tools.UtilTools.nextZIndex(this)),Object.assign(l,{args:i,multiple:t.filterMultiple,options:t.filters,column:t,style:{zIndex:l.zIndex,top:"".concat(u+r.clientHeight+6,"px"),left:"".concat(h,"px")},visible:!0}),l.isAllSelected=l.options.every(function(e){return e.checked}),l.isIndeterminate=!l.isAllSelected&&l.options.some(function(e){return e.checked}),this.$nextTick(function(){var e=n.$el.clientWidth,t=h-e/2+10;a<s+e&&(t=h-e),l.style.left="".concat(Math.max(20,t+20),"px"),l.style.top="".concat(u+r.clientHeight+6,"px")})}},confirmFilterEvent:function(e){var t=this.visibleColumn,i=this.filterStore,o=this.remoteFilter,l=this.scrollXLoad,n=this.scrollYLoad,r=i.column,s=r.property,a=[],c=[];r.filters.forEach(function(e){e.checked&&(a.push(e.value),c.push(e.data))}),i.visible=!1,o||this.handleTableData(!0);var u=[];t.filter(function(e){var t=e.property,i=e.filters,o=[],l=[];i&&i.length&&(i.forEach(function(e){e.checked&&(o.push(e.value),l.push(e.data))}),u.push({column:e,property:t,field:t,prop:t,values:o,datas:l}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,property:s,field:s,prop:s,values:a,datas:c,filters:u,$table:this}]),this.updateFooter(),(l||n)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){var t=arguments.length?this.getColumnByField(e):null,i=this.filterStore,o=function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})};return t?o(t):this.visibleColumn.forEach(o),t&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},triggerRowExpandEvent:function(e,t){var i=t.row,o=this.toggleRowExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:i,rowIndex:this.getRowIndex(i),$table:this},e]),o},toggleRowExpansion:function(e){return this.setRowExpansion(e)},handleDefaultRowExpand:function(){var e=this.expandConfig,t=void 0===e?{}:e,i=this.tableFullData,o=this.fullDataRowIdData,l=t.expandAll,n=t.expandRowKeys;if(l)this.expandeds=i.slice(0);else if(n){var r=[];n.forEach(function(e){o[e]&&r.push(o[e].row)}),this.expandeds=r}},setAllRowExpansion:function(e){return this.expandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate)},setRowExpansion:function(e,i){var o=this.expandeds,t=this.expandConfig,l=void 0===t?{}:t,n=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),l.accordion&&(o.length=0,e=e.slice(e.length-1,e.length)),e.forEach(function(e){var t=o.indexOf(e);-1<t?!n&&i||o.splice(t,1):(n||i)&&o.push(e)})),this.$nextTick().then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.expandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.expandeds.length;return this.expandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.expandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeConfig,expandeds:this.getTreeExpandRecords()}:null},triggerTreeExpandEvent:function(e,t){var i=t.row,o=this.toggleTreeExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:i,rowIndex:this.getRowIndex(i),$table:this},e]),o},toggleTreeExpansion:function(e){return this.setTreeExpansion(e)},handleDefaultTreeExpand:function(){var o=this.treeConfig,l=this.tableFullData;if(o){var e=o.expandAll,t=o.expandRowKeys,n=o.children,r=[];if(e)_xeUtils.default.filterTree(l,function(e){var t=e[n];t&&t.length&&r.push(e)},o),this.treeExpandeds=r;else if(t){var s=_tools.UtilTools.getRowkey(this);t.forEach(function(t){var e=_xeUtils.default.findTree(l,function(e){return t===_xeUtils.default.get(e,s)},o),i=e?e.item[n]:0;i&&i.length&&r.push(e.item)}),this.treeExpandeds=r}}},setAllTreeExpansion:function(e){var t=this.tableFullData,i=this.treeConfig,o=i.children,l=[];return e&&_xeUtils.default.eachTree(t,function(e){var t=e[o];t&&t.length&&l.push(e)},i),this.treeExpandeds=l,this.$nextTick().then(this.recalculate)},setTreeExpansion:function(e,l){var n=this.tableFullData,r=this.treeExpandeds,s=this.treeConfig,a=s.children,c=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),s.accordion&&(e=e.slice(e.length-1,e.length)),e.forEach(function(t){var e=t[a];if(e&&e.length){var i=r.indexOf(t);if(s.accordion){var o=_xeUtils.default.findTree(n,function(e){return e===t},s);_xeUtils.default.remove(r,function(e){return-1<o.items.indexOf(e)})}-1<i?!c&&l||r.splice(i,1):(c||l)&&r.push(t)}})),this.$nextTick().then(this.recalculate)},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},isScrollXLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollXLoad","getVirtualScroller"]),this.scrollXLoad},isScrollYLoad:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["isScrollYLoad","getVirtualScroller"]),this.scrollYLoad},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,o=e.tableBody.$el;return{scrollX:t,scrollY:i,scrollTop:o.scrollTop,scrollLeft:o.scrollLeft}},triggerScrollXEvent:function(e){this.updateVirtualScrollX()},updateVirtualScrollX:function(e){for(var t=this.$refs,i=this.visibleColumn,o=this.scrollXStore,l=o.startIndex,n=o.renderSize,r=o.offsetSize,s=o.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=e||!1,d=0;d<i.length;d++)if(a<(u+=i[d].renderWidth)){c=d;break}if(e||o.visibleIndex!==c){var f=Math.min(Math.floor((n-s)/2),s);o.visibleIndex===c?o.startIndex=c:o.visibleIndex>c?(h=c-r<=l)&&(o.startIndex=Math.max(0,Math.max(f,c-f))):(h=l+n<=c+s+r)&&(o.startIndex=Math.max(0,Math.min(i.length-n,c-f))),h&&this.updateScrollXData(),o.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,i=this.scrollYStore,o=this.isLoadData,l=i.startIndex,n=i.renderSize,r=i.offsetSize,s=i.visibleSize,a=i.rowHeight,c=e.target.scrollTop,u=Math.ceil(c/a),h=!1;if(o||i.visibleIndex!==u){var d=Math.min(Math.floor((n-s)/2),s);i.visibleIndex>u?(h=u-r<=l)&&(i.startIndex=Math.max(0,u-Math.max(d,n-s))):(h=l+n<=u+s+r)&&(i.startIndex=Math.max(0,Math.min(t.length-n,u-d))),h&&this.updateScrollYData(),i.visibleIndex=u,this.isLoadData=!1}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeScrollLoad:function(){var b=this;return this.$nextTick().then(function(){var e=b.vSize,t=b.scrollXLoad,i=b.scrollYLoad,o=b.scrollYStore,l=b.scrollXStore,n=b.visibleColumn,r=b.optimizeOpts,s=b.rowHeightMaps,a=r.scrollX,c=r.scrollY,u=b.$refs.tableBody,h=u?u.$el:null,d=b.$refs.tableHeader;if(h){if(t){var f=n[0],g=f?f.renderWidth:40,v=_xeUtils.default.toNumber(a.vSize||Math.ceil(h.clientWidth/g));l.visibleSize=v,a.oSize||(l.offsetSize=v),a.rSize||(l.renderSize=v+4),b.updateScrollXData()}else b.updateScrollXSpace();if(i){var p;if(c.rHeight)p=c.rHeight;else{var m=h.querySelector("tbody>tr");!m&&d&&(m=d.$el.querySelector("thead>tr")),m&&(p=m.clientHeight)}p||(p=s[e||"default"]);var x=_xeUtils.default.toNumber(c.vSize||Math.ceil(h.clientHeight/p));o.visibleSize=x,o.rowHeight=p,c.oSize||(o.offsetSize=x),c.rSize||(o.renderSize=x*(browse.edge?10:8)),b.updateScrollYData()}else b.updateScrollYSpace()}return b.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,i=t.length*e.rowHeight;e.ySpaceHeight=i,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var i=this,o=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:o.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var n=this.$refs.rightBody;n&&(n.$el.scrollTop=t),o.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var i=[];return e&&this.fullAllDataRowMap.has(e)&&i.push(_tools.DomTools.rowToVisible(this,e)),i.push(this.scrollToColumn(t)),Promise.all(i)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var i=this,e=this.tableFullData,o=this.treeConfig;if(o){var l=_xeUtils.default.findTree(e,function(e){return e===t},o);if(l){var n=l.nodes;n.forEach(function(e,t){t<n.length-1&&!i.hasTreeExpand(e)&&i.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var n=this;return this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick().then(function(){var e=n.$refs,t=e.tableBody,i=t?t.$el:null,o=e.tableFooter,l=(o?o.$el:null)||i;return i&&(i.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(n.$nextTick())})})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,i=u.editRules,o=u.validStore;if(a&&e.tableBody&&i){var l=a.row,n=a.column;if(u.hasCellRules("change",l,n)){var r=t.indexOf(l),s=_tools.DomTools.getCell(u,{row:l,rowIndex:r,column:n});if(s)return u.validCellRules("change",l,n,c).then(function(){h&&o.visible&&_tools.UtilTools.setCellValue(l,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(l,n,c),u.showValidTooltip({rule:t,row:l,column:n,cell:s})})}}})},triggerValidate:function(o){var l=this,e=this.editConfig,t=this.editStore,i=this.editRules,n=this.validStore,r=t.actived;if(r.row&&i){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(o,a,c))return this.validCellRules(o,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&l.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&o!==t.trigger)return Promise.resolve();var i={rule:t,row:a,column:c,cell:u};return l.showValidTooltip(i),Promise.reject(i)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,a,c){var u=this,h={},d=!0,t=this.editRules,f=this.afterFullData,g=this.treeConfig,i=f;e&&(_xeUtils.default.isFunction(e)?a=e:i=_xeUtils.default.isArray(e)?e:[e]);var o=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var l=this.getColumns(),n=function(r){var e=[];l.forEach(function(l,n){_xeUtils.default.has(t,l.property)&&e.push(new Promise(function(i,o){u.validCellRules("all",r,l).then(i).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:u.getRowIndex(r),row:r,columnIndex:n,column:l,$table:u};return c?(h[l.property]||(h[l.property]=[]),h[l.property].push(t),i()):o(t)})}))}),o.push(Promise.all(e))};return g?_xeUtils.default.eachTree(i,n,g):i.forEach(n),Promise.all(o).then(function(){var e=Object.keys(h);if(e.length)return Promise.reject(h[e[0]][0]);a&&a(d)}).catch(function(r){var s=c?h:_defineProperty({},r.column.property,r);return new Promise(function(e,t){var i=function(){r.cell=_tools.DomTools.getCell(u,r),u.handleValidError(r),a?e(a(d=!1,s)):t(s)},o=r.row,l=f.indexOf(o),n=0<l?f[l-1]:o;_tools.DomTools.toView(u.$el),g?u.scrollToTreeRow(n).then(i):u.scrollToRow(n).then(i)})})}return a&&a(d),Promise.resolve(!0)},hasCellRules:function(t,e,i){var o=this.editRules,l=i.property;if(l&&o){var n=_xeUtils.default.get(o,l);return n&&n.find(function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,i=c.property,h=[],o=[];if(i&&t){var d=_xeUtils.default.get(t,i),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,i):e;d&&d.forEach(function(r){o.push(new Promise(function(i){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)i();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};h.push(new Rule(t))}return i()},{rules:d,row:a,column:c,rowIndex:u.getRowIndex(a),columnIndex:u.getColumnMapIndex(c)});else{var t,o=f,l="number"===r.type,n=null==f||""===f;l?o=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(o),e&&n?h.push(new Rule(r)):(l&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(l?o<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(l?o>r.max:t>r.max))&&h.push(new Rule(r)),i()}}))})}return Promise.all(o).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,i=this.$refs,o=this.height,l=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,c=e.cell,u=i.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),u&&("tooltip"===n.message||"default"===n.message&&!o&&l.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},openExport:function(e){if(this.$toolbar)return this.$toolbar.openExport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},exportData:function(e){var t=this.visibleColumn,i=this.scrollXLoad,o=this.scrollYLoad,l=this.treeConfig,n=Object.assign({filename:"",sheetName:"",original:!!l,message:!1,isHeader:!0,isFooter:!0,download:!0,type:"csv",data:null,columns:null,columnFilterMethod:null,dataFilterMethod:null,footerFilterMethod:null},_conf.default.export,e);if(n.filename||(n.filename="export"),n.sheetName||(n.sheetName="Sheet1"),!_vXETable.default.exportTypes.includes(n.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[n.type]));n.original||(i||o)&&(n.original=!0,_tools.UtilTools.warn("vxe.error.scrollOriginal")),e&&e.columns||(n.columnFilterMethod=function(e){return e.property&&-1===["index","checkbox","selection","radio"].indexOf(e.type)});var r=t,s=this.tableFullData;return l&&(s=_xeUtils.default.toTreeArray(s,l)),_tools.ExportTools.handleExport(this,n,r,s)},openImport:function(e){if(this.$toolbar)return this.$toolbar.openImport(e);throw new Error(_tools.UtilTools.getLog("vxe.error.barUnableLink"))},importByFile:function(t,e){var i=this;if(window.FileReader){var o=_tools.UtilTools.parseFile(t),l=o.type,n=o.filename,r=Object.assign({mode:"covering"},e,{type:l,filename:n});(r.types||_vXETable.default.importTypes).includes(l)?this.preventEvent(null,"event.import",{$table:this,file:t,options:r,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(e){_tools.UtilTools.error("vxe.error.notType",[l])},e.onload=function(e){_tools.ExportTools.handleImport(i,e.target.result.trim(),r)},e.readAsText(t,"UTF-8")}):_tools.UtilTools.error("vxe.error.notType",[l])}else _tools.UtilTools.error("vxe.error.notExp")},importData:function(e){var i=this,t=Object.assign({},_conf.default.import,e),o=new Promise(function(e,t){i._importResolve=e,i._importReject=t});return this.readFile(t).then(function(e){return i.importByFile(e.target.files[0],t)}).catch(function(e){i._importReject(e),i._importReject=null}),o},readFile:function(){var i=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};impForm.parentNode||document.body.appendChild(impForm);var l=o.types||_vXETable.default.importTypes;return impInput.accept=".".concat(l.join(", .")),impInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;l.includes(t)?i._fileResolve(e):(!1!==o.message&&i.$XModal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),i._fileReject(e)),i._fileResolve=null},impForm.reset(),impInput.click(),new Promise(function(e,t){i._fileResolve=e,i._fileReject=t})},print:function(e){this.exportData(Object.assign({original:this.scrollXLoad||this.scrollYLoad},e,{type:"html",download:!1})).then(function(e){var t=e.content,i=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(i)})},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;