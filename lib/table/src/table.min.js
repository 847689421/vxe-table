"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var l=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};l.get||l.set?Object.defineProperty(t,i,l):t[i]=e[i]}return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var rowUniqueId=0,browse=_tools.DomTools.browse,debounceScrollYDuration=browse.msie?40:20;function getRowUniqueId(){return"row_".concat(++rowUniqueId)}var Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function renderFixed(e,t,i){var l=t.tableData,o=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.height,u=t.containerHeight,c=t.vSize,h=t.headerHeight,d=t.footerHeight,f=t.showHeader,g=t.showFooter,v=t.tableHeight,p=t.scrollbarWidth,m=t.scrollbarHeight,x=t.scrollRightToLeft,b=t.scrollLeftToRight,w=t.columnStore,C=t.footerData,S="right"===i,T=w["".concat(i,"List")],_="auto"===a?u:_tools.DomTools.isScale(a)?Math.floor(parseInt(a)/100*u):_xeUtils.default.toNumber(a),R={height:"".concat((0<_?_-h-d:v)+h+d-m*(g?2:1),"px"),width:"".concat(T.reduce(function(e,t){return e+t.renderWidth},S?p:0),"px")};return e("div",{class:["vxe-table--fixed-".concat(i,"-wrapper"),{"scrolling--middle":S?x:b}],style:R,ref:"".concat(i,"Container")},[f?e("vxe-table-header",{props:{fixedType:i,tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:c,fixedColumn:T,isGroup:s},ref:"".concat(i,"Header")}):null,e("vxe-table-body",{style:{top:"".concat(h,"px")},props:{fixedType:i,tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,fixedColumn:T,size:c,isGroup:s},ref:"".concat(i,"Body")}),g?e("vxe-table-footer",{style:{top:"".concat(_?_-d:v+h,"px")},props:{fixedType:i,footerData:C,tableColumn:o,visibleColumn:n,size:c,fixedColumn:T},ref:"".concat(i,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],spanMethod:Function,showAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderAllOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:[Boolean,String],rowId:String,autoResize:Boolean,syncResize:Boolean,sortConfig:Object,radioConfig:Object,selectConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},data:function(){return{id:_xeUtils.default.uniqueId(),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],containerHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,scrollLeftToRight:!1,scrollRightToLeft:!1,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,currentColumn:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],hoverRow:null,isLoading:!1,filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},scrollXStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,leftSpaceWidth:0,rightSpaceWidth:0},scrollYStore:{renderSize:0,visibleSize:0,offsetSize:0,rowHeight:0,startIndex:0,visibleIndex:0,topSpaceHeight:0,bottomSpaceHeight:0,ySpaceHeight:0},tooltipStore:{visible:!1,row:null,column:null,content:""},editStore:{checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t}},watch:{data:function(e){this.isUpdateData||this.loadData(e,!0).then(this.handleDefault),this.isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=t,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn(),this.handleData(!0),this.$toolbar&&this.$toolbar.updateColumn(t),t.length&&t.some(function(e){return e.columnKey})&&_tools.UtilTools.warn("vxe.error.delColumnKey"),t.length){var i=Math.floor((t.length-1)/2);t[i].prop&&_tools.UtilTools.warn("vxe.error.delProp"),t[i].label&&_tools.UtilTools.warn("vxe.error.delLabel")}},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this.isLoading||(this.isLoading=!0)},syncResize:function(e){e&&this.$nextTick(this.recalculate)}},created:function(){var e=this,t=this.scrollYStore,i=this.optimizeOpts,l=this.ctxMenuOpts,o=this.radioConfig,n=void 0===o?{}:o,r=this.selectConfig,s=void 0===r?{}:r,a=this.treeConfig,u=this.editConfig,c=this.loading,h=this.showAllOverflow,d=this.showHeaderAllOverflow,f=i.scrollY;c&&(this.isLoading=!0),f&&Object.assign(t,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(f.rSize),offsetSize:_xeUtils.default.toNumber(f.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.rowIdEmpty"),_xeUtils.default.isBoolean(h)&&_tools.UtilTools.warn("vxe.error.delShowAllOverflow"),_xeUtils.default.isBoolean(d)&&_tools.UtilTools.warn("vxe.error.delShowHeaderAllOverflow"),n.labelProp&&console.warn("[vxe-table] The property labelProp is deprecated, please use labelField"),s.checkProp&&console.warn("[vxe-table] The property checkProp is deprecated, please use checkField"),s.labelProp&&console.warn("[vxe-table] The property labelProp is deprecated, please use labelField"),["header","body","footer"].forEach(function(e){l[e]&&l[e].visibleMethod&&console.warn("[vxe-table] The property context-menu.".concat(e,".visibleMethod is deprecated, please use context-menu.visibleMethod"))}),this.lastScrollLeft=0,this.lastScrollTop=0,this.afterFullData=[],this.fullAllDataRowMap=new Map,this.fullAllDataRowIdData={},this.fullDataRowMap=new Map,this.fullDataRowIdData={},this.fullColumnMap=new Map,this.fullColumnIdData={},this.loadData(this.data,!0).then(function(){s.key?console.warn("[vxe-table] The property select-config.key is deprecated, please use row-id"):a&&a.key?console.warn("[vxe-table] The property tree-config.key is deprecated, please use row-id"):u&&u.key&&console.warn("[vxe-table] The property edit-config.key is deprecated, please use row-id"),e.handleDefault()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent)},mounted:function(){this.autoResize&&_tools.ResizeEvent.on(this,this.$el.parentNode,this.recalculate),document.body.appendChild(this.$refs.tableWrapper)},activated:function(){this.scrollTo(this.lastScrollLeft,this.lastScrollTop)},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.$el.parentNode),this.closeFilter(),this.closeMenu()},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize")},render:function(e){var t=this._e,i=this.id,l=this.tableData,o=this.tableColumn,n=this.visibleColumn,r=this.collectColumn,s=this.isGroup,a=this.hasFilter,u=this.isResizable,c=this.isCtxMenu,h=this.loading,d=this.isLoading,f=this.showHeader,g=this.border,v=this.stripe,p=this.height,m=this.highlightHoverRow,x=this.highlightHoverColumn,b=this.vSize,w=this.editConfig,C=this.validOpts,S=this.editRules,T=this.showFooter,_=this.footerMethod,R=this.overflowX,y=this.overflowY,D=this.scrollbarHeight,E=this.optimizeOpts,U=this.vaildTipOpts,k=this.tooltipConfig,I=this.columnStore,M=this.filterStore,$=this.ctxMenuStore,O=this.footerData,F=this.hasTip,L=I.leftList,z=I.rightList;return e("div",{class:["vxe-table",b?"size--".concat(b):"",{"vxe-editable":w,"show--head":f,"show--foot":T,"scroll--y":y,"scroll--x":R,"fixed--left":L.length,"fixed--right":z.length,"t--animat":E.animat,"t--stripe":v,"t--border":g,"row--highlight":m,"column--highlight":x}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),f?e("vxe-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:b,isGroup:s}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:o,visibleColumn:n,collectColumn:r,size:b,isGroup:s}}),T?e("vxe-table-footer",{props:{footerData:O,footerMethod:_,tableColumn:o,visibleColumn:n,size:b},ref:"tableFooter"}):t(),L&&L.length&&R?renderFixed(e,this,"left"):t(),z&&z.length&&R?renderFixed(e,this,"right"):t(),u?e("div",{class:"vxe-table--resizable-bar",style:R?{"padding-bottom":"".concat(D,"px")}:null,ref:"resizeBar"}):t(),d?e("vxe-table-loading",{props:{visible:h}}):t(),e("div",{class:"vxe-table".concat(i,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[a?e("vxe-table-filter",{props:{optimizeOpts:E,filterStore:M},ref:"filterWrapper"}):t(),c?e("vxe-table-context-menu",{props:{ctxMenuStore:$},ref:"ctxWrapper"}):t(),F?e("vxe-tooltip",{ref:"tooltip",props:k}):t(),F&&S&&("default"===C.message?!p:"tooltip"===C.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===C.message||1===l.length?U:null,ref:"validTip"}):t()])])},methods:{clearAll:function(){return this.clearScroll(),this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearRowExpand(),this.clearTreeExpand(),this.clearChecked(),this.clearSelected(),this.clearActived()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadData(e.tableFullData)})})},updateData:function(){return this.handleData(!0).then(this.updateFooter).then(this.recalculate)},handleData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,l=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?l.slice(i.startIndex,i.startIndex+i.renderSize):l.slice(0),this.$nextTick()},loadData:function(e,t){var i=this,l=this.height,o=this.maxHeight,n=this.editStore,r=this.optimizeOpts,s=this.lastScrollLeft,a=this.lastScrollTop,u=r.scrollY,c=e?e.slice(0):[],h=u&&u.gt&&u.gt<c.length;n.insertList=[],n.removeList=[],this.tableFullData=c,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(c,!0),!(this.scrollYLoad=h)||l||o||_tools.UtilTools.error("vxe.error.scrollYHeight"),this.clearScroll(),this.handleData(!0),this.reserveCheckSelection(),this.checkSelectionStatus();var d=this.$nextTick();return t||(d=d.then(this.recalculate)),d.then(function(){if((i.scrollXLoad||i.scrollYLoad)&&i.mouseConfig&&_tools.UtilTools.error("vxe.error.notMouse"),s||a)return i.scrollTo(s,a)})},reloadData:function(e){return this.clearAll(),this.loadData(e).then(this.handleDefault)},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(o){var n=this,e=this.treeConfig,t=this.tableFullData,r=this.fullDataRowIdData,s=this.fullDataRowMap,a=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,c=_tools.UtilTools.getRowkey(this),i=function(e,t){var i=_tools.UtilTools.getRowid(n,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,c,i));var l={row:e,rowid:i,index:t};o&&(r[i]=l,s.set(e,l)),u[i]=l,a.set(e,l)};o&&(r=this.fullDataRowIdData={},s.clear()),u=this.fullAllDataRowIdData={},a.clear(),e?_xeUtils.default.eachTree(t,i,e):t.forEach(i)},cacheColumnMap:function(){var e=this.tableFullColumn,l=this.fullColumnMap,o=this.fullColumnIdData={};l.clear(),e.forEach(function(e,t){var i={column:e,index:t};o[e.id]=i,l.set(e,i)})},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,l=this.tableFullData,o=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(i){var r=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===n},i);if(r)return r}else if(o[n]){var s=o[n];return{item:s.row,index:s.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.isGroup,i=this.fullColumnIdData,l=this.tableFullColumn,o=e.getAttribute("data-colid");if(!t){var n=i[o].column;return{item:n,index:this.getColumnMapIndex(n),items:l}}var r=_xeUtils.default.findTree(l,function(e){return e.id===o},headerProps);if(r)return r}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getColumnMapIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getColumnIndex:function(e){return this.getColumnMapIndex(e)},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var i=this,l=this.afterFullData,o=this.editStore,n=this.scrollYLoad,r=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.error("vxe.error.treeInsert"));_xeUtils.default.isArray(e)||(e=[e]);var s=l,a=e.map(function(e){return i.defineField(Object.assign({},e))});if(t)if(-1===t)s.push.apply(s,a),r.push.apply(r,a);else{var u=s.indexOf(t);if(-1===u)throw new Error(_tools.UtilTools.error("vxe.error.unableInsert"));s.splice.apply(s,[u,0].concat(a)),r.splice.apply(r,[r.indexOf(t),0].concat(a))}else s.unshift.apply(s,a),r.unshift.apply(r,a);return[].unshift.apply(o.insertList,a),this.handleData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return i.recalculate(),{row:a.length?a[a.length-1]:null,rows:a}})},defineField:function(l){var e=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,i=e.editRender;t&&!_xeUtils.default.has(l,t)&&_xeUtils.default.set(l,t,i&&!_xeUtils.default.isUndefined(i.defaultValue)?i.defaultValue:null)}),_xeUtils.default.get(l,e)||_xeUtils.default.set(l,e,getRowUniqueId()),l},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var i=this,l=_xeUtils.default.isArray(t);return l||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return i.defineField(Object.assign({},e))});return l?e:e[0]})},remove:function(r){var e=this,t=this.afterFullData,s=this.tableFullData,i=this.editStore,a=this.treeConfig,l=this.selectConfig,o=void 0===l?{}:l,u=this.selection,c=this.hasRowInsert,n=this.scrollYLoad,h=i.removeList,d=i.insertList,f=o.checkField||o.checkProp,g=[],v=t;return r?_xeUtils.default.isArray(r)||(r=[r]):r=s,a?r.forEach(function(t){var e=_xeUtils.default.findTree(s,function(e){return e===t},a);if(e){var i=e.item,l=e.items,o=e.index;c(i)||h.push(i);var n=l.splice(o,1)[0];f||_xeUtils.default.remove(u,function(e){return-1<r.indexOf(e)}),g.push(n)}}):(r.forEach(function(e){c(e)||h.push(e)}),f||_xeUtils.default.remove(u,function(e){return-1<r.indexOf(e)}),s===r?(r=s.slice(0),s.length=0,v.length=0):(g=_xeUtils.default.remove(s,function(e){return-1<r.indexOf(e)}),_xeUtils.default.remove(v,function(e){return-1<r.indexOf(e)}))),_xeUtils.default.remove(d,function(e){return-1<r.indexOf(e)}),this.handleData(),this.updateCache(),this.checkSelectionStatus(),n&&this.updateScrollYSpace(),this.$nextTick().then(function(){return e.recalculate(),{row:r&&r.length?r[r.length-1]:null,rows:g}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(){return _tools.UtilTools.warn("vxe.error.delRevert"),this.revertData.apply(this,arguments)},revertData:function(e,l){var o=this.tableSourceData,n=this.tableFullData;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n.indexOf(e),i=o[t];i&&e&&(l?_xeUtils.default.set(e,l,_xeUtils.default.get(i,l)):_xeUtils.default.destructuring(e,i))}),this.$nextTick()):this.reloadData(o)},clearData:function(e,t){var i=this.tableSourceData,l=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){l.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasRowInsert:function(t){var e=this.treeConfig,i=this.tableSourceData;return e?_xeUtils.default.findTree(i,function(e){return e===t},e):-1===this.getRowIndex(t)},hasRowChange:function(e,t){var i,l,o=this,n=this.visibleColumn,r=this.treeConfig,s=this.tableSourceData,a=this.fullDataRowIdData,u=_tools.UtilTools.getRowid(this,e);if(!a[u])return!1;if(r){var c=r.children,h=_xeUtils.default.findTree(s,function(e){return u===_tools.UtilTools.getRowid(o,e)},r);e=Object.assign({},e,_defineProperty({},c,null)),h&&(i=Object.assign({},h.item,_defineProperty({},c,null)))}else{i=s[a[u].index]}if(i){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t));for(var d=0,f=n.length;d<f;d++)if((l=n[d].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,l),_xeUtils.default.get(e,l)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return this.visibleColumn.find(function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delGetRecords"),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delGetAllRecords"),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.editStore,i=this.treeConfig,l=this.selectConfig,o=void 0===l?{}:l,n=this.selection,r=o.checkField||o.checkProp,s=[],a=[];return a=r?(s=i?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,r)},i):e.filter(function(e){return _xeUtils.default.get(e,r)}),t.insertList.filter(function(e){return _xeUtils.default.get(e,r)})):(s=i?_xeUtils.default.filterTree(e,function(e){return-1<n.indexOf(e)},i):e.filter(function(e){return-1<n.indexOf(e)}),t.insertList.filter(function(e){return-1<n.indexOf(e)})),s.concat(a)},getUpdateRecords:function(){var e=this.tableFullData,t=this.hasRowChange,i=this.treeConfig;return i?_xeUtils.default.filterTree(e,function(e){return t(e)},i):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,i=this.remoteSort,u=this.remoteFilter,l=t,o=this.visibleColumn.find(function(e){return e.order}),n=e.filter(function(e){var t=e.filters;return t&&t.length});if((l=l.filter(function(a){return n.every(function(t){var e=t.property,i=t.filters,l=t.filterMethod,o=t.filterRender,n=o?_vXETable.Renderer.get(o.name):null,r=[],s=[];return!(i&&i.length&&(i.forEach(function(e){e.checked&&(s.push(e),r.push(e.value))}),r.length&&!u))||(!l&&n&&n.renderFilter&&(l=n.filterMethod),l?s.some(function(e){return l({value:e.value,option:e,row:a,column:t})}):-1<r.indexOf(_xeUtils.default.get(a,e)))})}),o&&o.order)&&!(_xeUtils.default.isBoolean(o.remoteSort)?o.remoteSort:i))if(this.sortMethod)l=this.sortMethod({data:l,column:o,property:o.property,order:o.order,$table:this})||l;else{var r=o.sortMethod?l.sort(o.sortMethod):_xeUtils.default.sortBy(l,o.property);l="desc"===o.order?r.reverse():r}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,l=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:l.slice(0)}},handleDefault:function(){this.selectConfig&&this.handleSelectionDefChecked(),this.radioConfig&&this.handleRadioDefChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(i){this.isUpdateCustoms=!0,this.tableFullColumn.forEach(function(t){var e=i.find(function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",this.tableFullColumn)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.updateSetting(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,e=this,l=0,o=[],n=null,r=null,s=[],a=[],t=this.collectColumn,u=this.tableFullColumn,c=this.isGroup,h=this.columnStore,d=this.scrollXStore,f=this.optimizeOpts.scrollX;c&&_xeUtils.default.eachTree(t,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),u.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=l),i||(t-l!=0?i=!0:l++),o.push(e)):"right"===e.fixed?(i||(null===r&&(r=t),t-r!=0?i=!0:r++),a.push(e)):s.push(e)});var g=o.concat(s).concat(a),v=f&&f.gt&&f.gt<u.length;return Object.assign(h,{leftList:o,centerList:s,rightList:a}),c&&(i||n||null!==r&&r!==g.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),v&&((this.resizable||g.some(function(e){return e.resizable}))&&_tools.UtilTools.warn("vxe.error.notResizable"),Object.assign(d,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(f.rSize),offsetSize:_xeUtils.default.toNumber(f.oSize)}),g=g.slice(d.startIndex,d.startIndex+d.renderSize)),this.scrollXLoad=v,this.tableColumn=g,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,l=[],o=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?l.push(e):_tools.DomTools.isPx(e.width||t)?o.push(e):_tools.DomTools.isScale(e.width||t)?r.push(e):_tools.DomTools.isPx(e.minWidth||i)?n.push(e):_tools.DomTools.isScale(e.minWidth||i)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:l,pxList:o,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},recalculate:function(e){var t=this,i=this.$refs,l=i.tableBody,o=i.tableHeader,n=i.tableFooter,r=l?l.$el:null,s=o?o.$el:null,a=n?n.$el:null;if(r){var u=r.clientWidth;if(this.autoCellWidth(s,r,a,u),!0===e)return this.computeScrollLoad().then(function(){u=r.clientWidth,t.autoCellWidth(s,r,a,u),t.computeScrollLoad()})}return this.computeScrollLoad()},autoCellWidth:function(e,t,i,o){var n,r=0,l=o,s=this.$el,a=this.fit,u=this.columnStore,c=u.resizeList,h=u.pxMinList,d=u.pxList,f=u.scaleList,g=u.scaleMinList,v=u.autoList;h.forEach(function(e){var t=parseInt(e.minWidth);r+=t,e.renderWidth=t}),n=l/100,g.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);r+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);r+=t,e.renderWidth=t}),d.forEach(function(e){var t=parseInt(e.width);r+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);r+=t,e.renderWidth=t}),n=0<(l-=r)?Math.floor(l/(g.length+h.length+v.length)):0,a?0<l&&g.concat(h).forEach(function(e){r+=n,e.renderWidth+=n}):n=40,v.forEach(function(e,t){var i=Math.max(n,40);if(e.renderWidth=i,r+=i,a&&t===v.length-1){var l=o-r;0<l&&(e.renderWidth+=l,r=o)}});var p=t.offsetHeight,m=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=m?t.offsetWidth-o:0,this.overflowY=m,this.tableWidth=r,this.tableHeight=p,this.containerHeight=s.parentNode.clientHeight,e&&(this.headerHeight=e.offsetHeight),i){var x=i.offsetHeight;this.scrollbarHeight=Math.max(x-i.clientHeight,0),this.overflowX=r>i.clientWidth,this.footerHeight=x}else this.scrollbarHeight=Math.max(p-t.clientHeight,0),this.overflowX=o<r;return this.overflowX&&this.checkScrolling(),r},resetResizable:function(){return this.visibleColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftBody,l=e.rightBody,o=t?t.$el:null;o&&(i&&(this.scrollLeftToRight=0<o.scrollLeft),l&&(this.scrollRightToLeft=o.clientWidth<o.scrollWidth-o.scrollLeft))},preventEvent:function(t,e,i,l,o){var n=this;!_vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,n)})&&l&&l(),o&&o()},handleGlobalMousedownEvent:function(o){var n=this,e=this.$refs,t=this.editStore,i=this.ctxMenuStore,l=this.editConfig,r=void 0===l?{}:l,s=this.filterStore,a=t.actived,u=e.filterWrapper,c=e.validTip;u&&(this.getEventTargetNode(o,this.$el,"vxe-filter-wrapper").flag||this.getEventTargetNode(o,u.$el).flag||this.preventEvent(o,"event.clear_filter",s.args,this.closeFilter)),a.row&&!1!==r.autoClear&&(c&&this.getEventTargetNode(o,c.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(o,"event.clear_actived",a.args,function(){var e,t=!n.getEventTargetNode(o,n.$el,"col--edit").flag;if("row"===r.mode){var i=n.getEventTargetNode(o,n.$el,"vxe-body--row"),l=i.flag?i.targetElem!==a.args.cell.parentNode:0;e="manual"===r.trigger?l:l&&t}else e=t;!e&&n.getEventTargetNode(o,n.$el).flag||setTimeout(function(){return n.clearActived(o)})})),i.visible&&this.$refs.ctxWrapper&&!this.getEventTargetNode(o,this.$refs.ctxWrapper.$el).flag&&this.closeMenu()},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(e){var t,i=this,l=this.isCtxMenu,o=this.ctxMenuStore,n=this.editStore,r=this.mouseConfig,s=void 0===r?{}:r,a=this.keyboardConfig,u=void 0===a?{}:a,c=this.treeConfig,h=this.highlightCurrentRow,d=this.currentRow,f=n.selected,g=n.actived,v=e.keyCode,p=8===v,m=9===v,x=13===v,b=27===v,w=32===v,C=37===v,S=38===v,T=39===v,_=40===v,R=46===v,y=67===v,D=86===v,E=88===v,U=113===v,k=e.ctrlKey,I=C||S||T||_,M=l&&o.visible&&(x||w||I);if(b)this.closeMenu(),this.closeFilter(),g.row&&(t=g.args,this.clearActived(e),s.selected&&this.handleSelected(t,e));else if(w&&(u.isArrow||u.isTab)&&f.row&&f.column&&("selection"===f.column.type||"radio"===f.column.type))e.preventDefault(),"selection"===f.column.type?this.handleToggleCheckRowEvent(f.args,e):this.triggerRadioRowEvent(e,f.args);else if(x&&(u.isArrow||u.isTab)&&(f.row||g.row||c&&h&&d)){if(f.row||g.row)this.moveSelected(f.row?f.args:g.args,C,S,T,!0,e);else if(c&&h&&d){var $=d[c.children];if($&&$.length){e.preventDefault();var O=$[0];t={$table:this,row:O},this.setTreeExpansion(d,!0).then(function(){return i.scrollToRow(O)}).then(function(){return i.triggerCurrentRowEvent(e,t)})}}}else if(M)e.preventDefault(),o.showChild&&_tools.UtilTools.hasChildrenList(o.selected)?this.moveCtxMenu(e,v,o,"selectChild",37,!1,o.selected.children):this.moveCtxMenu(e,v,o,"selected",39,!0,this.ctxMenuList);else if(U)f.row&&f.column&&(e.preventDefault(),this.handleActived(f.args,e));else if(I&&u.isArrow)f.row&&f.column?this.moveSelected(f.args,C,S,T,_,e):(S||_)&&h&&d&&this.moveCurrentRow(S,_,e);else if(m&&u.isTab)f.row||f.column?this.moveTabSelected(f.args,e):(g.row||g.column)&&this.moveTabSelected(g.args,e);else if(R||(c&&h&&d?p&&u.isArrow:p)){if(u.isDel&&(f.row||f.column))_tools.UtilTools.setCellValue(f.row,f.column,null),p&&this.handleActived(f.args,e);else if(p&&u.isArrow&&c&&h&&d){var F=_xeUtils.default.findTree(this.afterFullData,function(e){return e===d},c).parent;F&&(e.preventDefault(),t={$table:this,row:F},this.setTreeExpansion(F,!1).then(function(){return i.scrollToRow(F)}).then(function(){return i.triggerCurrentRowEvent(e,t)}))}}else u.isCut&&k&&(E||y||D)?E||y?this.handleCopyed(E,e):this.handlePaste(e):u.isEdit&&!k&&(48<=v&&v<=57||65<=v&&v<=90||96<=v&&v<=111||186<=v&&v<=192||219<=v&&v<=222||32===v)&&(f.row||f.column)&&(u.editMethod&&!1===u.editMethod(f.args,e)||(_tools.UtilTools.setCellValue(f.row,f.column,null),this.handleActived(f.args,e)))},moveTabSelected:function(e,t){var i,l,o,n,r=this.tableData,s=this.visibleColumn,a=this.editConfig,u=t.shiftKey,c=Object.assign({},e),h=r.indexOf(c.row),d=s.indexOf(c.column);if(t.preventDefault(),u){for(var f=d-1;0<=f;f--){var g=s[f];if(g&&"index"!==g.type){n=f,o=g;break}}if(!o&&0<h){i=r[l=h-1];for(var v=s.length-1;0<=v;v--){var p=s[v];if(p&&"index"!==p.type){n=v,o=p;break}}}}else{for(var m=d+1;m<s.length;m++){var x=s[m];if(x&&"index"!==x.type){n=m,o=x;break}}if(!o&&h<r.length-1){i=r[l=h+1];for(var b=0;b<s.length;b++){var w=s[b];if(w&&"index"!==w.type){n=b,o=w;break}}}}o&&(i?(c.rowIndex=l,c.row=i):c.rowIndex=h,c.columnIndex=n,c.column=o,c.cell=_tools.DomTools.getCell(this,c),a&&("click"!==a.trigger&&"dblclick"!==a.trigger||("row"===a.mode?this.handleActived(c,t):(this.handleSelected(c,t),this.scrollToRow(c.row,c.column)))))},moveCurrentRow:function(e,t,i){var l,o=this,n=this.currentRow,r=this.treeConfig,s=this.afterFullData;if(i.preventDefault(),r){var a=_xeUtils.default.findTree(s,function(e){return e===n},r),u=a.index,c=a.items;e&&0<u?l=c[u-1]:t&&u<c.length-1&&(l=c[u+1])}else{var h=s.indexOf(n);e&&0<h?l=s[h-1]:t&&h<s.length-1&&(l=s[h+1])}if(l){var d={$table:this,row:l};this.scrollToRow(l).then(function(){return o.triggerCurrentRowEvent(i,d)})}},moveSelected:function(e,t,i,l,o,n){var r=this.tableData,s=this.visibleColumn,a=Object.assign({},e);if(n.preventDefault(),i&&a.rowIndex)a.rowIndex-=1,a.row=r[a.rowIndex];else if(o&&a.rowIndex<r.length-1)a.rowIndex+=1,a.row=r[a.rowIndex];else if(t&&a.columnIndex){for(var u=a.columnIndex-1;0<=u;u--)if(s[u].editRender){a.columnIndex=u,a.column=s[u];break}}else if(l&&a.columnIndex)for(var c=a.columnIndex+1;c<s.length;c++)if(s[c].editRender){a.columnIndex=c,a.column=s[c];break}a.cell=_tools.DomTools.getCell(this,a),this.handleSelected(a,n),this.scrollToRow(a.row,a.column)},moveCtxMenu:function(e,t,i,l,o,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return i[l]===e});if(t===o)n&&_tools.UtilTools.hasChildrenList(i.selected)?i.showChild=!0:(i.showChild=!1,i.selectChild=null);else if(38===t){for(var u=a-1;0<=u;u--)if(!1!==r[u].visible){s=r[u];break}i[l]=s||r[r.length-1]}else if(40===t){for(var c=a+1;c<r.length;c++)if(!1!==r[c].visible){s=r[c];break}i[l]=s||r[0]}else!i[l]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,i[l])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,i=this.ctxMenuStore,l=this.ctxMenuOpts,o=["header","body","footer"];if(t){if(i.visible&&i.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var n=0;n<o.length;n++){var r=o[n],s=this.getEventTargetNode(e,this.$el,"vxe-".concat(r,"--column")),a={type:r,$table:this,columns:this.visibleColumn.slice(0)};if(s.flag){var u=s.targetElem,c=this.getColumnNode(u).item,h="".concat(r,"-");if(Object.assign(a,{column:c,columnIndex:this.getColumnIndex(c),cell:u}),"body"===r){var d=this.getRowNode(u.parentNode).item;h="",a.row=d,a.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,r,a),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[a,e])}if(this.getEventTargetNode(e,this.$el,"vxe-table--".concat(r,"-wrapper")).flag)return void("cell"===l.trigger?e.preventDefault():this.openContextMenu(e,r,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(u,e,l){var c=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,i=t[e];if(i){var o=i.options,n=i.disabled,d=i.visibleMethod||t.visibleMethod;n?u.preventDefault():o&&o.length&&(l.options=o,this.preventEvent(u,"event.show_menu",l,null,function(){if(!d||d(l,u)){u.preventDefault();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,i=e.scrollLeft,n=e.visibleHeight,r=e.visibleWidth,s=u.clientY+t,a=u.clientX+i;Object.assign(h,{args:l,visible:!0,list:o,selected:null,selectChild:null,showChild:!1,style:{top:"".concat(s,"px"),left:"".concat(a,"px")}}),c.$nextTick(function(){var e=c.$refs.ctxWrapper.$el,t=e.clientHeight,i=e.clientWidth,l=u.clientY+t-n,o=u.clientX+i-r;-10<l&&(h.style.top="".concat(s-t,"px")),-10<o&&(h.style.left="".concat(a-i,"px"))})}else c.closeMenu()}))}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,i){var l=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),l.selected=t,(l.selectChild=i)||(l.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,i){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var i=_vXETable.Menus.get(t.code),l=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);i&&i.call(this,l,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu()}},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,l=t.column;i.column===l&&i.visible||this.handleTooltip(e,l)},triggerFooterTooltipEvent:function(e,t){var i=t.column,l=this.tooltipStore;l.column===i&&l.visible||this.handleTooltip(e,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,l=this.editStore,o=this.tooltipStore,n=l.actived,r=t.row,s=t.column;i&&("row"===i.mode&&n.row===r||n.row===r&&n.column===s)||o.column===s&&o.row===r&&o.visible||this.handleTooltip(e,s,r)},handleTooltip:function(e,t,i){var l=e.currentTarget,o=this.$refs.tooltip,n=l.children[0],r=l.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:i,column:t,visible:!0}),o&&o.toVisible(l,r)),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleSelectionDefChecked:function(){var e=this.selectConfig,t=void 0===e?{}:e,i=this.fullDataRowIdData,l=t.checkAll,o=t.checkRowKeys;if(l)this.setAllSelection(!0);else if(o){var n=[];o.forEach(function(e){i[e]&&n.push(i[e].row)}),this.setSelection(n,!0)}},setSelection:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow(null,{row:e},!!t)}),this.$nextTick()},handleSelectRow:function(e,t,i){var l=t.row,o=this.selection,n=this.tableFullData,r=this.selectConfig,s=void 0===r?{}:r,a=this.treeConfig,u=this.treeIndeterminates,c=s.checkStrictly,h=s.checkMethod,d=s.checkField||s.checkProp;if(d)if(a&&!c){-1===i?(u.push(l),_xeUtils.default.set(l,d,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&h&&!h({row:e,$rowIndex:t})||_xeUtils.default.set(e,d,i)},a),_xeUtils.default.remove(u,function(e){return e===l}));var f=_xeUtils.default.findTree(n,function(e){return e===l},a);if(f&&f.parent){var g,v=h?f.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):f.items;if(f.items.find(function(e){return-1<u.indexOf(e)}))g=-1;else{var p=f.items.filter(function(e){return _xeUtils.default.get(e,d)});g=p.filter(function(e){return-1<v.indexOf(e)}).length===v.length||!(!p.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:f.parent},g)}}else _xeUtils.default.set(l,d,i);else if(a&&!c){-1===i?(u.push(l),_xeUtils.default.remove(o,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&h&&!h({row:t,$rowIndex:e})||(i?o.push(t):_xeUtils.default.remove(o,function(e){return e===t}))},a),_xeUtils.default.remove(u,function(e){return e===l}));var m=_xeUtils.default.findTree(n,function(e){return e===l},a);if(m&&m.parent){var x,b=h?m.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):m.items;if(m.items.find(function(e){return-1<u.indexOf(e)}))x=-1;else{var w=m.items.filter(function(e){return-1<o.indexOf(e)});x=w.filter(function(e){return-1<b.indexOf(e)}).length===b.length||!(!w.length&&-1!==i)&&-1}return this.handleSelectRow(e,{row:m.parent},x)}}else i?-1===o.indexOf(l)&&o.push(l):_xeUtils.default.remove(o,function(e){return e===l});this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selectConfig,l=void 0===i?{}:i,o=this.selection,n=l.checkField,r=e.row,s=n?!_xeUtils.default.get(r,n):-1===o.indexOf(r);t?this.triggerCheckRowEvent(t,e,s):this.handleSelectRow(null,e,s)},triggerCheckRowEvent:function(e,t,i){this.handleSelectRow(e,t,i),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),checked:i,$table:this},t),e])},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(i){var e=this.tableFullData,t=this.editStore,l=this.selectConfig,o=void 0===l?{}:l,n=this.treeConfig,r=this.selection,s=o.reserve,a=o.checkStrictly,u=o.checkMethod,c=t.insertList,h=o.checkField||o.checkProp,d=[];if(c.length&&(e=e.concat(c)),!a){if(h){var f="".concat(n?"$":"","rowIndex"),g=function(e,t){u&&!u(_defineProperty({row:e},f,t))||_xeUtils.default.set(e,h,i)},v=function(e,t){(!u||!u(_defineProperty({row:e},f,t))&&-1<r.indexOf(e))&&_xeUtils.default.set(e,h,i)};n?_xeUtils.default.eachTree(e,i?g:v,n):e.forEach(i?g:v)}else n?i?_xeUtils.default.eachTree(e,function(e,t){u&&!u({row:e,$rowIndex:t})||d.push(e)},n):u&&_xeUtils.default.eachTree(e,function(e,t){!u({row:e,$rowIndex:t})&&-1<r.indexOf(e)&&d.push(e)},n):i?d=u?e.filter(function(e,t){return-1<r.indexOf(e)||u({row:e,rowIndex:t})}):e.slice(0):u&&(d=e.filter(function(e,t){return u({row:e,rowIndex:t})?0:-1<r.indexOf(e)}));this.selection=i&&s?r.concat(d.filter(function(e){return-1===r.indexOf(e)})):d}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,i=this.selectConfig,l=void 0===i?{}:i,o=this.selection,n=this.treeIndeterminates,r=l.checkStrictly,s=l.checkMethod,a=l.checkField||l.checkProp,u=t.insertList;u.length&&(e=e.concat(u)),r||(a?(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t})||_xeUtils.default.get(e,a)}:function(e){return _xeUtils.default.get(e,a)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,a)||-1<n.indexOf(e)})):(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t})||-1<o.indexOf(e)}:function(e){return-1<o.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<n.indexOf(e)||-1<o.indexOf(e)})))},reserveCheckSelection:function(){var e=this.selectConfig,t=void 0===e?{}:e,i=this.selection,l=this.fullDataRowIdData,o=t.reserve,n=_tools.UtilTools.getRowkey(this);o&&i.length&&(this.selection=i.map(function(e){var t=""+_xeUtils.default.get(e,n);return l[t]?l[t].row:e}))},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.selectConfig,i=void 0===t?{}:t,l=this.treeConfig,o=i.checkField||i.checkProp;return o&&(l?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,o,!1)},l):e.forEach(function(e){return _xeUtils.default.set(e,o,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleRadioDefChecked:function(){var e=this.radioConfig,t=void 0===e?{}:e,i=this.fullDataRowIdData,l=t.checkRowKey;l&&this.setRadioRow(i[l].row)},triggerRadioRowEvent:function(e,t){var i=this.selectRow!==t.row;this.setRadioRow(t.row),i&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.highlightCurrentRow&&(this.clearCurrentColumn(),this.currentRow=e),this.$nextTick()},setRadioRow:function(e){return this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.hoverRow=i},clearHoverRow:function(){this.hoverRow=null},triggerCellMousedownEvent:function(e,t){var o=this.$el,i=this.tableData,l=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleSelected,a=this.handleChecked,u=n.checked,c=n.actived,h=t.row,d=t.column,f=t.cell,g=e.button,v=0===g;if((v||2===g)&&r&&"dblclick"===r.trigger)if("row"===r.mode&&c.row===h||c.row===h&&c.column===d);else if(v){e.preventDefault(),e.stopPropagation(),this.handleSelected(t,e);var p=document.onmousemove,m=document.onmouseup,x=_tools.DomTools.getCellIndexs(f),b=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,o,"vxe-body--column"),i=t.flag,l=t.targetElem;i&&a(x,_tools.DomTools.getCellIndexs(l),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=b,document.onmouseup=function(e){document.onmousemove=p,document.onmouseup=m},this.closeFilter(),this.closeMenu()}else{var w=_tools.DomTools.getCellIndexs(f);-1!==u.rows.indexOf(i[w.rowIndex])&&-1!==u.columns.indexOf(l[w.columnIndex])||s(t,e)}},triggerCornerMousedownEvent:function(e,t){t.preventDefault(),t.stopPropagation();var o=this.$el,i=this.tableData,l=this.visibleColumn,n=this.editStore,r=this.editConfig,s=this.handleTempChecked,a=n.checked,u=t.button;if((0===u||2===u)&&r&&a.rows.length&&"dblclick"===r.trigger){var c=document.onmousemove,h=document.onmouseup,d={rowIndex:i.indexOf(a.rows[0]),columnIndex:l.indexOf(a.columns[0])},f=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,o,"vxe-body--column"),i=t.flag,l=t.targetElem;i&&s(d,_tools.DomTools.getCellIndexs(l),e)},browse.msie?80:40,{leading:!0,trailing:!0});document.onmousemove=f,document.onmouseup=function(e){document.onmousemove=c,document.onmouseup=h,a.rows=a.tRows,a.columns=a.tColumns}}},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,l=this.sortOpts,o=t.column,n=t.cell,r=i&&i>Date.now()-300,s=this.getEventTargetNode(e,n,"vxe-sort-wrapper").flag,a=this.getEventTargetNode(e,n,"vxe-filter-wrapper").flag;return"cell"!==l.trigger||r||s||a||this.sort(o.property),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.setCurrentColumn(o,!0)},setCurrentColumn:function(e){return this.highlightCurrentColumn&&(this.clearCurrentRow(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){this.currentColumn=null},triggerCellClickEvent:function(e,t){var i=this,l=this.$el,o=this.highlightCurrentRow,n=this.editStore,r=this.radioConfig,s=void 0===r?{}:r,a=this.selectConfig,u=void 0===a?{}:a,c=this.expandConfig,h=void 0===c?{}:c,d=this.treeConfig,f=void 0===d?{}:d,g=this.editConfig,v=n.actived,p=t.column;"row"!==h.trigger&&("expand"!==p.type||"cell"!==h.trigger)||this.getEventTargetNode(e,l,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===f.trigger||p.treeNode&&"cell"===f.trigger)&&this.triggerTreeExpandEvent(e,t),p.treeNode&&this.getEventTargetNode(e,l,"vxe-tree-wrapper").flag||"expand"===p.type&&this.getEventTargetNode(e,l,"vxe-table--expanded").flag||(o&&("row"!==s.trigger&&(this.getEventTargetNode(e,l,"vxe-checkbox").flag||this.getEventTargetNode(e,l,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==s.trigger&&("radio"!==p.type||"cell"!==s.trigger)||this.getEventTargetNode(e,l,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==u.trigger&&("selection"!==p.type||"cell"!==u.trigger)||this.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),g&&("click"===g.trigger?v.args&&e.currentTarget===v.args.cell||("row"===g.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===g.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})):"dblclick"===g.trigger&&("row"===g.mode&&v.row===t.row?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e)))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e])},triggerCellDBLClickEvent:function(e,t){var i=this,l=this.editStore,o=this.editConfig,n=l.actived;o&&"dblclick"===o.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===o.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e})}):"cell"===o.mode&&this.handleActived(t,e).then(function(){return i.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var i=this,l=this.editStore,o=this.editConfig,n=o.activeMethod,r=l.actived,s=e.row,a=e.column,u=e.cell;if(a.editRender&&u)if("row"===o.mode?r.row!==s:r.row!==s||r.column!==a){var c="edit-disabled";n&&!n(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(t),this.clearSelected(t),this.clearActived(t),c="edit-actived",a.renderHeight=u.offsetHeight,r.args=e,r.row=s,r.column=a,this.$nextTick(function(){i.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,c,[e,t])}else a.renderHeight=u.offsetHeight,r.args=e,r.column!==a&&this.clearValidate(),setTimeout(function(){i.handleFocus(e,t)});return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,i=t.args,l=t.row,o=t.column;return(l||o)&&(this.updateFooter(),_tools.UtilTools.emitEvent(this,"edit-closed",[i,e])),t.args=null,t.row=null,t.column=null,this.clearValidate()},getActiveRow:function(){var e=this.$el,t=this.editStore,i=this.tableData,l=t.actived,o=l.args,n=l.row;return o&&-1<i.indexOf(n)&&e.querySelectorAll(".vxe-body--column.col--actived").length?Object.assign({},o):null},hasActiveRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore.selected;return t.row=null,t.column=null,this.$nextTick()},handleSelected:function(t,i){var l=this,e=this.mouseConfig,o=void 0===e?{}:e,n=this.editConfig,r=this.editStore,s=r.actived,a=r.selected,u=t.row,c=t.column;return function(){if((a.row!==u||a.column!==c)&&(s.row!==u||"cell"===n.mode&&s.column!==c)&&(l.clearChecked(i),l.clearActived(i),a.args=t,a.row=u,a.column=c,o.checked)){var e=_tools.DomTools.getCellIndexs(t.cell);l.handleChecked(e,e,i)}return l.$nextTick()}()},clearChecked:function(e){var t=this.editStore.checked;return t.rows=[],t.columns=[],t.tRows=[],t.tColumns=[],this.$nextTick()},getMouseCheckeds:function(){var e=this.editStore.checked,t=e.rows;return{columns:e.columns,rows:t}},handleChecked:function(e,t,i){var l=this.tableData,o=this.visibleColumn,n=this.editStore.checked,r=e.rowIndex,s=e.columnIndex,a=t.rowIndex,u=t.columnIndex;n.tRows=[],n.tColumns=[],n.rows=r<a?l.slice(r,a+1):l.slice(a,r+1),n.columns=s<u?o.slice(Math.max(s,1),u+1):o.slice(Math.max(u,1),s+1)},handleTempChecked:function(e,t,i){var l=this.tableData,o=this.visibleColumn,n=this.editStore.checked,r=n.rows,s=n.tRows,a=n.columns,u=n.tColumns,c=e.rowIndex,h=e.columnIndex,d=t.rowIndex,f=t.columnIndex;s.length>r.length?f=o.indexOf(a[a.length-1]):u.length>a.length&&(d=l.indexOf(r[r.length-1])),c<d?n.tRows=l.slice(c,d+1):(c+=r.length,n.tRows=l.slice(d,c)),h<f?n.tColumns=o.slice(Math.max(h,1),f+1):(h+=a.length,n.tColumns=o.slice(Math.max(f,1),h))},clearCopyed:function(){var e=this.editStore.copyed;return e.cut=!1,e.rows=[],e.columns=[],this.$nextTick()},handleCopyed:function(e,t){var i=this.editStore,l=i.copyed,o=i.checked;l.cut=e,l.rows=o.rows,l.columns=o.columns},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,i=this.editStore,l=i.copyed,o=i.selected,r=l.cut,s=l.rows,a=l.columns;if(s.length&&a.length&&o.row&&o.column){var u=o.args,c=u.rowIndex,h=u.columnIndex,d={rowIndex:c,columnIndex:h},f={rowIndex:c+s.length-1,columnIndex:h+a.length-1};s.forEach(function(l,e){var o=t[c+e];o&&a.forEach(function(e,t){var i=n[h+t];i&&_tools.UtilTools.setCellValue(o,i,_tools.UtilTools.getCellValue(l,e)),r&&_tools.UtilTools.setCellValue(l,e,null)})}),r&&this.clearCopyed(),this.handleChecked(d,f,e)}},handleFocus:function(e,t){var i=e.column,l=e.cell,o=i.editRender;if(o){var n,r=_vXETable.Renderer.get(o.name),s=o.autofocus,a=o.autoselect;if(s&&(n=l.querySelector(s)),!n&&r&&r.autofocus&&(n=l.querySelector(r.autofocus)),n&&(n[a?"select":"focus"](),browse.msie)){var u=n.createTextRange();u.collapse(!1),u.select()}}},setActiveRow:function(e){return this.setActiveCell(e,this.visibleColumn.find(function(e){return e.editRender}).property)},setActiveCell:function(i,l){var o=this;return this.scrollToRow(i,!0).then(function(){if(i&&l){var e=o.visibleColumn.find(function(e){return e.property===l});if(e&&e.editRender){var t=_tools.DomTools.getCell(o,{row:i,column:e});t&&(o.handleActived({row:i,rowIndex:o.getRowIndex(i),column:e,columnIndex:o.getColumnIndex(e),cell:t,$table:o}),o.lastCallTime=Date.now())}}return o.$nextTick()})},setSelectCell:function(e,t){var i=this.tableData,l=this.editConfig,o=this.visibleColumn;if(e&&t&&"manual"!==l.trigger){var n=o.find(function(e){return e.property===t}),r=i.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:o.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},triggerSortEvent:function(e,t,i,l){t.order===l?this.clearSort(t.property):this.sort(t.property,l)},sort:function(t,e){var i=this.visibleColumn,l=this.tableFullColumn,o=this.remoteSort,n=i.find(function(e){return e.property===t}),r=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:o;return(n.sortable||n.remoteSort)&&(e||(e="desc"===n.order?"asc":"desc"),n.order!==e&&(l.forEach(function(e){e.order=null}),n.order=e,r||this.handleData(!0),_tools.UtilTools.emitEvent(this,"sort-change",[{column:n,property:t,prop:t,field:t,order:e,$table:this}]))),this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleData(!0)},filter:function(e,t){var i=this.getColumnByField(e),l=i.filters;if(t){var o=t(l);_xeUtils.default.isArray(o)&&(i.filters=_tools.UtilTools.getFilters(o))}return Promise.resolve(l)},triggerFilterEvent:function(e,t,i){var l=this.$refs,o=this.filterStore;if(o.column===t&&o.visible)o.visible=!1;else{var n=e.target,r=l.filterWrapper,s=_tools.DomTools.getAbsolutePos(n),a=s.top,u=s.left;Object.assign(o,{args:i,multiple:t.filterMultiple,options:t.filters,column:t,style:{zIndex:_conf.default.tooltip.zIndex,top:"".concat(a+n.clientHeight+6,"px"),left:"".concat(u,"px")},visible:!0}),o.isAllSelected=o.options.every(function(e){return e.checked}),o.isIndeterminate=!o.isAllSelected&&o.options.some(function(e){return e.checked}),this.$nextTick(function(){var e=r.$el;o.style.top="".concat(a+n.clientHeight+6,"px"),o.style.left="".concat(u-e.clientWidth/2+10,"px")})}},confirmFilterEvent:function(e){var t=this.visibleColumn,i=this.filterStore,l=this.remoteFilter,o=this.scrollXLoad,n=this.scrollYLoad,r=i.column,s=r.property,a=[],u=[];r.filters.forEach(function(e){e.checked&&(a.push(e.value),u.push(e.data))}),i.visible=!1,l||this.handleData(!0);var c=[];t.filter(function(e){var t=e.property,i=e.filters,l=[],o=[];i&&i.length&&(i.forEach(function(e){e.checked&&(l.push(e.value),o.push(e.data))}),c.push({column:e,property:t,field:t,prop:t,values:l,datas:o}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,property:s,field:s,prop:s,values:a,datas:u,filters:c,$table:this}]),this.updateFooter(),(o||n)&&this.clearScroll(),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){var t=arguments.length?this.getColumnByField(e):null,i=this.filterStore,l=function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})};return t?l(t):this.visibleColumn.forEach(l),t&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},triggerRowExpandEvent:function(e,t){var i=t.row,l=this.toggleRowExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:i,rowIndex:this.getRowIndex(i),$table:this},e]),l},toggleRowExpansion:function(e){return this.setRowExpansion(e)},handleDefaultRowExpand:function(){var e=this.expandConfig,t=void 0===e?{}:e,i=this.tableFullData,l=this.fullDataRowIdData,o=t.expandAll,n=t.expandRowKeys;if(o)this.expandeds=i.slice(0);else if(n){var r=[];n.forEach(function(e){l[e]&&r.push(l[e].row)}),this.expandeds=r}},setAllRowExpansion:function(e){return this.expandeds=e?this.tableFullData.slice(0):[],this.$nextTick()},setRowExpansion:function(e,i){var l=this.expandeds,t=this.expandConfig,o=void 0===t?{}:t,n=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),o.accordion&&(l.length=0,e=e.slice(e.length-1,e.length)),e.forEach(function(e){var t=l.indexOf(e);-1<t?!n&&i||l.splice(t,1):(n||i)&&l.push(e)})),this.$nextTick()},hasRowExpand:function(e){return-1<this.expandeds.indexOf(e)},clearRowExpand:function(){return this.expandeds=[],this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=t.row,l=this.toggleTreeExpansion(i);return _tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:i,rowIndex:this.getRowIndex(i),$table:this},e]),l},toggleTreeExpansion:function(e){return this.setTreeExpansion(e)},handleDefaultTreeExpand:function(){var l=this.treeConfig,o=this.tableFullData;if(l){var e=l.expandAll,t=l.expandRowKeys,n=l.children,r=[];if(e)_xeUtils.default.filterTree(o,function(e){var t=e[n];t&&t.length&&r.push(e)},l),this.treeExpandeds=r;else if(t){var s=_tools.UtilTools.getRowkey(this);t.forEach(function(t){var e=_xeUtils.default.findTree(o,function(e){return t===_xeUtils.default.get(e,s)},l),i=e?e.item[n]:0;i&&i.length&&r.push(e.item)}),this.treeExpandeds=r}}},setAllTreeExpansion:function(e){var t=this.tableFullData,i=this.treeConfig,l=i.children,o=[];return e&&_xeUtils.default.eachTree(t,function(e){var t=e[l];t&&t.length&&o.push(e)},i),this.treeExpandeds=o,this.$nextTick()},setTreeExpansion:function(e,o){var n=this.tableFullData,r=this.treeExpandeds,s=this.treeConfig,a=s.children,u=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),s.accordion&&(e=e.slice(e.length-1,e.length)),e.forEach(function(t){var e=t[a];if(e&&e.length){var i=r.indexOf(t);if(s.accordion){var l=_xeUtils.default.findTree(n,function(e){return e===t},s);_xeUtils.default.remove(r,function(e){return-1<l.items.indexOf(e)})}-1<i?!u&&o||r.splice(i,1):(u||o)&&r.push(t)}})),this.$nextTick()},hasTreeExpand:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){return this.treeExpandeds=[],this.$nextTick()},isScrollXLoad:function(){return console.warn("[vxe-table] The function isScrollXLoad is deprecated, please use getVirtualScroller"),this.scrollXLoad},isScrollYLoad:function(){return console.warn("[vxe-table] The function isScrollXLoad is deprecated, please use getVirtualScroller"),this.scrollYLoad},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,l=e.tableBody.$el;return{scrollX:t,scrollY:i,scrollTop:l.scrollTop,scrollLeft:l.scrollLeft}},triggerScrollXEvent:function(e){for(var t=this.$refs,i=this.visibleColumn,l=this.scrollXStore,o=l.startIndex,n=l.renderSize,r=l.offsetSize,s=l.visibleSize,a=t.tableBody.$el.scrollLeft,u=0,c=0,h=!1,d=0;d<i.length;d++)if(a<(c+=i[d].renderWidth)){u=d;break}if(l.visibleIndex!==u){var f=Math.min(Math.floor((n-s)/2),s);l.visibleIndex>u?(h=u-r<=o)&&(l.startIndex=Math.max(0,u-Math.max(f,n-s))):(h=o+n<=u+s+r)&&(l.startIndex=Math.max(0,Math.min(i.length-n,u-f))),h&&this.updateScrollXData(),l.visibleIndex=u}this.clostTooltip()},triggerScrollYEvent:_xeUtils.default.debounce(function(e){var t=this.afterFullData,i=this.scrollYStore,l=i.startIndex,o=i.renderSize,n=i.offsetSize,r=i.visibleSize,s=i.rowHeight,a=e.target.scrollTop,u=Math.ceil(a/s),c=!1;if(i.visibleIndex!==u){var h=Math.min(Math.floor((o-r)/2),r);i.visibleIndex>u?(c=u-n<=l)&&(i.startIndex=Math.max(0,u-Math.max(h,o-r))):(c=l+o<=u+r+n)&&(i.startIndex=Math.max(0,Math.min(t.length-o,u-h))),c&&this.updateScrollYData(),i.visibleIndex=u}},debounceScrollYDuration,{leading:!1,trailing:!0}),computeScrollLoad:function(){var x=this;return this.$nextTick().then(function(){var e=x.vSize,t=x.scrollXLoad,i=x.scrollYLoad,l=x.scrollYStore,o=x.scrollXStore,n=x.visibleColumn,r=x.optimizeOpts,s=r.scrollX,a=r.scrollY,u=x.$refs.tableBody,c=u?u.$el:null,h=x.$refs.tableHeader;if(c){if(t){var d=n[0],f=d?d.renderWidth:40,g=_xeUtils.default.toNumber(s.vSize||Math.ceil(c.clientWidth/f));o.visibleSize=g,s.oSize||(o.offsetSize=g),s.rSize||(o.renderSize=g+2),x.updateScrollXData()}else x.updateScrollXSpace();if(i){var v;if(a.rHeight)v=a.rHeight;else{var p=c.querySelector("tbody>tr");!p&&h&&(p=h.$el.querySelector("thead>tr")),p&&(v=p.clientHeight)}if(!v)switch(e){case"medium":v=44;break;case"small":v=40;break;case"mini":v=36;break;default:v=48}var m=_xeUtils.default.toNumber(a.vSize||Math.ceil(c.clientHeight/v));l.visibleSize=m,l.rowHeight=v,a.oSize||(l.offsetSize=m),a.rSize||(l.renderSize=m*(browse.edge?10:8)),x.updateScrollYData()}else x.updateScrollYSpace()}return x.$nextTick()})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.visibleColumn,t=this.scrollXStore;t.leftSpaceWidth=e.slice(0,t.startIndex).reduce(function(e,t){return e+t.renderWidth},0),t.rightSpaceWidth=e.slice(t.startIndex+t.renderSize,e.length).reduce(function(e,t){return e+t.renderWidth},0)},updateScrollYData:function(){this.handleData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var e=this.scrollYStore,t=this.afterFullData,i=t.length*e.rowHeight;e.ySpaceHeight=i,e.topSpaceHeight=Math.max(e.startIndex*e.rowHeight,0),e.bottomSpaceHeight=Math.max((t.length-(e.startIndex+e.renderSize))*e.rowHeight,0)},scrollTo:function(e,t){var i=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:i.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var o=this.$refs.rightBody;o&&(o.$el.scrollTop=t),i.scrollTop=t}return this.$nextTick()},scrollToRow:function(e,t,i){return e&&this.fullAllDataRowMap.has(e)&&_tools.DomTools.rowToVisible(this,e),this.scrollToColumn(t,i||_xeUtils.default.isBoolean(t))},scrollToColumn:function(e,t){var i=this;return e&&this.fullColumnMap.has(e)&&_tools.DomTools.colToVisible(this,e),t&&this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},clearScroll:function(){var o=this;return this.lastScrollLeft=0,this.lastScrollTop=0,Object.assign(this.scrollXStore,{startIndex:0,visibleIndex:0}),Object.assign(this.scrollYStore,{startIndex:0,visibleIndex:0}),this.updateScrollXSpace(),this.updateScrollYSpace(),this.$nextTick(function(){var e=o.$refs.tableBody,t=e?e.$el:null,i=o.$refs.tableFooter,l=i?i.$el:null;t&&(t.scrollTop=0,t.scrollLeft=0),l&&(l.scrollLeft=0)}),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,u){var c=this,h=!_xeUtils.default.isUndefined(u);return this.$nextTick().then(function(){var e=c.$refs,t=c.tableData,i=c.editRules,l=c.validStore;if(a&&e.tableBody&&i){var o=a.row,n=a.column;if(c.hasCellRules("change",o,n)){var r=t.indexOf(o),s=_tools.DomTools.getCell(c,{row:o,rowIndex:r,column:n});if(s)return c.validCellRules("change",o,n,u).then(function(){h&&l.visible&&_tools.UtilTools.setCellValue(o,n,u),c.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(o,n,u),c.showValidTooltip({rule:t,row:o,column:n,cell:s})})}}})},triggerValidate:function(l){var o=this,e=this.editConfig,t=this.editStore,i=this.editRules,n=this.validStore,r=t.actived;if(r.row&&i){var s=r.args,a=s.row,u=s.column,c=s.cell;if(this.hasCellRules(l,a,u))return this.validCellRules(l,a,u).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===u&&o.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&l!==t.trigger)return Promise.resolve();var i={rule:t,row:a,column:u,cell:c};return o.showValidTooltip(i),Promise.reject(i)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,n,a){var u=this,c={},r=!0,t=this.editRules,i=this.tableData,l=this.tableFullData,s=this.scrollYLoad,o=s?l:i;e&&(_xeUtils.default.isFunction(e)?n=e:o=_xeUtils.default.isArray(e)?e:[e]);var h=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var d=this.getColumns();return o.forEach(function(r){var s=i.indexOf(r),e=[];d.forEach(function(o,n){_xeUtils.default.has(t,o.property)&&e.push(new Promise(function(i,l){u.validCellRules("all",r,o).then(i).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:s,row:r,columnIndex:n,column:o,$table:u};return a?(c[o.property]||(c[o.property]=[]),c[o.property].push(t),i()):l(t)})}))}),h.push(Promise.all(e))}),Promise.all(h).then(function(){var e=Object.keys(c);if(e.length)return Promise.reject(c[e[0]][0]);n&&n(r)}).catch(function(l){var o=a?c:_defineProperty({},l.column.property,l);return new Promise(function(e,t){var i=function(){l.cell=_tools.DomTools.getCell(u,l),u.handleValidError(l),n?e(n(r=!1,o)):t(o)};s?u.scrollToRow(l.row,!0).then(i):i()})})}return n&&n(r),Promise.resolve(!0)},hasCellRules:function(t,e,i){var l=this.editRules,o=i.property;if(o&&l){var n=_xeUtils.default.get(l,o);return n&&n.find(function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,u,e){var c=this,t=this.editRules,i=u.property,h=[],l=[];if(i&&t){var d=_xeUtils.default.get(t,i),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,i):e;d&&d.forEach(function(r){l.push(new Promise(function(i){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)i();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:r};h.push(new Rule(t))}return i()},{rules:d,row:a,column:u,rowIndex:c.getRowIndex(a),columnIndex:c.getColumnMapIndex(u)});else{var t,l=f,o="number"===r.type,n=null==f||""===f;o?l=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(l),e&&n?h.push(new Rule(r)):(o&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(o?l<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(o?l>r.max:t>r.max))&&h.push(new Rule(r)),i()}}))})}return Promise.all(l).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,i=this.$refs,l=this.height,o=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,u=e.cell,c=i.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),c&&("tooltip"===n.message||"default"===n.message&&!l&&o.length<2)&&c.toVisible(u,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){var t=this.visibleColumn,i=this.scrollXLoad,l=this.scrollYLoad,o=this.treeConfig,n=Object.assign({filename:"table.csv",original:!!o,isHeader:!0,isFooter:!0,download:!0,data:null,columns:null,columnFilterMethod:function(e){return-1===["index","selection","radio"].indexOf(e.type)&&e.property},dataFilterMethod:null},e);-1===n.filename.indexOf(".csv")&&(n.filename+=".csv"),n.original||(i||l)&&(n.original=!0,_tools.UtilTools.warn("vxe.error.scrollOriginal"));var r=t,s=this.tableFullData;return o&&(s=_xeUtils.default.toTreeArray(s,o)),_tools.ExportTools.downloadCsc(n,_tools.ExportTools.getCsvContent(this,n,r,s))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;